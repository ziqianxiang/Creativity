Figure 1: (a) An example of a covariate shifted image where an existing approach, PS (Park et al.,2020a), constructs prediction sets that do not contain the true label (i.e., “sea turtle”); in contrast,our proposed approach PS-W does. (b) The red curve shows the tradeoff between size and errorachieved by different choices of τ on a single shift; the goal is to be as far to the left as possiblewithout crossing the desired error bound ε = 0.1 shown as the black dashed line. The existingapproaches PS and WSCI (Tibshirani et al., 2019) fail to satisfy the desired error bound due tocovariate shift, whereas our approach satisfies it. (c) Our approach satisfies the error bound overnine covariate shifts on DomainNet and ImageNet, whereas existing approaches do not.
Figure 2: The prediction set error and size over 100 random trials under synthetic shift from Ima-geNet to ImageNet-C13. Parameters are m = 20, 000, ε = 0.1, and δ = 10-5. (a) and (b) showsthe box plots for comparison and ablation study, respectively.
Figure 3: Error under the rate shift by Two Gaussians (over 100 random trials). Parameters arem = 50, 000, ε = 0.01, andδ = 10-5.
Figure 4: Prediction set error and size under rate shifts on DomainNet (a-g) and under support shiftson ImageNet (h, i) (over 100 random trials for error and over a held-out test set for size). Parametersare m = 50, 000 for DomainNet and m = 20, 000 for ImageNet, ε = 0.1, and δ = 10-5.
Figure 6:	Prediction set error size size under rate shifts on DomainNet (a-g) and under support shiftson ImageNet (h, i) (over 100 random trial). Default parameters are m = 50, 000 for DomainNetand m = 20, 000 for ImageNet, ε = 0.1, and δ = 10-5. A Top-K prediction set is a predictionset that contains top K labels based on a domain-adapted score function; thus the set size is alwaysK . As can be seen in the prediction set error plots, Top-K prediction sets do not consistently satisfythe desired guarantee. Moreover, the prediction set size is worse than PS-W. For example, whenthe Top-50 prediction set error rate almost achieves the desired error rate, e.g., (6d), the mean andmedial of the corresponding prediction set size is larger than PS-W.
Figure 7:	Prediction set error size size under rate shifts on DomainNet (a-g) and under supportshifts on ImageNet (h, i) (over 100 random trial) for varying E. Parameters are m = 50, 000 forDomainNet and m = 20, 000 for ImageNet, ε = 0.1, and δ = 10-5. In particular, the parameterE in Assumption 1 bounds the quality of our estimates of p(x) and q(x); since these errors cannotbe conveniently measured, we have chosen it heuristically as a hyperparameter. In this figure, weshow the error of PS-W as a function of E. As E becomes smaller, the prediction sets become moreoptimistic while still satisfying the PAC guarantee. Note that the optimal case is E = 0, since PS-Wstill satisfies the PAC guarantee; this result suggests that our IW estimates are reasonably accurate.
Figure 8:	Prediction set error size size under rate shifts on DomainNet (a-g) and under supportshifts on ImageNet (h, i) (over 100 random trial) for varying K. Parameters are m = 50, 000for DomainNet and m = 20, 000 for ImageNet, ε = 0.1, and δ = 10-5. In general, K must bechosen to be small enough so each bin contains sufficiently many source examples to achieve a smallClopper-Perason interval size (e.g., 10-3), though it also needs to be sufficiently large to satisfy thesmoothness assumption.
Figure 9: Prediction sets of the DomainNet shift from All to Paint. Parameters are m = 50, 000,ε = 0.1, and δ = 10-5. The green label is the true label and the label with the hat is the predictedlabel. We choose examples where the two approaches differ; in particular, if PS-W is incorrect, thenPS is incorrect as well since the prediction set sizes are monotone in τ.
Figure 10:	Prediction sets of the shift from ImageNet to ImageNet-C13. Parameters are m =20,000, ε = 0.1, and δ = 10-5. The green label is the true label and the label with the hat isthe predicted label. We choose examples where the two approaches differ; in particular, if PS-W isincorrect, then PS is incorrect as well since the prediction set sizes are monotone in T.
Figure 11:	Prediction sets of the shift from ImageNet to ImageNet-PGD. Parameters are m =20, 000, ε = 0.1, and δ = 10-5. The green label is the true label and the label with the hat isthe predicted label. We choose examples where the two approaches differ; in particular, if PS-W isincorrect, then PS is incorrect as well since the prediction set sizes are monotone in τ .

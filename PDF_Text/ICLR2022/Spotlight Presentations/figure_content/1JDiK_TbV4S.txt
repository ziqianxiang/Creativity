Figure 1: Domain shift, feature restoration and measurement shift. (c,d): Top=source, bottom=target.
Figure 2: The Feature Restoration framework. Left: At development time, a source model is trained beforesaving approximations of the D marginal feature distributions under the source data {pzd}iD=1. Right: At de-ployment time, the feature-extractor is adapted such that the approximations of the marginal feature distributionson the target data {qzd }iD=1 align with those saved on the source.
Figure 3: t-SNE (Van der Maaten & Hinton, 2008) visualization of features for 5 classes of the EMNIST-DAcrystals shift. Dark colours show the source data, light the target. Model accuracies are shown in parentheses.
Figure 4: (a) Activation distributions (bottom) and maximally-activating image patches (top) for a specific filterin the first layer of a CNN. Left: Source model, source data (white digit, black backgr.). Centre: Source model,target data (pink digit, green backgr.). Right: Target model (adapted with BUFR), target data. (b) BUFR trainingcurves on selected emnist-da corruptions. Dashed-grey lines indicate when the next block is unfrozen.
Figure 5: Top: samples from MNIST. Bottom: samples from MNIST-M.
Figure 6: mnist-c corruptions.
Figure 7: emnist-da shifts.
Figure 8: CIFAR corruptions. The same corruptions are used for CIFAR-IO-C and CIFAR-100-C.
Figure 9: CAMELYON17. Columns show different hospitals. Top row: no tumour tissue. Bottom row:tumour tissue present.
Figure 10: Reliability diagrams and confidence histograms over all EMNIST-DA corruptions. (a-d):Reliability diagrams shoWing the difference betWeen average accuracy and average confidence fordifferent methods. (e-h): Confidence histograms showing the frequency with which predictions aremade With a given confidence. Each confidence histogram corresponds With the reliability diagramabove it. (a & e): The source model is well-calibrated on the source data. (b & f): Entropy-minimization leads to extreme overconfidence. (c & g, d & h): Our methods, FR and BUFR, aremuch better-calibrated as they do not work by making predictions more confident.
Figure 11:	Reliability diagrams and confidence histograms for a severe emnist-da shift (sky) whereall methods except BUFR achieve poor accuracy. Each confidence histogram corresponds with thereliability diagram above it. (a & e): Source model on the target data achieves poor accuracy andoften predicts with low confidence. (b & f): SHOT-IM also achieves poor accuracy but is highlyconfident. (d & h): Our BUFR method achieves better ECE and MCE than all other methods.
Figure 12:	Reliability diagrams and confidence histograms for a mild emnist-da shift (shot noise)where all methods achieve good accuracy. Each confidence histogram corresponds with the reliabilitydiagram above it. When highly confident, our methods (d & h) are more often correct than IM (b & f).
Figure 13: Histograms showing the first 6 marginal activation-distributions on the EMNIST-DA stripeshift. The blue curves are the saved marginal distributions under the source data (i.e. emnist). Theorange curves are the marginal distributions under the target data before adaptation (i.e. the stripeshift). (a) Marginal feature activation-distributions. (b) Marginal logit activation-distributions. DSKLdenotes the symmetric KL divergence.
Figure 14: Histograms showing the first 6 marginal activation-distributions on the CIFAR-IO-Cimpulse-noise shift. The blue curves are the saved marginal distributions under the source data (i.e.
Figure 15: Histograms showing distribution-alignment on the emnist-da stripe shift. The bluecurves are the saved marginal distributions under the source data (i.e. emnist). The orange curvesare the marginal distributions under the target data after adaptation (to the stripe shift). (a,b): AdaBNand SHOT-IM do not align the marginal distributions (despite achieving reasonable accuracyâ€”seeTable 17). (c) BUFR matches the activation-distributions very closely, making DSKL very small.
Figure 16: Histograms showing distribution-alignment on the CIFAR-IO-C impulse-noise shift. Theblue curves are the saved marginal distributions under the source data (i.e. CIFAR-io). The orangecurves are the marginal distributions under the target data after adaptation (to the impulse-noise shift).
Figure 17: Symmetric KL divergence between the unit-level activation distributions under the source(emnist) and target (emnist-da crystals) data: (a) before adapting; and (b) after adapting only thefirst layer (ConV1). For Visual clarity, we show only 10 sample units per layer.
Figure 18: Average distance moved by a unit in each block of gt on the EMNIST-DA stripe shift whentraining (a) all layers at once and (b) in a bottom-up manner. Both methods are trained with the sameconstant learning rate.

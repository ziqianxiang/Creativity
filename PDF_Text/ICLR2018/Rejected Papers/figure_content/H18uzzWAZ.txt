Figure 1: A flowchart describing the procedure we use to generate and remove nuisance variationfrom image embeddings. The embedding generation is described in Section 3.1 is characterizedby F, which maps each 128 by 128 color image into a 192-dimensional embedding vector. Thenuisance variation removal by our method is denoted by WDN (Wasserstein Distance Network).
Figure 2: k-NN MOA assignment metrics for one fold of the cross-validation with compound mi-toxantrone held out. The average k-NN metric is used to select the stopping time step, which is at28000 as indicated by the vertical line. Early stopping is supposed to preserve relevant biologicalsignal while remove batch-level nuisance variation. The top panel shows the ‘not same compound’metric, and the bottom panel shows the ‘not same compound or batch’ metric (see Section 3.2.1 fordetails).
Figure 3: Comparison of the first two principal components for the embeddings of the negativecontrol (i.e., DMSO) after preprocessing (i.e., TVN) (left), embeddings transformed by the TVN +CORAL method proposed in Ando et al. (2017) (middle), and embeddings transformed by TVN +WDN (right), which illustrates the reduction of batch-level nuisance variation. Each color corre-sponds to a batch, and there are ten batches in total. Our method is designed to match embeddingsof compounds across batches while not distorting the geometry of the embedding space.
Figure 4: Sample learning curves for WDN with regularization term for λ = λM = λb =0, 40, 80, 160. The Wasserstein loss and the gradient penalty term as a function of the number oftime steps trained on BBBC021 image dataset, after the Wasserstein parameters have been pre-trained for 20000 steps. The larger the regularization weight, the further the point of convergence isfrom zero.
Figure 5: Dosage response curves for each compound, as evaluated by the natural logarithm ofthe Euclidean distance of the embeddings from the origin (i.e. the center of the negative control).
Figure 6: A heatmap showing the cosine similarity matrix between pairs of treatments for the TVNembeddings. Same-MOA compounds are grouped together, and the blue lines show distinctionsbetween different MOAs. The block diagonal terms correspond to the similarity matrices for same-MOA compounds. This plot shows how same-MOA compounds tend to be more closely clusteredtogether in the embedding space.

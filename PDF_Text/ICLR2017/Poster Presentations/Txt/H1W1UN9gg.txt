Published as a conference paper at ICLR 2017
Deep Information Propagation
Samuel S. Schoenholz* Justin Gilmer*	Surya Ganguli	Jascha Sohl-Dickstein
Google Brain	Google Brain	Stanford University	Google Brain
Ab stract
We study the behavior of untrained neural networks whose weights and biases are
randomly distributed using mean field theory. We show the existence of depth
scales that naturally limit the maximum depth of signal propagation through these
random networks. Our main practical result is to show that random networks may
be trained precisely when information can travel through them. Thus, the depth
scales that we identify provide bounds on how deep a network may be trained
for a specific choice of hyperparameters. As a corollary to this, we argue that in
networks at the edge of chaos, one of these depth scales diverges. Thus arbitrarily
deep networks may be trained only sufficiently close to criticality. We show that
the presence of dropout destroys the order-to-chaos critical point and therefore
strongly limits the maximum trainable depth for random networks. Finally, we
develop a mean field theory for backpropagation and we show that the ordered
and chaotic phases correspond to regions of vanishing and exploding gradient
respectively.
1	Introduction
Deep neural network architectures have become ubiquitous in machine learning. The success of
deep networks is due to the fact that they are highly expressive (Montufar et al., 2014) while si-
multaneously being relatively easy to optimize (Choromanska et al., 2015; Goodfellow et al., 2014)
with strong generalization properties (Recht et al., 2015). Consequently, developments in machine
learning often accompany improvements in our ability to train increasingly deep networks. Despite
this, designing novel network architectures is frequently equal parts art and science. This is, in part,
because a general theory for neural networks that might inform design decisions has lagged behind
the feverish pace of design.
A pair of recent papers (Poole et al., 2016; Raghu et al., 2016) demonstrated that random neural
networks are exponentially expressive in their depth. Central to their approach was the consideration
of networks after random initialization, whose weights and biases were i.i.d. Gaussian distributed.
In particular the paper by Poole et al. (2016) developed a “mean field” formalism for treating wide,
untrained, neural networks. They showed that these mean field networks exhibit an order-to-chaos
transition as a function of the weight and bias variances. Notably the mean field formalism is not
closely tied to a specific choice of activation function or loss.
In this paper, we demonstrate the existence of several characteristic “depth” scales that emerge
naturally and control signal propagation in these random networks. We then show that one of these
depth scales, ξc , diverges at the boundary between order and chaos. This result is insensitive to
many architectural decisions (such as choice of activation function) and will generically be true at
any order-to-chaos transition. We then extend these results to include dropout and we show that
even small amounts of dropout destroys the order-to-chaos critical point and consequently removes
the divergence in ξc . Together these results bound the depth to which signal may propagate through
random neural networks.
We then develop a corresponding mean field model for gradients and we show that a duality exists
between the forward propagation of signals and the backpropagation of gradients. The ordered and
chaotic phases that Poole et al. (2016) identified correspond to regions of vanishing and exploding
gradients, respectively. We demonstrate the validity of this mean field theory by computing gradients
of random networks on MNIST. This provides a formal explanation of the ‘vanishing gradients’
*Work done as a member of the Google Brain Residency program (g.co/brainreSidency)
1
Published as a conference paper at ICLR 2017
phenomenon that has long been observed in neural networks (Bengio et al., 1993). We continue
to show that the covariance between two gradients is controlled by the same depth scale that limits
correlated signal propagation in the forward direction.
Finally, we hypothesize that a necessary condition for a random neural network to be trainable is that
information should be able to pass through it. Thus, the depth-scales identified here bound the set of
hyperparameters that will lead to successful training. To test this ansatz we train ensembles of deep,
fully connected, feed-forward neural networks of varying depth on MNIST and CIFAR10, with and
without dropout. Our results confirm that neural networks are trainable precisely when their depth
is not much larger than ξc. This result is dataset independent and is, therefore, a universal function
of network architecture.
A corollary of these result is that asymptotically deep neural networks should be trainable pro-
vided they are initialized sufficiently close to the order-to-chaos transition. The notion of “edge
of chaos” initialization has been explored previously. Such investigations have been both direct as
in Bertschinger et al. (2005); Glorot & Bengio (2010) or indirect, through initialization schemes
that favor deep signal propagation such as batch normalization (Ioffe & Szegedy, 2015), orthogo-
nal matrix initialization (Saxe et al., 2014), random walk initialization (Sussillo & Abbott, 2014),
composition kernels (Daniely et al., 2016), or residual network architectures (He et al., 2015). The
novelty of the work presented here is two-fold. First, our framework predicts the depth at which
networks may be trained even far from the order-to-chaos transition. While a skeptic might ask
when it would be profitable to initialize a network far from criticality, we respond by noting that
there are architectures (such as neural networks with dropout) where no critical point exists and so
this more general framework is needed. Second, our work provides a formal, as opposed to intuitive,
explanation for why very deep networks can only be trained near the edge of chaos.
2	Background
We begin by recapitulating the mean-field formalism developed in Poole et al. (2016). Consider a
fully-connected, untrained, feed-forward, neural network of depth L with layer width Nl and some
nonlinearity φ : R → R. Since this is an untrained neural network we suppose that its weights and
biases are respectively i.i.d. as Wj 〜N(0,σW/Ni) and bi 〜N(0,σ2). Notationally We set Zi to
be the pre-activations of the lth layer and yil+1 to be the activations of that layer. Finally, we take the
input to the netWork to be yi0 = xi . The propagation of a signal through the netWork is described by
the pair of equations,
zil =XWiljyjl +bli	yil+1 = φ(zil).	(1)
j
Since the Weights and biases are randomly distributed, these equations define a probability distri-
bution on the activations and pre-activations over an ensemble of untrained neural netWorks. The
“mean-field” approximation is then to replace zil by a Gaussian Whose first tWo moments match
those of zil. For the remainder of the paper We Will take the mean field approximation as given.
Consider first the evolution ofa single input, xi;a, as it evolves through the netWork (as quantified by
yil;a and zil;a). Since the Weights and biases are independent With zero mean, the first tWo moments
of the pre-activations in the same layer Will be,
E[zi;a] = 0	E[zi;azj;a] = qaaδij	(2)
Where δij is the Kronecker delta. Here qal a is the variance of the pre-activations in the lth layer due
to an input xi;a and it is described by the recursion relation,
qaa = σW / Dzφ2 (VZqaFz) + σ2	⑶
where R Dz = √2∏ R dze-2 z2 is the measure for a standard Gaussian distribution. Together these
equations completely describe the evolution of a single input through a mean field neural netWork.
For any choice of σW and σ2 with bounded φ, eq. 3 has a fixed point at q* = limι→∞ qɑa.
The propagation of a pair of signals, xi0;a and xi0;b, through this network can be understood similarly.
Here the mean pre-activations are trivially the same as in the single-input case. The independence
2
Published as a conference paper at ICLR 2017
of the weights and biases implies that the covariance between different pre-activations in the same
layer will be given by, E[zi；azj;b] = qlabδij. The covariance, qlab, will be given by the recurrence
relation,
σw2	Dz1Dz2φ(u1)φ(u2) + σb2
(4)
VZqa-IzI and u2
where uι
Ca- 1z1 + J1-%I)2 z2 ), with Cab = qab/∖/ qaaqbb，
are Gaussian approximations to the pre-activations in the preceding layer with the correct covariance
matrix. Moreover Cab is the correlation between the two inputs after l layers.
Figure 1: Mean field criticality. (a) The mean field phase diagram showing the boundary between
ordered and chaotic phases as a function of σ/ and σ2. (b) The residual |q* - qɑa∖ as a function
of depth on a log-scale with σ2 = 0.05 and σW from 0.01 (red) to 1.7 (purple). Clear exponential
behavior is observed. (c) The residual |c* - dab∣ as a function of depth on a log-scale. Again, the
exponential behavior is clear. The same color scheme is used here as in (b).
Examining eq. 4 it is clear that c* = 1 is a fixed point of the recurrence relation. To determine
whether or not the C = 1 is an attractive fixed point the quantity,
Xi = ∂∂C⅛ =σW JDz [φ0 ("z)]2
(5)
is introduced. Poole et al. (2016) note that the C = 1 fixed point is stable if χι < 1 and is unstable
otherwise. Thus, χι = 1 represents a critical line separating an ordered phase (in which C = 1
and all inputs end up asymptotically correlated) and a chaotic phase (in which C < 1 and all inputs
end up asymptotically decorrelated). For the case of φ = tanh, the phase diagram in fig. 1 (a) is
observed.
3	Asymptotic Expansions and Depth Scales
Our first contribution is to demonstrate the existence of two depth-scales that arise naturally within
the framework of mean field neural networks. Motivating the existence of these depth-scales, we
iterate eq. 3 and 4 until convergence for many values of σw2 between 0.1 and 3.0 and with σb2 = 0.05
starting with qa0a = qb0b = 0.8 and C0ab = 0.6. We see, in fig. 1 (b) and (c), that the manner in
which both qlaa approaches q* and Cab approaches c* is exponential over many orders of magnitude.
We therefore anticipate that asymptotically 必。-q*| 〜e-"ξq and 或-c*| 〜e-"ξc for suffi-
ciently large l. Here, ξq and ξc define depth-scales over which information may propagate about the
magnitude of a single input and the correlation between two inputs respectively.
We will presently prove that qal a and clab are asymptotically exponential. In both cases we will use
the same fundamental strategy wherein we expand one of the recurrence relations (either eq. 3 or
eq. 4) about its fixed point to get an approximate “asymptotic” recurrence relation. We find that
this asymptotic recurrence relation in turn implies exponential decay towards the fixed point over a
depth-scale, ξx .
We first analyze eq. 3 and identify a depth-scale at which information about a single input may
propagate. Let qal a = q* + l. By construction so long as liml→∞ qal a = q* exists it follows that
3
Published as a conference paper at ICLR 2017
l → 0 as l → ∞. Eq. 3 may be expanded to lowest order in l to arrive at an asymptotic recurrence
relation (see Appendix 7.1),
el+1 = el χι + σW ʃDzφ00 (√q*z) φ (√q*Z) + O ((el)2) .	(6)
Notably, the term multiplying el is a constant. It follows that for large l the asymptotic recurrence
relation has an exponential solution, el 〜e-)ξq, With ξq given by
ξq-1 = - log
Xi + σW / Dzφ00 (√q*z) φ (√q*z)∣ .
(7)
This establishes ξq as a depth scale that controls hoW deep information from a single input may
penetrate into a random neural netWork.
Next, We consider eq. 4. Using a similar argument (detailed in Appendix 7.2) We can expand about
Cab = C + el to find an asymptotic recurrence relation,
el+1 = el σW ] DziDz2φ0(ul)φ0(说)+ O((el)2).
(8)
Here uɪ = √q*zι and 竭 = √q*(c*zι + ,1 - (c*)2z2). Thus, once again, we expect that for large
l this recurrence will have an exponential solution, el 〜e-"ξc, with ξc given by
ξc-i = - log σw2
Dz1Dz2φ0 (uz1 )φ0(u2)
(9)
In the ordered phase C = 1 and so ξ-i = - log χι. Since the transition between order and chaos
occurs when χι = 1 it follows that ξc diverges at any order-to-chaos transition so long as q* and C
Figure 2: Depth scales. (a) The iterative correlation map showing Cia+1 as a function of Cab for three
different values of σW. Green inset lines show the linearization of the iterative map about the critical
point, e-1∕ξc. The three curves show networks far in the ordered regime (red), at the edge of chaos
(purple), and deep in the chaotic regime (blue). (b) The depth scale for information propagated in a
single input, ξq as a function of σW for σb = 0.01 (black) to σb = 0.3 (green). Dashed lines show
theoretical predictions while solid lines show measurements. (c) The depth scale for correlations
between inputs, ξc for the same values of σb2. Again dashed lines are the theoretical predictions
while solid lines show measurements. Here a clear divergence is observed at the order-to-chaos
transition.
These results can be investigated intuitively by plotting Ca+1 vs Cab in fig. 2 (a). In the ordered phase
there is only a single fixed point, Cab = 1. In the chaotic regime we see that a second fixed point
develops and the Clab = 1 point becomes unstable. We see that the linearization about the fixed
points becomes significantly closer to the trivial map near the order-to-chaos transition.
To test these claims we measure ξq and ξc directly by iterating the recurrence relations for qal a and
Clab as before with qa0a = qb0b = 0.8 and C0ab = 0.6. In this case we consider values of σw2 between
4
Published as a conference paper at ICLR 2017
0.1 and 3.0 and σb2 between 0.01 and 0.3. For each hyperparameter settings we fit the resulting
residuals,必。-q*| and Hb - c* |, to exponential functions and infer the depth-scale. We then
compare this measured depth-scale to that predicted by the asymptotic expansion. The result of this
measurement is shown in fig. 2. In general we see that the agreement is quite good. As expected we
see that ξc diverges at the critical point.
As observed in Poole et al. (2016) we see that the depth scale for the propagation of information in a
single input, ξq, is consistently finite and significantly shorter than ξc. To understand why this is the
case consider eq. 6 and note that for tanh nonlinearities the second term is always negative. Thus,
even as χι approaches 1 We expect χι + σW / Dzφ00(√q*z)φ(√q*z) to be substantially smaller
than 1.
3.1 Dropout
The mean field formalism can be extended to include dropout. The main contribution here will
be to argue that even infinitesimal amounts of dropout destroys the mean field critical point, and
therefore limits the trainable network depth. In the presence of dropout the propagation equation,
eq. 1, becomes,
Zi T X Wj Pj yj + bi	(10)
ρj
where Pj 〜Bernoulli(ρ) and P is the dropout rate. As is typically the case we have re-scaled the
sum by ρ-1 so that the mean of the pre-activation is invariant with respect to our choice of dropout
rate.
Following a similar procedure to the original mean field calculation consider the fate of two inputs,
xi0;a and xi0;b, as they are propagated through such a random network. We take the dropout masks to
be chosen independently for the two inputs mimicking the manner in which dropout is employed in
practice. With dropout the diagonal term in the covariance matrix will be (see Appendix 7.3),
+ σb2 .
(11)
The variance of a single input with dropout will therefore propagate in an identical fashion to the
vanilla case with a re-scaling σw2 → σw2 /ρ. Intuitively, this result implies that, for the case of a
single input, the presence of dropout simply increases the effective variance of the weights.
Computing the off-diagonal term of the covariance matrix similarly (see Appendix 7.4),
2
σw
/ Dzi Dz2φ(u1)φ(u2) + σ2
(12)
with Ui, U2, and Cab defined by analogy to the mean field equations without dropout. Here, unlike
in the case of a single input, the recurrence relation is identical to the recurrence relation without
dropout. To see that c* = 1 is no longer a fixed point of these dynamics consider what happens
to eq. 12 when we input cl = 1. For simplicity, we leverage the short range of ξq to replace
qcal a = qcblb = qc* . We find (see Appendix 7.5),
⅛+ 1 = 1 - 1ρ-ρσW Z Dzφ2 (√q*Z) .	(13)
The second term is positive for any ρ < 1. This implies that if cclab = 1 for any l then ccla+bi < 1.
Thus, c* = 1 is not a fixed point of eq. 12 for any ρ < 1. Since eq. 12 is identical in form to eq. 4 it
follows that the depth scale for signal propagation with dropout will likewise be given by eq. 9 with
the substitutions q* → qc* and c* → cc* computed using eq. 11 and eq. 12 respectively. Importantly,
since there is no longer a sharp critical point with dropout we do not expect a diverging depth scale.
As in networks without dropout we plot, in fig. 3 (a), the iterative map ccla+b i as a function of cclab.
Most significantly, we see that the cclab = 1 is no longer a fixed point of the dynamics. Instead, as
the dropout rate increases cclab gets mapped to decreasing values and the fixed point monotonically
decreases.
5
Published as a conference paper at ICLR 2017
Figure 3: Dropout destroys the critical point, and limits the depth to which information can propagate
in a deep network. (a) The iterative correlation map showing Cla+1 as a function of clab for three
different values of the dropout rate P for networks tuned close to their critical point. Green inset
lines show the linearization of the iterative map about the critical point, e-1/&. (b) The asymptotic
value of the correlation map, c*, as a function of σW for different values of dropout from P = 1
(black) to ρ = 0.8 (blue). We see that for all values of dropout except for P = 1, C does not show a
sharp transition between an ordered phase and a chaotic phase. (c) The correlation depth scale ξc as
a function of σW for the same values of dropout as in (b). We see here that for all values of P except
for ρ = 1 there is no divergence in ξc.
To test these results we plot in fig. 3 (b) the asymptotic correlation, c*, as a function of σW for
different values of dropout from P = 0.8 to P = 1.0. As expected, we see that for all ρ < 1
there is no sharp transition between C = 1 and C < 1. Moreover as the dropout rate increases the
correlation C monotonically decreases. Intuitively this makes sense. Identical inputs passed through
two different dropout masks will become increasingly dissimilar as the dropout rate increases. In
fig. 3 (c) we show the depth scale, ξc, as a function of σw2 for the same range of dropout probabilities.
We find that, as predicted, the depth of signal propagation with dropout is drastically reduced and,
importantly, there is no longer a divergence in ξc . Increasing the dropout rate continues to decrease
the correlation depth for constant σw2 .
4	Gradient Backpropagation
There is a duality between the forward propagation of signals and the backpropagation of gradients.
To elucidate this connection consider the backpropagation equations given a loss E,
∂E = δi φ(zj-1)	δ = φ0(zi) X δj+1Wjl+1	(14)
ij	j
with the identification δ∖ = ∂E/∂Zi. Within mean field theory, it is clear that the scale of fluctuations
of the gradient of weights in a layer will be proportional to E[(δil )2] (see appendix 7.6). In contrast
to the pre-activations in forward propagation (eq. 1), the δil will typically not be Gaussian distributed
even in the large layer width limit.
Nonetheless, we can work out a recurrence relation for the variance of the error, Gaa = E[(δi)2],
leveraging the Gaussian ansatz on the pre-activations. In order to do this, however, we must first
make an additional approximation that the weights used during forward propagation are drawn in-
dependently from the weights used in backpropagation. This approximation is similar in spirit to the
vanilla mean field approximation and is reminiscent of work on feedback alignment (Lillicrap et al.,
2014). With this in mind we arrive at the recurrence (see appendix 7.7),
总=qa+1 N+ X1.	(15)
Nl
The presence of χ1 in the above equation should perhaps not be surprising. In Poole et al. (2016)
they show that χ1 is intimately related to the tangent space of a given layer in mean field neural
6
Published as a conference paper at ICLR 2017
networks. We note that the backpropagation recurrence features an explicit dependence on the ratio
of widths of adjacent layers of the network, Nl+1/Nl. Here we will consider exclusively constant
width networks where this factor is unity. For a discussion of the case of unequal layer widths see
Glorot & Bengio (2010).
Since χι depends only on the asymptotic q* it follows that for constant width networks We expect
eq. 15 to again have an exponential solution with,
⅛la = ⅛Le-(Lτ"ξv	ξ-1 = -log X1.	(16)
Note that here ξ-1 = - log χι both above and below the transition. It follows that ξv can be both
positive and negative. We conclude that there should be three distinct regimes for the gradients.
1.	In the ordered phase, χι < 1 and so ξv > 0. We therefore expect gradients to vanish over
a depth ∣ξv |.
2.	At criticality, χι → 1 and so ξv → ∞. Here gradients should be stable regardless of depth.
3.	In the chaotic phase, χι > 1 and so ξv < 0. It follows that in this regime gradients should
explode over a depth ∣ξv |.
Intuitively these three regimes make sense. To see this, recall that perturbations to a weight in layer
l can alternatively be viewed as perturbations to the pre-activations in the same layer. In the ordered
phase both the perturbed signal and the unperturbed signal will be asymptotically mapped to the
same point and the derivative will be small. In the chaotic phase the perturbed and unperturbed
signals will become asymptotically decorrelated and the gradient will be large.
0	50	100	150	200
l
Figure 4: Gradient backpropagation behaves similarly to signal forward propagation. (a) The 2-
norm, ∣Vwι E||2 as a function of layer, l, for a 240 layer random network with a cross-entropy
ab
loss on MNIST. Different values of σW from 1.0 (blue) to 4.0 (red) are shown. Clear exponential
vanishing / explosion is observed over many orders of magnitude. (b) The depth scale for gradients
predicted by theory (dashed line) compared with measurements from experiment (red dots). Simi-
larity between theory and experiment is clear. Deviations near the critical point are primarily due to
finite size effects.
To investigate these predictions we construct deep random networks of depth L = 240 and layer-
width Nl = 300. We then consider the cross-entropy loss of these networks on MNIST. In fig. 4 (a)
we plot the layer-by-layer 2-norm of the gradient, ||Vwι E||2, as a function of layer, l, for differ-
ab
ent values of σW. We see that ||Vw ι E||2 behaves exponentially over many orders of magnitude.
ab
Moreover, we see that the gradient vanishes in the ordered phase and explodes in the chaotic phase.
We test the quantitative predictions of eq. 16 in fig. 4 (b) where we compare ∣ξv | as predicted from
theory with the measured depth-scale constructed from exponential fits to the gradient data. Here
we see good quantitative agreement between the theoretical predictions from mean field random net-
works and experimentally realized networks. Together these results suggest that the approximations
on the backpropagation equations were representative of deep, wide, random networks.
Finally, we show that the depth scale for correlated signal propagation likewise controls the depth
at which information stored in the covariance between gradients can survive. The existence of
7
Published as a conference paper at ICLR 2017
consistent gradients across similar samples from a training set ought to be especially important for
determining whether or not a given neural network architecture can be trained. To establish this
depth-scale first note (see Appendix 7.8) that the covariance between gradients of two different
inputs, Xi；i and xi；2, will be proportional to (VwijEα) ∙ (VwijEb)〜E[δ2aδ⅛ = q」b Where Eais
the loss evaluated on x^。and 6储。=∂Ea∕∂z∖.a are appropriately defined errors.
It can be shown (see Appendix 7.9) that 姑 features the recurrence relation,
qlb = q。+1 N+ σW D Dz1Dz2φ0(u1)φ0(u2)	(17)
Nl+2
where u1 and u2 are defined similarly as for the forward pass. Expanding asymptotically it is clear
that to zeroth order in el, q：b will have an exponential solution with qʌ = q_Le-(L-l”ξc with ξc as
defined in the forward pass.
5 Experimental Results
Taken together, the results of this paper lead us to the following hypothesis: a necessary condition
for a random network to be trained is that information about the inputs should be able to propa-
gate forward through the network, and information about the gradients should be able to propagate
backwards through the network. The preceding analysis shows that networks will have this property
precisely when the network depth, L, is not much larger than the depth-scale ξc . This criterion is
data independent and therefore offers a “universal” constraint on the hyperparameters that depends
on network architecture alone. We now explore this relationship between depth of signal propagation
and network trainability empirically.
Figure 5: Mean field depth scales control trainable hyperparameters. The training accuracy for neu-
ral networks as a function of their depth and initial weight variance, σw2 from a high accuracy (red) to
low accuracy (black). In (a) we plot the training accuracy after 200 training steps on MNIST using
SGD. Here overlayed in grey dashed lines are different multiples of the depth scale for correlated
signal propagation, nξc. We plot the accuracy in (b) after 2000 training steps on CIFAR10 using
SGD, in (c) after 14000 training steps on MNIST using SGD, and in (d) after 300 training steps on
MNIST using RMSPROP. Here we overlay in white dashed lines 6ξc .
To investigate this prediction, we consider random networks of depth 10 ≤ L ≤ 300 and 1 ≤ σw2 ≤
4 with σb2 = 0.05. We train these networks using Stochastic Gradient Descent (SGD) and RMSProp
8
Published as a conference paper at ICLR 2017
on MNIST and CIFAR10. We use a learning rate of 10-3 for SGD when L . 200, 10-4 for larger
L, and 10-5 for RMSProp. These learning rates were selected by grid search between 10-6 and
10-2 in exponentially spaced steps of size 10. We note that the depth dependence of learning rate
was explored in detail in Saxe et al. (2014). In fig. 5 (a)-(d) we color in red the training accuracy
that neural networks achieved as a function of σw2 and L for different datasets, training time, and
choice of minimizer (see Appendix 7.10 for more comparisons). In all cases the neural networks
over-fit the data to give a training accuracy of 100% and test accuracies of 98% on MNIST and 55%
on CIFAR10. We emphasize that the purpose of this study is to demonstrate trainability as opposed
to optimizing test accuracy.
We now make the connection between the depth scale, ξc, and the maximum trainable depth more
precise. Given the arguments in the preceding sections we note that if L = nξc then signal through
the network will be attenuated by a factor of en . To understand how much signal can be lost while
still allowing for training, we overlay in fig. 5 (a) curves corresponding to nξc from n = 1 to 6. We
find that networks appear to be trainable when L . 6ξc . It would be interesting to understand why
this is the case.
Motivated by this argument in fig. 5 (b)-(d) in white, dashed, overlay we plot twice the predicted
depth scale, 6ξc . There is clearly a relationship between the depth of correlated signal propagation
and whether or not these networks are trainable. Networks closer to their critical point appear to
train more quickly than those further away. Moreover, this relationship has no obvious dependence
on dataset, duration of training, or minimizer. We therefore conclude that these bounds on trainable
hyperparameters are universal. This in turn implies that to train increasingly deep networks, one
must generically be ever closer to criticality.
Figure 6: The effect of dropout on trainability. The same scheme as in fig. 5 but with dropout rates of
(a) P = 0.99, (b) P = 0.98, and (c) P = 0.94. Even for modest amounts of dropout We see an upper
bound on the maximum trainable depth for neural networks. We continue to see good agreement
between the prediction of our theory and our experimental training accuracy.
Next we consider the effect of dropout. As we showed earlier, even infinitesimal amounts of dropout
disrupt the order-to-chaos phase transition and cause the depth scale to become finite. However,
since the effect of a single dropout mask is to simply re-scale the weight variance by σW → σW /ρ, the
gradient magnitude will be stable near criticality, while the input and gradient correlations will not
be. This therefore offers a unique opportunity to test whether the relevant depth-scale is 11/ log χι |
or ξc.
In fig. 6 we repeat the same experimental setup as above on MNIST with dropout rates P =
0.99, 0.98, and 0.94. We observe, first and foremost, that even extremely modest amounts of dropout
limit the maximum trainable depth to about L = 100. We additionally notice that the depth-scale,
ξc, predicts the trainable region accurately for varying amounts of dropout.
6	Discussion
In this paper we have elucidated the existence of several depth-scales that control signal propagation
in random neural networks. Furthermore, we have shown that the degree to which a neural network
can be trained depends crucially on its ability to propagate information about inputs and gradients
9
Published as a conference paper at ICLR 2017
through its full depth. At the transition between order and chaos, information stored in the correla-
tion between inputs can propagate infinitely far through these random networks. This in turn implies
that extremely deep neural networks may be trained sufficiently close to criticality. However, our
contribution goes beyond advocating for hyperparameter selection that brings random networks to
be nearly critical. Instead, we offer a general purpose framework that predicts, at the level of mean
field theory, which hyperparameters should allow a network to be trained. This is especially relevant
when analyzing schemes like dropout where there is no critical point and which therefore imply an
upper bound on trainable network depth.
An alternative perspective as to why information stored in the covariance between inputs is crucial
for training can be understood by appealing to the correspondence between infinitely wide Bayesian
neural networks and Gaussian Processes (Neal, 2012). In particular the covariance, qal b, is intimately
related to the kernel of the induced Gaussian Process. It follows that cases in which signal stored in
the covariance between inputs may propagate through the network correspond precisely to situations
in which the associated Gaussian Process is well defined.
Our work suggests that it may be fruitful to investigate pre-training schemes that attempt to perturb
the weights of a neural network to favor information flow through the network. In principle this
could be accomplished through a layer-by-layer local criterion for information flow or by selecting
the mean and variance in schemes like batch normalization to maximize the covariance depth-scale.
These results suggest that theoretical work on random neural networks can be used to inform prac-
tical architectural decisions. However, there is still much work to be done. For instance, the frame-
work developed here does not apply to unbounded activations, such as rectified linear units, where
it can be shown that there are phases in which eq. 3 does not have a fixed point. Additionally, the
analysis here applies directly only to fully connected feed-forward networks, and will need to be
extended to architectures with structured weight matrices such as convolutional networks.
We close by noting that in physics it has long been known that, through renormalization, the behavior
of systems near critical points can control their behavior even far from the idealized critical case.
We therefore make the somewhat bold hypothesis that a broad class of neural network topologies
will be controlled by the fully-connected mean field critical point.
Acknowledgments
We thank Ben Poole, Jeffrey Pennington, Maithra Raghu, and George Dahl for useful discussions.
We are additionally grateful to RocketAI for introducing us to Temporally Recurrent Online Learn-
ing and two-dimensional time.
References
Y Bengio, Paolo Frasconi, and P Simard. The problem of learning long-term dependencies in
recurrent networks. In Neural Networks, 1993., IEEE International Conference on, pp. 1183-
1188. IEEE, 1993.
Nils Bertschinger, Thomas Natschlager, and Robert A. Legenstein. At the edge of chaos: Real-time
computations and self-organized criticality in recurrent neural networks. In L. K. Saul, Y. Weiss,
and L. Bottou (eds.), Advances in Neural Information Processing Systems 17, pp. 145-152. MIT
Press, 2005.
Anna Choromanska, Mikael Henaff, Michael Mathieu, Gerard Ben Arous, and Yann LeCun. The
loss surfaces of multilayer networks. In AISTATS, 2015.
A.	Daniely, R. Frostig, and Y. Singer. Toward Deeper Understanding of Neural Networks: The
Power of Initialization and a Dual View on Expressivity. arXiv:1602.05897, 2016.
Xavier Glorot and Yoshua Bengio. Understanding the difficulty of training deep feedforward neural
networks. In Aistats, volume 9, pp. 249-256, 2010.
Ian J Goodfellow, Oriol Vinyals, and Andrew M Saxe. Qualitatively characterizing neural network
optimization problems. arXiv:1412.6544, 2014.
10
Published as a conference paper at ICLR 2017
K. He, X. Zhang, S. Ren, and J. Sun. Deep Residual Learning for Image Recognition. ArXiv e-prints,
December 2015.
Sergey Ioffe and Christian Szegedy. Batch normalization: Accelerating deep network training by re-
ducing internal covariate shift. In Proceedings of The 32nd International Conference on Machine
Learning,pp. 448-456, 2015.
Timothy P Lillicrap, Daniel Cownden, Douglas B Tweed, and Colin J Akerman. Random feedback
weights support learning in deep neural networks. arXiv:1411.0247, 2014.
Guido F Montufar, Razvan Pascanu, Kyunghyun Cho, and Yoshua Bengio. On the number of linear
regions of deep neural networks. In Z. Ghahramani, M. Welling, C. Cortes, N. D. Lawrence, and
K. Q. Weinberger (eds.), Advances in Neural Information Processing Systems 27, pp. 2924-2932.
Curran Associates, Inc., 2014.
Radford M Neal. Bayesian learning for neural networks, volume 118. Springer Science & Business
Media, 2012.
B.	Poole, S. Lahiri, M. Raghu, J. Sohl-Dickstein, and S. Ganguli. Exponential expressivity in deep
neural networks through transient chaos. arXiv:1606.05340, June 2016.
M. Raghu, B. Poole, J. Kleinberg, S. Ganguli, and J. Sohl-Dickstein. On the expressive power of
deep neural networks. arXiv:1606.05336, June 2016.
Benjamin Recht, Moritz Hardt, and Yoram Singer. Train faster, generalize better: Stability of
stochastic gradient descent. arXiv:1509.01240, 2015.
A. M. Saxe, J. L. McClelland, and S. Ganguli. Exact solutions to the nonlinear dynamics of learning
in deep linear neural networks. International Conference on Learning Representations, 2014.
David Sussillo and LF Abbott. Random walks: Training very deep nonlinear feed-forward networks
with smart initialization. CoRR, vol. abs/1412.6558, 2014.
7	Appendix
Here we present derivations of results from throughout the paper.
7.1	Single input depth-scale
Result:
Consider the recurrence relation for the variance of a single input,
qaa = σW / Dzφ2 ( VZqa-Iz) + σb	(18)
and a fixed point of the dynamics, q*. qlaɑ can be expanded about the fixed point to yield the
asymptotic recurrence relation,
e'+1 = e' X1 + σW ] Dzφ" (√q*z) φ (√q*z) + O ((e')2) .	(19)
Derivation:
11
Published as a conference paper at ICLR 2017
We begin by first expanding to order Jl,
q* + J+1 = σW / Dz [φ (，q* + J z)] + σ2
(20)
≈ σw∕
Dz φ
1
+ 2
2
+ σ2
(21)
≈ σW / Dz ]φ (√q*z)
+ 2√q*φ (√q*z)	+ σ2+ O((J)2)
(22)
2
≈ σW / Dzφ2 (√q*z) + σ2 + J √w* / Dzzφ (√q*z) φ0 (√q*z) + O((el)2) (23)
≈ q* +
Dzzφ(√q^z)φ' ("Z) + O((e1)2).
(24)
We therefore arrive at the approximate reccurence relation,
el+1
(25)
Using the identity, J Dzzf (z) = J DZf(Z) We can rewrite this asymptotic recurrence relation as,
el+1 = el
σW /DZ [Φ, (√q*z)]2 + σW / DZ。" (√q*z)φ (√q*z)
X1 + σW / Dzφ" (√q*z) φ (√q*z)] + O((J)2)
+ O((e')2)	(26)
(27)
/
as required.
7.2	TWO INPUT DEPTH-SCALE
Result:
Consider the recurrence relation for the co-variance of two input,
a correlation between the inputs, Clab
σW / DZIDZ2φ(uι)φ(u2^) + σ2,	∣
= qab/ qaaqbb, and a fixed point of the dynamics, c*. cab
(28)
can
be expanded about the fixed point to yield the asymptotic recurrence relation,
el+1 = J
2
σw
ʃDzιDz2φ'(uι)φ'(u2) + O ((e1)2).
(29)
Derivation:
Since the relaxation of 九 and 以 to q* occurs much more quickly than the convergence of 盛
we approximate qaa = qbb = q* as in Poole et al. (2016). We therefore consider the perturbation
dab/q = Cab = c* + J. It follows that we may make the approximation,
u2 = √ (cLbz1 + J1 - (Cab))Z2
≈ √q* (c*z1 + ʌ/l - (c*)2 - 2c*elz2) + √q*elz1 + O(e2)
(30)
(31)
(32)
We now consider the case where c* < 1 and c* = 1 separately; we will later show that these two
results agree with one another. First we consider the case where c* < 1 in which case we may safely
expand the above equation to get,
c*
Wz2 + O(e2 )∙	(33)
	
12
Published as a conference paper at ICLR 2017
This allows us to in turn approximate the recurrence relation,
cla+b1
2
qw J DzιDz2φ(uι)φ(u2) + σb
(34)
σw Z
q2
Dz1Dz2φ(u" φ(U) + √q*el Z1----亍
1
c2
φ0(u2) + σb + O(E2)
(35)
c2 +
Dz1Dz2 z1 -
1
c2
Wz2 φ(u1)φ(U2)
(36)
2
c2 + √w2 el
Dz1Dz2z1φ(u12)φ0(u22) -
1
c2
W	(U2)	(37)

	
	
	
c2 + σw2 El
Dz1Dz2(φ0(u12)φ0(u22) + c2φ(u21)φ00(u22)) -c2	Dz1Dz2φ(u12)φ00(u22)
(38)
c2 + σw2 El	Dz1Dz2φ0(u12)φ0(u22).
(39)
where U21 and U22 are appropriately defined asymptotic random variables. This leads to the asymptotic
recurrence relation,
El+1 = σw2 El	Dz1Dz2φ0(U21)φ0(U22)	(40)
as required.
We now consider the case where c2 = 1 and clab = 1 - El . In this case the expansion of Ul2 will
become,
ul2 = √q2z1 + p2q*e1Z2 - √q*elzι + O(e3/2)	(41)
and so the lowest order correction is of order O(√el) as opposed to O(el). As usual We now expand
the recurrence relation, noting that U22 = U21 is independent of z2 when c2 = 1 to find,
2
cl0+ 1 = -w J Dz1Dz2Φ(u2)Φ(ul2) + 式	(42)
≈ -2 / Dz1Dz20(u；) 卜(u2) + (p2q*elz2 - √q*elz1)。0(竭) + q*elz∣φ00(u2)i + -2
(43)
=c2 + -WEl [ Dzφ(√q2z) φ'0(√q2z) --1= zφ0(√q2z)	(44)
√q2
Dzφ(√q2z)φ00(√q2z) - √=2 / Dzzφ(√q2z)φ0(√q2Z)	(45)
=c2 - -WEl / Dz [φ0(√q*z)]2	(46)
It follows that the asymptotic recurrence relation in this case will be,
El+1 = -El-W / Dz [φ0(√q*z)]2 = -elX1∙	(47)
where χ1 is the stability condition for the ordered phase. We note that although the approximations
were somewhat different the asymptotic recurrence relation for c2 < 1 reduces eq. 47 result for
c2 = 1. We may therefore use 4 for all c2 .
7.3	Variance of an input with dropout
Result:
13
Published as a conference paper at ICLR 2017
In the presence of dropout with rate ρ, the variance of a single input as it is passed through the
network is described by the recurrence relation,
+ σb2 .
(48)
Derivation:
Recall that the recurrence relation for the pre-activations is given by,
Zi T X Wj Pj yj + bi	(49)
ρ
where Plj 〜BemoUlli(ρ). It follows that the variance will be given by,
da。= E[(zi)2]
=* XE[(Wj)2]E[(ρj)2]E[(yj)2]+ E[(bi)2]
ρj
=σw Z Dzφ2 (qααιz)+σ2.
(50)
(51)
(52)
where we have Used the fact that E[(Plj )2] = ρ.
7.4	Covariance of two inputs with dropout
Result:
The co-variance between two signals, zil;a and zil;b , with separate i.i.d. dropoUt masks Pli;a and Pli;b
is given by,
σw2	Dz1Dz2φ(ud1)φ(ud2) +σb2.
(53)
where, in analogy to eq. 4, Ui = ʌ/dɪzi and U2
Derivation:
Proceeding directly we find that,
E[zi；azi；b] = B XE[(Wj)2]E[pj；a]E[pj；b]E[yj；ayj；b] + E[bi]
ρj
= σw2	Dz1Dz2φ(ud1)φ(ud2) +σb2
(54)
(55)
where we have Used the fact that E[Pli;a] = E[Pli;b ] = ρ. We have also Used the same sUbstitUtion for
E[yjl;ayjl;b] Used in the original mean field calcUlation with the appropriate sUbstitUtion.
7.5	THE LACK OFA c* = 1 FIXED POINT WITH DROPOUT
Result:
If clab = 1 then it follows that,
ca+1 =1 - 1--pσrW / Dzφ2 (后 Z)	(56)
subject to the approximation, q。。≈ qbb ≈ q*. This implies that Clα+b 1 < 1.
Derivation:
14
Published as a conference paper at ICLR 2017
Plugging in Cab = 1 With qlαa ≈ 孔 ≈ q* We find that Ui = U2 = √q*zι. It follows that,
ql+1
cια+1=qqb-	(57)
=q* σW Z Dzφ2 (√q*z) + σ2]	(58)
=q* 卜W(1 - P-1 + PT) / Dzφ2 (√q*z) + σ2	(59)
=q7	]-P	Z Dzφ2	(√q*Z) +	σ2]	+	-qw-(I- PT)	Z Dzφ2	(√q*Z)	(6O)
=1 - 1ρ-pcrW Z DzΦ2 (√q*z)	(61)
as required. Here We have integrated out z2 since nether Ui nor U2 depend on it.
7.6	Mean field gradient scaling
Result:
In mean field theory the expected magnitude of the gradient ||Vw 1 E||2 will be proportional to
ij
E[(δiα)2].
Derivation:
We first note that since the Wiαj are i.i.d. it folloWs that,
||VWlE||2=
ij
ij
2
∂E ∖
∂WjJ
≈ NN+iE
2
∂E ∖
∂WjJ
(62)
(63)
Where We have used the fact that the first line is related to the sample expectation over the different
realizations of the Wiαj to approximate it by the analytic expectation in the second line. In mean field
theory since the pre-activations in each layer are assumed to be i.i.d. Gaussian it folloWs that,
E
2
∂E ∖
∂WjJ
E[(δiα)2]E[φ2(Zjα-i)]
(64)
and the result folloWs.
7.7	Mean field backpropagation
Result:
In mean field theory the recursion relation for the variance of the errors, ql = E[(δi)2] is given by,
α
qaa
qa+1
Nι+i
Nl+2
χi(qala).
(65)
Derivation:
15
Published as a conference paper at ICLR 2017
Computing the variance directly and using mean field approximation,
qala = E[(δi;0)2] = E[(φ0(zi;0))2] XE[(δj.+1)2]E[(Wjl+1)2]
j
2
=EK。0®"))2] N+ X E[(δj+1)2]
E[(φ0(zi;0))2] N+ σw qa+1
(66)
(67)
(68)
(69)
(70)
2
=σw qa+1 岩/Dz
≈泼1筌Xi
as required. In the last step We have made the approximation that qlαα ≈ q* since the depth scale for
the variance is short ranged.
7.8	Mean field gradient covariance scaling
Result:
In mean field theory We expect the covariance betWeen the gradients of tWo different inputs to scale
as,
(▽wj Ea) ∙ "wj Eb)〜E[6i;a6i;b].	(71)
Derivation:
We proceed in a manner analogous to Appendix 7.6. Note that in mean field theory since the Weights
are i.i.d. it folloWs that
(VWjEa ) ∙ (VwjEb) = X ∂W 黑	(72)
ij	ij ij
∂Ea ∂Eb
≈ NlNl+1E W W	(73)
∂Wilj ∂Wilj
Where, as before, the final term is approximating the sample expectation. Since the Weights in the
forWard and backWards passes are chosen independently it folloWs that We can factor the expectation
as,
E ∂∖WWT ∂w∖ = E[<⅞a% ]ElΦ(z^)Φ(zlib)]	(74)
ij ij
and the result folloWs.
7.9	Mean field backpropagation of covariance
Result:
The covariance betWeen the gradients due to tWo inputs scales as,
qlb = qa+1 N+ σW / DZiDZ2φ0(uι)φ0(u2)	(75)
under backpropagation.
Derivation
As in the analogous derivation for the variance, We compute directly,
qalb =旧[哈也]=E [φ0(zi.a)φ0(zib)] X E[δ露耽 1]E[(Wj+1)2]	(76)
j
=qalb+1 N+ σW I DziDz2φ1(u1 )φ0(u2)	(77)
as required.
16
Published as a conference paper at ICLR 2017
7.10	Further experimental results
Here We include some more experimental figures that investigate the effects of training time, mini-
mizer, and dataset more closely.
Figure 7: Training accuracy on MNIST after (a) 45 (b) 304 (C) 2048 and (d) 13780 steps of SGD
with learning rate 10-3.
17
Published as a conference paper at ICLR 2017
Figure 8: Training accuracy on MNIST after(a)45 (b) 304 (c) 2048 and (d) 13780 steps ofRMSProp
with learning rate 10-5.
18
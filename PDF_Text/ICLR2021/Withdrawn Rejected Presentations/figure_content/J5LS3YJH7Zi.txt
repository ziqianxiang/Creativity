Figure 1: A) Hierarchy of dynamical systems (Top). schema of calcium and Lorenz dynamics(Bottom). B) Schema of our hierarchical model. Latent dynamics model in blue, calcium dynamicsmodel in red.
Figure 2: A) Schematic for the process of converting spikes to calcium traces, and B) for the reachingtask. C) Rotational dynamics inferred from condition-averaged (Top) and single-trial spikes (Bot-tom) using LFADS. D) Rotational dynamics inferred from condition-averaged (Top) and single-trialcalcium traces (Bottom) using CaLFADS. E) Rotational dynamics inferred from condition-averaged(Top) and single-trial calcium traces (Bottom) using OASIS+LFADS. Traces are coloured based ontheir initial state values along jPC1 (from green to red for increasingly larger values)condition-averaged (Fig 2D - top) and single trials (Fig 2D - bottom). These results demonstratethat CaLFADS is capable of identifying latent dynamics in real neural data, similar to LFADS, evenwhen the spiking data is transformed by calcium dynamics and emissions noise. We also found thatthe OASIS+LFADS approach was not as successful as CaLFADS in uncovering rotational dynam-ics, explaining only half the variance (R2 = 0.53, Fig 2E). This result corroborates the importanceof the hierarchical modelling of calcium and neuronal dynamics in CaLFADS.
Figure 3: A) Schematic of 2-photon calcium imaging recording setup. Mice are head-fixed on arunning wheel under the imaging objective, and visual stimuli are projected onto a screen to the side,B) 2-photon calcium imaging recording plane, C) Schematic example of visual stimuli for expected(A-B-C-D-grey) and unexpected (A-B-C-E-grey) trials. D) Average recall (mean ± sem) of expectedvs. unexpected trials across non-linear decoders trained on principal components of fluorescencetraces (0.815 ± 0.011, green), Gaussian-LFADS factors (0.500 ± 0.000, blue), OASIS+LFADSfactors (0.810 ± 0.005, purple), and CaLFADS factors (0.871 ± 0.004, maroon). All pairs but one(fluor. vs. OASIS+LFADS factors, marked with n.s.) were significantly different at p < 0.05 in2-tailed independent t-tests with Bonferroni correction for multiple comparisons.
Figure S1: Directed acyclic graph for hierarchical model. Solid arrows denote deterministic map-pings, open arrows denote sampling steps.
Figure S7: Schema of the non-linear model trained to decode expected vs. unexpected stimulustrials. Example latent factors inferred by CaLFADS are plotted for an expected (blue) and an unex-pected (red) trial. Each stimulus frame (A, B, C, D/E, grey) is labelled, and its onset and offset inthe trial are marked with dotted lines. Latent factors are passed through GRU and linear modules(green), followed by a sigmoid decision function.

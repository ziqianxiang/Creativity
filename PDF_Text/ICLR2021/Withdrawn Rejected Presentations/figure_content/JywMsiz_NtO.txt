Figure 1: Left: Data generation process for molecule property prediction. Training and test envi-ronments are generated by controlling the scaffold variable. Middle: Scaffold is a subgraph of amolecular graph with its side chains removed. Right: In a toxicity prediction task (WU et al., 2018),there are 1600 scaffold environments with 75% of them having a single example.
Figure 2: A counterexample illustrating that ΦIRM 6⊆ ΦRGM .
Figure 3: a) Structured RGM: We introduce additional oracle predictors fe for the perturbed inputs;b) In molecule tasks, the scaffold classifier g is trained by negative sampling.
Figure 4: In the RGM forward pass, We sample a minibatch Be from each environment Ee andcompute regret Re(φ). In the backward pass, the gradient of Le(fe ◦ φ) goes through a gradientreversal layer (Ganin et al., 2016) which negates the gradient during back-propagation.
Figure 5: Examples of scaffolds in the QM9 dataset (highlighted in grey). We split the data based onscaffold complexity. Thus, the test scaffolds are structurally distinct from scaffolds in the training set.
Figure 6: QM9 ablation studybetween SRGM/RGM/CrossGrad and ERM. As shown in Figure 6, SRGM consistently outperformsCrossGrad and RGM across different setups.

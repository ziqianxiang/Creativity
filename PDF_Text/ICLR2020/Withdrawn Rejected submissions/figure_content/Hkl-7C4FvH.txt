Figure 1: The transformer VAE (trVAE) is an MMD-regularized CVAE. It receives randomizedbatches of data (x) and condition (S) as input during training, stratified for approximately equalproportions of s. In contrast to a standard CVAE, We regularize the effect of S on the representationobtained after the first-layer gι(z, S) of the decoder g. During prediction time, we transform batchesof the source condition Xs=o to the target condition Xs=ι by encoding Zo = f (xo, S = 0) anddecoding g(Zo, S = 1).
Figure 2: Comparison of representations for MMD-layer in trVAE and the corresponding layer in thevanilla CVAE using UMAP (McInnes et al., 2018). The MMD regularization incentivizes the modelto learn condition-invariant features resulting in a more compact representation. The figure shows thequalitative effect for the “PBMC data” introduced in experiments section 4.3. Both representationsshow the same number of samples.
Figure 3: Out-of-sample style transfer for MorPho-MNIST dataset containing normal, thin and thickdigits. trVAE successfully transforms normal digits to thin (a) and thick ((b) for digits not seen duringtraining (out-of-sample).
Figure 4: CelebA dataset with images in two conditions: celebrities without a smile and with a smileon their face. trVAE successfully adds a smile on faces of women without a smile despite thesesamples completely lacking from the training data (out-of-sample). The training data only comprisesnon-smiling women and smiling and non-smiling men.
Figure 5: (a) UMAP visualization of conditions and cell type for gut cells. (b-c) Mean and varianceexpression of 1,000 genes comparing trVAE-predicted and real infected TUft cells together with thetop 10 differentiall-expressed genes highlighted in red (R denotes Pearson correlation betweenground truth and predicted values). (d) Distribution of Defa24: the top response gene to H.poly.Day10infection between control, predicted and real stimulated cells for different models. Vertical axis:expression distribution for Defa24. Horizontal axis: control, real and predicted distribution bydifferent models. (e) Comparison of Pearson’s R2 values for mean and variance gene expressionbetween real and predicted cells for different models. Center values show the mean of R2 valuesestimated using n = 100 random subsamples for the prediction of each model and error bars depictstandard deviation. (f) Comparison of R2 values for mean gene expression between real and predictedcells by trVAE for the eight different cell types and three conditions. Center values show the meanof R2 values estimated using n = 100 random subsamples for each cell type and error bars depictstandard deviation.
Figure 6: (a) UMAP visualization of peripheral blood mononuclear cells (PBMCs). (b-c) Mean andvariance per 2,000 dimensions between trVAE-predicted and real natural killer cells (NK) togetherwith the top 10 differentially-expressed genes highlighted in red. (d) Distribution of ISG15: the moststrongly changing gene after IFN-β perturbation between control, real and predicted stimulated cellsfor different models. Vertical axis: expression distribution for ISG15. Horizontal axis: control, realand predicted distribution by different models. (e) Comparison of R2 values for mean and variancegene expression between real and predicted cells for different models. Center values show the meanof R2 values estimated using n = 100 random subsamples for the prediction of each model and errorbars depict standard deviation.

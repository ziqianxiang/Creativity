Figure 1: The overview of CausalTrans framework. Demand and supply are trained separately insequence. (a). The framework consists of three essential components: Fast S.F. (fast graph spatial fusion),C.A. (causal attention), and T.A. (temporal attention). Moreover, we employ the average quantile lossdistributed from {10%, 50%, 90%} to optimize forecasting probabilistic distributions. (b). The Fast S.F.
Figure 2: Supply, demand, delta and rainfall trends in city A ranging from January 1st, 2018 to January1st, 2020. On August 17th, 2018 (Friday), demand increased significantly under heavy rains and eveningpeak hours. Lack of supply was far from being able to meet explosive demand. At the night peak hours onSeptember 24th, 2018 (Mid-Autumn Festival), drivers’ number was reduced and demand increased due tofamily reunion. During the National Days (from October 1st to 7th, 2018), commuting drivers and passengersboth decreased, resulting in a bilateral decline of supply and demand. On December 7th, 2018 (Friday), heavysnow and low temperature stimulated potential demand. At the beginning of New Year’s Eve in 2019, peoplewere eager to reunite with families, resulting in low supply and high demand. After that, supply and demandtended to be balanced gradually.
Figure 3: The delta heat maps at different o’clock of city A on August 17th, 2018. Panels (a), (b) and (c) showdelta maps in peek hour 17:00pm, 18:00pm and 19:00pm, respectively. Delta values are normalized to (-100,0) for data privacy, where -100 and 0 means the maximum and minimum delta value, respectively. As theevening peak process was going on, supply was matched with demand along the direction of red arrows inpanels (a), (b) and (c) gradually.
Figure 4: Causal attention and probabilistic demand forecasting treated by rainfall in some days at aanonymous region in city A. A time slice means an hour. The black solid line is real demand time series, andorange solid line is temporal differences in next 24 hour slices. The green vertical line means a starting pointof forecasting, and subsequent green filled areas describe a confidence interval between quantile 10% and90%. According to causal attention, "AA group 1" and "AA group 2" (two red filled areas) are regardedas comparable contexts, as the first-order difference of both groups passes kpss(Kwiatkowski et al., 1992)stationary test (P > 0.05). "AB group 1" and "AB group 2" (two purple filled areas) is control group andtreatment group, respectively. Based on homologous hypothetical controlled experiments, causal attentionwith future weather information would be added in forecasting to learn inferences.
Figure 5:	Causal attention and probabilistic supply forecasting treated by demand in some days at ananonymous region in city A. The black solid line is real supply time series, while other lines and areas aresimilar with Figure 4. AA group 1 and AA group 2 (two red filled areas) are selected by causal attention,and both AA groups have analogous rainfall, the same weekday and time slots. Mean difference of both AAgroups in t-test is not significant. As rainfall can change demand and following demand changes supply,we estimate collaborative demand causal effects by adding rainfall causal effects. Fortunately, there are norainfall and holidays factors in evaluation periods (right-hand side of the green vertical line), and thereforewe can visualize the pure causal attention distributed in (0, 1).
Figure 6:	Time efficiency improvements on one-day demand prediction in city A. The numbers in bracketsmean logic cores in a chip. CPU(20) utilizes multiple processing to accelerate matrix multiplication. Thecomparison of GPU(1) and GPU(2) aims to demonstrate a possibility of applying powerful GPUs in realworld. Setting up (a) 3 heads and (b) 5 heads in multi-head attention is quite different. According to equation(9) and above bar plots, the less number of heads, the shorter running hours. Each running hour result isaveraged by using three independent experiments.

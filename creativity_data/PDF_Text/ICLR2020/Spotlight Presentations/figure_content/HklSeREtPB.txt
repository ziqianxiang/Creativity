Figure 1: Overview of head direction system in rodents, fruit flies, and the RNN model. a, c) tuningcurve of an example head direction (HD) cell in rodents (a, adapted from Taube (1995)) and fruitflies (c, adapted from Turner-Evans et al. (2017)). b, d) Tuning curve of an example angular velocity(AV) selective cell in rodents (b, adapted from Sharp et al. (2001)) and fruit flies (d, adapted fromTurner-Evans et al. (2017)). e) The brain structures in the fly central complex that are crucial formaintaining and updating heading direction, including the protocerebral bridge (PB) and the ellipsoidbody (EB). f) The RNN model. All connections within the RNN are randomly initialized. g) Aftertraining, the output of the RNN accurately tracks the current head direction.
Figure 2: Emergence of different functional cell types in the trained RNN. a) Joint HD*AV tuningplots for individual units in the RNN. Units are arranged by functional type (Compass, CCW Shifters,_CW Shifters). The activity of each unit is shown as a function of head direction (x-axis) and angularvelocity (y-axis). For each unit, AV ranges from -550 to 550 deg/s, and HD ranges from 0 to 360 deg.
Figure 3: Connectivity of the trained network is structured and exhibits similarities With the con-nectivity in the fly central complex. a) Pixels represent connections from the units in each columnto the units in each row. Excitatory connections are in red, and inhibitory connections are in blue.
Figure 4:	Probing the functional role of different classes of model neurons. a-j) Perturbation analysisin the case of maintaining a constant HD. a) Under normal conditions, the RNN output matches thetarget output. b) Population activity for the trial shown in a), sorted by the preferred HD and theclass of each unit, i.e., Compass units, CCW Shifters, CW Shifters. c-j) RNN output and populationactivity when a specific set of connections are set to zero during the period indicated by blue arrows ini) and j). k-v) Perturbation analysis in the case of a shifting HD. For each manipulation, CW rotationand CCW rotation are tested, resulting in two trials. k-n) Normal case without any perturbation. o-v)RNN output and population activity when connections from CW Shifters (o-r) and CCW Shifters(s-v) are set to zero. Refer to the main text for the interpretation of the results.
Figure 5:	Representations in the trained RNN vary as the input statistics change. a) The AVdistribution used to train the RNN in the low angular velocity condition. b) A histogram of the slopesof the AV tuning curves for individual units in the low AV condition. C) Heatmaps of the joint AV andHD tuning for each unit in the low AV condition. Units are arranged by functional type (Compass,CCW Shifters, CW Shifters). The activity of each unit is shown as a function of head direction(x-axis) and angular velocity (y-axis). d,e,f) Same convention as a-c, but for the main condition (f isthe same as Fig. 2a). g,h,i) Same convention as a-c, but for the high angular velocity condition.
Figure 6:	Tuning properties and unit classification. a) HD tuning curves for all 100 units in the RNNbased on the Main condition. Units are arranged by functional type (Compass, CCW Shifters, CWShifters). The activity of each unit is shown as a function of head direction. The 12 units at thebottom were not active, did not contribute to the network, and were not included in the analyses. All88 units with some activity were included in the analyses. b) Similar to a), but for AV tuning curves.
Figure 7:	Population summary of tuning shift and gain change when comparing the CW and CCWrotations. a) Population summary of tuning shift. b) Population summary of change of the peak firingrate of HD tuning curves.
Figure 8: Connectivity of the trained network. a) Pixels represent connections from the units in eachcolumn to the units in each row. Units are first sorted by functional classes, and then are furthersorted by their preferred HD within each class. Excitatory connections are in red, and inhibitoryconnections are in blue. b) Ensemble connectivity from each functional cell type. Plots show theaverage connectivity (shaded area indicates one standard deviation) as a function of the difference inpreferred HD.
Figure 9: Joint HD X AV tuning of the initial, randomly connected network and the final trainednetwork. a) Before training, the 100 units in the network do not have pronounced joint HD × AVtuning. The color scale is different for each unit (blue = minimum activity, yellow = maximumactivity) to maximally highlight any potential variation in the untrained network. b) After training,the units are tuned to HD × AV, with the exception of 12 units (shown at the bottom) which are notactive and do not influence the network.
Figure 10: Attractor structure of the trained network. To store angular information the neural activitysettles into a compass-like geometry, with the position along the compass determined by the angle.

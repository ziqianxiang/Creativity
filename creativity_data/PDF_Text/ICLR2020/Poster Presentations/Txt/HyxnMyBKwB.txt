Published as a conference paper at ICLR 2020
The Gambler’s Problem and Beyond
Baoxiang Wang	Shuai Li
Department of Computer Science and Engineering John Hopcroft Center for Computer Science
The Chinese University of Hong Kong	Shanghai Jiao Tong University
bxwang@cse.cuhk.edu.hk	shuaili8@sjtu.edu.cn
Jiajin Li
Department of SEEM
The Chinese University of Hong Kong
jjli@se.cuhk.edu.hk
Siu On Chan
Department of Computer Science and Engineering
The Chinese University of Hong Kong
siuon@cse.cuhk.edu.hk
Ab stract
We analyze the Gambler’s problem, a simple reinforcement learning problem
where the gambler has the chance to double or lose their bets until the target is
reached. This is an early example introduced in the reinforcement learning text-
book by Sutton & Barto (2018), where they mention an interesting pattern of
the optimal value function with high-frequency components and repeating non-
smooth points. It is however without further investigation. We provide the exact
formula for the optimal value function for both the discrete and the continuous
cases. Though simple as it might seem, the value function is pathological: fractal,
self-similar, derivative taking either zero or infinity, not smooth on any interval,
and not written as elementary functions. It is in fact one of the generalized Cantor
functions, where it holds a complexity that has been uncharted thus far. Our anal-
yses could lead insights into improving value function approximation, gradient-
based algorithms, and Q-learning, in real applications and implementations.
1 Introduction
We analytically investigate a deceptively simple problem, the Gambler’s problem, introduced in the
reinforcement learning textbook by Sutton & Barto (2018), on Example 4.3, Chapter 4, page 84. The
problem setting is natural and simple enough that little discussion was given in the book apart from
an algorithmic solution by value iteration. A close inspection will however show that the problem,
as a representative of the entire family of Markov decision processes (MDP), involves a level of
complexity and curiosity uncharted in years of reinforcement learning research.
The problem discusses a gambler’s casino game, where they places multiple rounds of betting. The
gambler gains the bet amount if they win a round or loses the bet if they lose the round. The
probability of losing each round is p ≥ 0.5, independently. The game ends when the gambler’s
capital reaches either their goal of N or 0. In each round, the gambler must decide what portion of
the capital to stake. In the discrete setting this bet amount must be an integer, but it can be a real
number in the continuous setting. To formulate it as an MDP, we denote state s be the current capital
and action a the bet amount. The reward is +1 when the state reaches s = N , and zero otherwise.
Our goal is to solve the optimal value function of the problem. We first give the solution to the
discrete Gambler’s problem. Denote N as the target capital, n as the current capital (which is the
state in the discrete setting), p > 0.5 as the probability of losing a bet, and γ as the discount factor.
The special case of N = 100, γ = 1 corresponds to the original setting in Sutton and Barto’s book.
1
Published as a conference paper at ICLR 2020
---p=0.6, gamma=1.0
---p=0.6, gamma=0.95
---p=O.7, gamma=1.0
---p=0.7, gamma=0.95
Figure 1: The optimal state-value function of the discrete Gambler’s problem.
Proposition 1. Let 0 ≤ γ ≤ 1 and p > 0.5. The optimal value function z(n) is v(n/N) in
the discrete setting of the Gambler's problem, where v(∙) is the optimal value function under the
continuous case defined in Theorem 12.
The above statement amounts the discrete problem to the continuous problem by a uniform dis-
cretization. The rest of the discussion will be on the more general continuous setting. In the setting,
the target capital is 1, the state space is [0, 1], and the action space is 0 < a ≤ min{s, 1 - s} at state
s, meaning that the bet can be any fraction of the current capital as long as the capital after winning
does not exceed 1. We state the optimal value function below and intuitive description of the value
function later in this section.
Theorem 12. Let 0 ≤ γ ≤ 1 andp > 0.5. Under the continuous setting of the Gambler's problem,
the optimal state-value function is v(1) = 1, and
v(s) = X(1 - p)γibi Y((1 - p) + (2p - 1)bj)	(1)
i=1	j=1
for 0 ≤ s < 1, where s = 0.b1b2 . . . b` . . .(2) is the binary representation of the state s.
Next, we solve the Bellman equation of the continuous Gambler’s problem. In the strictly discounted
setting 0 ≤ γ < 1, the solution of the Bellman equation f(0) = 0, f(1) = 1,
f(s) =	max (1 - p)γf(s + a) +pγf(s - a)
0<a≤min{s,1-s}
is f(s) = v(s) the optimal value function (Proposition 21).
This uniqueness does not hold in general. If the rewards are not discounted, the solution of the
Bellman equation is either the optimal value function, or a constant function larger than 1.
Theorem 22. Let Y = 1, P > 0.5, and f (∙) be a real function on [0,1]. f (S) solves the Bellman
equation if and only if either
•	f(s) is v(s) defined in Theorem 12, or
•	f(0) = 0, f(1) = 1, and f(s) = Cfor all 0 < s < 1, for some constant C ≥ 1.
Under the corner case of γ = 1, p = 0.5 (where the gambler do not lose capital in bets in expec-
tation), the problem involves the midpoint concavity (Sierpinski, 1920a;b) and Cauchy's functional
equation. The measurable function that solves the Bellman equation is uniquely f(s) = C0s + B0
on s ∈ (0, 1), for some constants C0 + B0 ≥ 1. Additionally, under Axiom of Choice, f(s) can also
be some non-constructive, non Lebesgue measurable function described by a Hamel basis (Theorem
27 and its lemmas).
2
Published as a conference paper at ICLR 2020
Figure 2: The optimal state-value function of the continuous Gambler’s problem.
Though the description of the Gambler’s problem seems natural and simple, Theorem 12 shows that
its simpleness is deceptive. The optimal value function is fractal and self-similar, and non-rectifiable
(see Corollary 14 and Lemma 8). It is thus not smooth on any interval, which can be unexpected
when a significant line of reinforcement learning studies is based on function approximation like
discretization and neural networks. The value function (1) can neither be simplified into a formula
of elementary functions, which introduces difficulties in understanding it. The function is monoton-
ically increasing with v(0) = 0 and v(1) = 1, but its derivative is 0 almost everywhere, which is
counterintuitive. This is known as singularity, a famous pathological property of functions. v(s) is
continuous almost everywhere but not absolutely continuous. Also when γ is strictly smaller than 1,
it is discontinuous on a dense and compact set of infinitely many points. These properties indicate
that assumptions like smoothness, continuity, and approximability are not satisfied in this problem.
In general, it is reasonable to doubt if these assumptions can be imposed in reinforcement learning.
To better understand the pathology of v(s), we analogize it to the Cantor function, which is well
known in analysis as a counterexample of many seemingly true statements (Dovgoshey et al., 2006).
In fact, v(s) is a generalized Cantor function, where the above descriptions are true for both v(s)
and the Cantor function.
Intuitive description of v(s). All the statements above require the definition of v(s). In fact, in
this paper, v(s) is important enough such that its definition will not change with the context. The
function cannot be written as a combination of elementary functions. Nevertheless, we give an
intuitive way to understand the function for the original, undiscounted problem. The function can
be regarded as generated by the following iterative process. First we fix v(0) = 0 and v(1) = 1, and
compute
v(1) = pv(0) + (1 - p)v(1) = (1 - p).
Here, v(2) is the weighted average of the two “neighbors” v(0) and v(1) that have been already
evaluated. Further, the same operation applies to v(4) and v(4), where v( 1) = pv(0) + (1 -
p)v( 1) = (1 — p)2 and v(44) = pv( 11) + (1 — p)v(1) = (1 — p) + p(1 — p), and so forth to
v( 1), v(8), etc. This process evaluates v(s) on the dense and compact set U'≥ι G' of the dyadic
rationals, where g` = {k2-' | k ∈ {1,... ,2' - 1}}. With the fact that v(s) is monotonically
strictly increasing, this dyadic rationals determines the function v(s) uniquely.
This iterative process can also be explained from the analytical formula of v(s). Starting with the
first bit, abitof0 will not change the value, while a bit of 1 will add (1-p) Qij-=11((1-p)+(2p-1)bj)
to the value. This term can also be written as (1 - p)((1 - p)#0 bits ∙ p#1 bits), where the number
of bits is counted over all previous bits. The value (1 - p)#0 blts ∙ p#1 blts decides the gap between
two neighbor existing points in the above process, when we insert a new point in the middle. This
insertion corresponds to the iteration on g` over '.
3
Published as a conference paper at ICLR 2020
We provide high resolution plots of z(n), N = 100 and v(s) in Figure 1 and Figure 2, respectively.
The non-smoothness and the self-similar fractal patterns can be clearly observed from the figures.
Also, v(s) is continuous when γ = 1 while v(s) is not continuous on infinitely many points when
γ < 1. In fact, When Y < 1, the function is discontinuous on the dyadic rationals S'≥ι G' while
continuous on its complement, as we will rigorously show later.
Self-similarity. The function v(s) on [s, s + 2-'] for any s = 0.b1b2 ...瓦⑵,' ≥ 1 is self-similar
to the function itself on [0,1]. Let S = 0.b1b2 ...b` …⑵ ∈ [s, s + 2-'], this can be observed by
v(s) = X(1 -p)γibi Y((1 -p) + (2p- 1)bj)
i=1	j=1
=X' (1-p)γibiiY-1((1-p)+(2p-1)bj)+γ'(Y' ((1-p)+(2p-1)bj))
i=1	j=1	j=1
× X∞ (1 - p)γi b'+i iY-1((1 - p) + (2p - 1)b'+j)
i=1	j=1
'
=v(s) + Y' Y((1 - P) + (2p - 1)bj) ∙ v(2'(s - s)).	(2)
j=1
The self-similarity can be compared with the Cantor function (Dovgoshey et al., 2006; Mandelbrot,
1985), which uses the ternary ofs instead in the formula. The Cantor function is self-similar to itself
on 恒,S + 3-`], when S = 0.b1b2... b'(3)and b` = 1. Both v(s) and the Cantor function can be
uniquely described by their self-similarity, the monotonicity, and the boundary conditions.
Optimal policies. It is immediate by Theorem 12 and Lemma 8 that
π(s) = min{s, 1 - s}
is one of the (Blackwell) optimal policies. Here, Blackwell optimality is defined as the uniform
optimality under any 0 ≤ Y ≤ 1. This policy agrees with the intuition that under a game that is in
favor of the casino (p > 0.5), the gambler desires to bet the maximum to finish the game in as little
cumulative bet as possible. In fact, the probability of reaching the target is the expected amount of
capital by the end of the game, which is negative linear to the cumulative bet.
The optimality is not unique though, for example, ∏(35)=+ is also optimal (for any γ). Under
Y = 1 the original, undiscounted setting, small amount of bets can also be optimal. Namely, when s
can be written in finite many bits s = b1b2 . . . b'(2) in binary (assume b' = 1), π(s) = 2-l is also an
optimal policy. This policy is by repeatedly rounding the capital to carryover the bits, keeping the
game to be within at most ` rounds of bets.
1.1	Preliminaries
We use the canonical formulation of the discrete-time Markov decision process (MDP), denoted as
the tuple (S, A, T, r, ρ0, Y). That includes S the state space, A the action space, T : S × A × S →
R+ the transition probability function, r : S → R the reward function, ρ0 : S → R+ the initial state
distribution, and Y ∈ [0, 1] the unnormalized discount factor. A deterministic policy π : S → A is a
map from the state space to the action space. In this problem, T(s, a, s - a) and T(s, a, s + a) are
p and 1 - p respectively for s ∈ S, a ∈ A, and T is otherwise 0.
Our goal is to solve the optimal value function of the Gambler’s problem. In this problem, the state-
value function is the probability of the gambler eventually reaching the target capital from a state.
The definition of the state-value function of an MDP with respect to state s and policy π is
fπ (s) = E X Ytrt 卜0 = s, at = ∏(st), St+1 〜T(st, at), r 〜Ir(St), t = 0,1, ....
t
When ∏* is one of the optimal policies, fπ*(s) is the optimal state-value function. Despite that
there may exist more than one optimal policies, this optimal state-value function is unique (Sutton
& Barto, 2018; Szepesvari, 2010).
4
Published as a conference paper at ICLR 2020
1.2	Implications
Our results indicate hardness on reinforcement learning (Papadimitriou & Tsitsiklis, 1987; Littman
et al., 1995; Thelen & Smith, 1998) and revisions of existing reinforcement learning algorithms. It
is worth noting that similar patterns of fractal and self-similarity have been observed empirically,
for example in Chockalingam (2019) for the Mountain Car problem. With these characterizations
being observed in simple problems like Mountain Car and the Gambler’s problem, our results are
expected to be generalized to a variety of reinforcement learning settings.
The first implication is naturally on function value function approximation, which is a developed
topic in reinforcement learning (Lee et al., 2008; Lusena et al., 2001). By the fractal property of
the optimal value function, that representation of such function must be inexact (Tikhonov, 2014).
When discretization is used for value function representation, the approximation error is at least
O(1/N), where N is the number of bins.
Proposition 19. When N ∈ N+, N ≥ 4 is a power of 2, let Vι(s) be piecewise constant on any of
the intervals s ∈ (k/N, (k + 1)/N), k = 0, . . . , N - 1, then
1 (2 -γ)(1 -p)γ	1
〃V(S)- v1 (S)I ds ≥ N —1-p— + o(N).
Alternatively, when a subclass of L-Lipschitz continuous is used to represent v(S), this error is then
at least (1/L) ∙ (1 - p)2γ2(1 - γ)2∕(4 - 4pγ) by the discontinuity of V(S) (Proposition 20). It is
worth remarking that despite this specific lower bound diminishes when γ is 1, the approximation
error is nonzero for an arbitrarily large L under γ = 1, as the derivative of V(S) can be infinite (Fact
16).
Notably, neural networks are within this family of functions, where the Lipschitz constant L is
determined by the network architecture. By the proposition, it is not possible to obtain the optimal
value function when a neural network is used, albeit the universal approximation theorem (Csaji,
2001; Dovgoshey et al., 2006; Levesley et al., 2007).
The second implication is by Theorem 12 and Fact 16 that the derivative ofV(S) is
lim V(S + 'O, lim "FS)
∆s→0+	∆S	∆s→0-	∆S
+∞,
0,
if S = 0 or S ∈ S'≥ ι G`,
otherwise.
This imposes that the value function’s derivative must not be exactly obtained, as it is 0 almost ev-
erywhere, except on the dyadic rationals g`, where it has a left derivative of infinity and a right
derivative of 0. Algorithms relying on ∂V(S)∕∂S and ∂Q(S, a)∕∂a (Lillicrap et al., 2015; Gu et al.,
2017; Heess et al., 2015; Fairbank & Alonso, 2012; Fairbank, 2008; Pan et al., 2019; Lim et al.,
2018), where Q(S, a) is the action-value function (Sutton & Barto, 2018), can suffer from the esti-
mation error or even have unpredictable behavior.
In practice, the boolean implementation of float numbers can further increase this error, as all points
S implemented are in g` for some '. A precise evaluation requires all these derivatives to be infinity
when a Leabague derivative is used (the average of left and right derivatives), which cannot be
obtained a computer system.
The third implication is on Q-learning (Mnih et al., 2015; Watkins & Dayan, 1992; Baird, 1995),
by Theorem 22 and its supporting lemmas. It is proved that when γ = 1, Q-learning has multiple
converging points, as the Bellman equation has multiple solutions, namely V(S) and
f(0) = 0, f(1) = 1, andf(S) = Cforall0 < S < 1,
for some constant C ≥ 1. Therefore, even when the Q-learning algorithm converges, it may not
converge to the optimal value function V(S). In fact, as the solution can be either the ground truth of
the optimal value function, or a large constant function, itis easier to approximate a constant function
than the optimal value function, resulting in a relatively lower Bellman error when converging to the
large constant.
This challenges Q-learning under γ = 1 when the return (cumulative reward) is unbiased. Though
the artificial γ is originally introduced to prevent the return from diverging, it can be also necessary
to prevent the algorithm from converging to a large constant in Q-learning, which is not desired.
5
Published as a conference paper at ICLR 2020
2 Discrete Case
The analysis of the discrete case of the Gambler’s problem will give an exact solution. It will also
explain the reason the plot on the book has a strange pattern of repeating spurious points.
The discrete case can be described by the following MDP: The state space is {0, . . . , N }; the action
space at n is A(n) = {0 < a ≤ min{n, N - n}}; the transition from state n and action a is
n - a and n + a with probability p and 1 - p, respectively; the reward function is r(N) = 1 and
r(n) = 0 for 0 ≤ n ≤ N - 1. The MDP terminates at n ∈ {0, N}. We use a time-discount factor
of 0 ≤ γ ≤ 1, where the agent receives γTr(N) rewards if the agents reaches the state n = N at
time T .
Let z(n), n ∈ N, 0 ≤ n ≤ N, be the value function. The exact solution below of the discrete case
is relying on Theorem 12, our main theorem which describes the exact solution of the continuous
case. This theorem will be discussed and proved later in Section A.1.
Proposition 1. Let 0 ≤ γ ≤ 1 and p > 0.5. The optimal value function z(n) is v(n/N) in
the discrete setting of the Gambler's problem, where v(∙) is the optimal value function under the
continuous case defined in Theorem 12.
Proof. We first verify the Bellman equation. By the definition of v(∙) We have
z(n) = v(n/N)
=	max	pγ v(n/N - a) + (1 - p)γ v(n/N + a)
0<a≤min{n∕N ,1—n/N }
≥	max	pγ v(n/N - a) + (1 - p)γ v(n/N + a)
一0<a≤min{n∕N ,1—n/N },Na∈N
=	max	pγ z (n - a) + (1 - p)γ z (n + a).
0<a≤min{n,N—n},a∈N
Meanwhile let a* = min{n, N - n}, Corollary 13 suggests that
z(n) = v (n/N)
= pγ v((n - a*)/N) + (1 - p)γ v((n + a*)/N)
= pγ z (n - a* ) + (1 - p)γ v(n + a* )
≤	max	pγ z(n - a) + (1 - p)γ z(n + a).
0<a≤min{n,N—n},a∈N
Therefore z(n) = maxo<a≤min{n,N—n},a∈N pγ z(n - a) + (1 - P)I z(n + a) as desired.
We then show that z(n) = v (n/N) is the unique function that satisfies the Bellman equation. The
proof is similar to the proof of Lemma 2, but the arguments will be relatively easier, as both the state
space and the action space are discrete. Let f (n) also satisfy the Bellman equation. We desire to
prove that f(n) is identical to z(n).
Define δ = maxι≤n≤N -1 f (n) — z(n). This maximum must exists as there are finite many states.
Then define the non-empty set S = {n | f(n) - z(n) = δ, 1 ≤ n ≤ N - 1}. For any n0 ∈ S and
a0 ∈ argmaxι≤n≤min{n0,N-n0} PY f(n0 - a) + (1 - P)Y f(n + a), we have
f(n0) = Pγ f(n0 - a0) + (1 - P)γ f(n0 + a0)
(▼)
≤ PY (z(n0 - a0) + δ) + (1 - P)Y (z(n0 + a0) + δ)
≤ PY z(n0 - a0) + (1 - P)Y z(n0 + a0) + δ
≤ z(n0) + δ
= f(n0).
As the equality holds, by the equality of (Y) we have n0 - a0 ∈ S and n0 + a0 ∈ S .
Now we specify some no ∈ S and ao ∈ argmax1≤n≤mE{n0,N—.}pγ f(no - a) + (1 -
P)Y f(n0 + a). Then, we have n0 - a0 ∈ S. Denote n1 = n0 - a0 and, recursively,
at ∈ argmax1≤n≤min{nt,N-nt} PY f (nt-a) + (1- P)Y f (nt + a) and nt+1 = nt - at, t = 1,2,…：
Since at ≥ 1 and nt ∈ N, there must exist a T such that nT = 0. Therefore, δ = f(nT)-z(nT) = 0.
6
Published as a conference paper at ICLR 2020
By the same argument S = maxι≤n≤N-ι z(n) - f (n) = 0. Therefore, z(n) and f (n) are identical,
as desired.
As z(n) is the unique function that satisfies the Bellman equation, it is the optimal value function of
the problem.	口
Proposition 1 indicates the discretization of the problems yields the discrete, exact evaluation of
the continuous value function at 0, 1/N, . . . , 1. If we omit the learning error, the plots on the
book and by the open source implementation (Zhang, 2019) are the evaluation of the fractal v(s) at
0, 1/N, . . . , 1. This explains the strange appearance of the curve in the figures.
3	Setting
We formulate the continuous Gambler’s problem as a Markov decision process (MDP) with the state
space S = [0, 1] and the action space A(s) = (0, min {s, 1 - s}], s ∈ (0, 1). Here s ∈ S represents
the capital the gambler currently possesses and the action a ∈ A(s) denotes the amount of bet.
Without loss of generality, we have assumed that the bet amount should be less or equal to 1 - s
to avoid the total capital to be more than 1. The consecutive state s0 transits to s - a and s + a
with probability p ≥ 0.5 and 1 - p respectively. The process terminates if s ∈ {0, 1} and the agent
receives an episodic reward r = s at the terminal state. Let 0 ≤ γ ≤ 1 be the discount factor.
Let f : [0, 1] → R be a real function. For f(s) to be the optimal value function, the Bellman
equation for the non-terminal and terminal states are
f(s) = max pγ f(s - a) + (1 - p)γ f(s + a) for any s ∈ (0, 1),	(A)
a∈A(s)
and
f(0) = 0, f(1) = 1.	(B)
It can be shown (later in Lemma 2 and Lemma 3) that a function satisfying (AB) must be lower
bounded by 0. A reasonable upper bound is 1, as the value function is the probability of the gambler
eventually reaching the target, which must be between 0 and 1. It is also reasonable to assume the
continuity of the value function at s = 0. Otherwise an arbitrary small amount of starting capital
will have at least a constant probability of reaching the target 1.1 Consequently the expectation of
capital at the end of the game is greater than the starting capital, which contradicts p ≥ 0.5. The
bounded version (X) of the problem leads to the optimal value function.
0 ≤ γ ≤ 1, p > 0.5, f(s) ≤ 1 for all s, f(s) is continuous on s = 0.	(X)
Respectively, the unbounded version (Y) of the problem leads to the solutions of the Bellman equa-
tion.
0 ≤ γ ≤ 1, p > 0.5.	(Y)
The results extend for p = 0.5 in general, except an extreme corner case of γ = 1, p = 0.5, where
the monotonicity in Lemma 3 will not apply. This case (Z) involves arguments over measurability
and the belief of Axiom of Choice, which we will discuss at the end of Section A.
γ = 1, p = 0.5, f(s) is unbounded.	(Z)
We are mostly interested in two settings: the first setting (ABX) and its solution Theorem 12, discuss
a set of necessary conditions of f(s) being the optimal value function of the Gambler’s problem. As
we show later the solution of (ABX) is unique, this solution must be the optimal value function. The
second setting (ABY) and its solutions in Proposition 21 and Theorem 22 discuss all the functions
that satisfy the Bellman equation. These functions are the optimal points that value iteration and
Q-learning algorithms may converge to. (ABZ) is interestingly connected some foundations of
mathematics like the belief of axioms, and is discussed in Theorem 27.
1This continuity assumption is only for a better organization of the settings. The more general problem
(AB) is solved in Section A.2 without this assumption.
7
Published as a conference paper at ICLR 2020
4	Analysis
The analysis section rigorously supports the statements on the Gambler’s problem and its Bellman
equation with proofs and discussions. It is deferred to the appendix due to the page limit.
5	Conclusion and Future Works
We give a complete solution to the Gambler’s problem, a simple and classic problem in reinforce-
ment learning, under a variety of settings. We show that its optimal value function is very compli-
cated and even pathological. Despite its seeming simpleness, these results are not clearly pointed
out in previous studies.
Our contributions are the theoretical finding and the implications. It is worthy to bring the cur-
rent results to start the discussion among the community. Indicated by the Gambler’s problem, the
current algorithmic approaches in reinforcement learning might underestimate the complexity. We
expect more evidence could be found in the future and new algorithms and implementations could
be brought out.
It would be interesting to see how these results of the Gambler’s problem generalized to other MDPs.
Finding these characterizations of MDPs is in general an important step to understand reinforcement
learning and sequential decision processes.
Acknowledgement
We thank Richard S. Sutton and Andrew Barto for raising the Gambler’s problem in their book, and
Rich S. Sutton for the discussions on our theorems and implications. We thank Andrej Bogdanov for
pointing out the connection to the Axiom of Choice, namely, Theorem 27, and Chengyu Lin for the
discussions on the properties of v(s), namely, Lemma 6, 8, and 9. This paper was largely improved
by the reviews and comments. We especially would like to thank Csaba Szepesvari, Kirby Banman,
and ICLR 2020 anonymous reviewers for their helpful feedback.
References
Leemon Baird. Residual algorithms: Reinforcement learning with function approximation. In
Machine Learning Proceedings 1995,pp. 30-37. EISeVier, 1995.
Valliappa Chockalingam. The role of interest in prediction and control, 2019. URL https://
youtu.be/aFXdpCDAG2g?t=395. The plot of the empirical optimal value function of the
Mountain Car problem first appears at 6:35. Some follow-up discussions start at 33:20.
BaIaZS CSanad Csaji. Approximation with artificial neural networks. Faculty ofSciences, Etvs Lornd
University, Hungary, 24:48, 2001.
Oleksiy Dovgoshey, Olli Martio, Vladimir Ryazanov, and Matt Vuorinen. The cantor function.
Expositiones Mathematicae, 24(1):1-37, 2006.
Michael Fairbank. Reinforcement learning by value gradients. arXiv preprint arXiv:0803.3539,
2008.
Michael Fairbank and Eduardo Alonso. Value-gradient learning. In The 2012 International Joint
Conference on Neural Networks (IJCNN), pp. 1-8. IEEE, 2012.
Shixiang Shane Gu, Timothy Lillicrap, Richard E Turner, Zoubin Ghahramani, Bernhard Scholkopf,
and Sergey Levine. Interpolated policy gradient: Merging on-policy and off-policy gradient esti-
mation for deep reinforcement learning. In Advances in neural information processing systems,
pp. 3846-3855, 2017.
Mance E Harmon and Leemon C Baird III. Spurious solutions to the bellman equation. Technical
Report, Wright-Patterson Air Force Base Ohio: Wright Laboratory, WL-TR-96-‘To Be Assigned’.,
1996.
8
Published as a conference paper at ICLR 2020
Nicolas Heess, Gregory Wayne, David Silver, Timothy Lillicrap, Tom Erez, and Yuval Tassa. Learn-
ing continuous control policies by stochastic value gradients. In Advances in Neural Information
Processing Systems, pp. 2944-2952, 2015.
Thomas J Jech. The axiom of choice. Courier Corporation, 2008.
Takashi Kamihigashi and Cuong Le Van. Necessary and sufficient conditions for a solution of the
bellman equation to be the value function: A general principle. Documents de travail du Centre
dEconomie de la Sorbonne 2015.07, 2015. ISSN: 1955-611X.
Peter Latham. Bellman’s equation has a unique solution, 2008. URL http://www.gatsby.
ucl.ac.uk/~mandana/RLRG/bellman_converges.pdf.
Wee S Lee, Nan Rong, and David Hsu. What makes some pomdp problems easy to approximate?
In Advances in neural information processing systems, pp. 689-696, 2008.
Jason Levesley, Cem Salp, and Sanju L Velani. On a problem of k. mahler: Diophantine approxi-
mation and cantor sets. Mathematische Annalen, 338(1):97-118, 2007.
Timothy P Lillicrap, Jonathan J Hunt, Alexander Pritzel, Nicolas Heess, Tom Erez, Yuval Tassa,
David Silver, and Daan Wierstra. Continuous control with deep reinforcement learning. arXiv
preprint arXiv:1509.02971, 2015.
Sungsu Lim, Ajin Joseph, Lei Le, Yangchen Pan, and Martha White. Actor-expert: A framework for
using action-value methods in continuous action spaces. arXiv preprint arXiv:1810.09103, 2018.
Michael L Littman, Thomas L Dean, and Leslie Pack Kaelbling. On the complexity of solving
markov decision problems. In Proceedings of the Eleventh conference on Uncertainty in artificial
intelligence, pp. 394-402. Morgan Kaufmann Publishers Inc., 1995.
Christopher Lusena, Judy Goldsmith, and Martin Mundhenk. Nonapproximability results for par-
tially observable markov decision processes. Journal of artificial intelligence research, 14:83-
103, 2001.
Benoit B Mandelbrot. Self-affine fractals and fractal dimension. Physica scripta, 32(4):257, 1985.
Volodymyr Mnih, Koray Kavukcuoglu, David Silver, Andrei A Rusu, Joel Veness, Marc G Belle-
mare, Alex Graves, Martin Riedmiller, Andreas K Fidjeland, Georg Ostrovski, et al. Human-level
control through deep reinforcement learning. Nature, 518(7540):529-533, 2015.
Yangchen Pan, Hengshuai Yao, Amir-massoud Farahmand, and Martha White. Hill climbing on
value estimates for search-control in dyna. arXiv preprint arXiv:1906.07791, 2019.
Christos H Papadimitriou and John N Tsitsiklis. The complexity of markov decision processes.
Mathematics of operations research, 12(3):441-450, 1987.
MJ Pelling. Formulae for the arc-length of a curve in rn. The American Mathematical Monthly, 84
(6):465-467, 1977.
WadaW Sierpinski. Sur -equation fonctionnelle f (x+ y)= f (x)+ f (y). Fundamenta Mathematicae,
1(1):116-122, 1920a.
WadaW Sierpinski. Sur les fonctions Convexes mesurables. Fundamenta Mathematicae, 1(1):125-
128, 1920b.
Richard S Sutton and AndreW G Barto. Reinforcement learning: An introduction. MIT press, 2018.
Csaba Szepesvari. Algorithms for reinforcement learning. Synthesis lectures on artificial intelli-
gence and machine learning, 4(1):1-103, 2010.
Esther Thelen and Linda B Smith. Dynamic systems theories. Handbook of child psychology, 1998.
Yu V Tikhonov. On the rate of approximation of singular functions by step functions. Mathematical
Notes, 95(3-4):530-543, 2014.
9
Published as a conference paper at ICLR 2020
Christopher JCH Watkins and Peter Dayan. Q-learning. Machine learning, 8(3-4):279-292, 1992.
Shangtong Zhang. Python implementation of Reinforcement learning: An in-
troduction, 2019.	URL https://github.com/ShangtongZhang/
reinforcement- learning- an- introduction.
A Analysis
A.1 Analysis of the Gambler’ s Problem
In this section we show that v(s) defined below is a unique solution of the system (ABX). Since
the optimal state-value function must satisfies the system (ABX), v(s) is the optimal state-value
function of the Gambler’s problem. This statement is rigorously proved in Theorem 12.
Let 0 ≤ γ ≤ 1 andp > 0.5. We define v(1) = 1, and
v(s) = X(1 - p)γibi Y((1 - p) + (2p - 1)bj)	(1)
i=1	j=1
for 0 ≤ s < 1, where s = 0.b1b2 . . . b` . . .(2) is the binary representation of s. It is obvious that the
series converges for any 0 ≤ s < 1.
The notation v(s) will always refer to the definition above in this paper and will not change with
the context. We show later that this v(s) is the optimal value function of the problem. We use
the notation f (s) to denote a general solution of a system, which varies according to the required
properties.
Let the set of dyadic rationals
g` = {k2-'∣ k ∈ {1,…，2' - 1}}	⑶
such that G' is the set of numbers that can be represented by at most' binary bits. The general idea
to verify the Bellman equation (AB) is to prove
v(s) =	max	(1 — ρ)γ v(s + a) + pγ v(s — a) for any S ∈ G'
a∈G'∩A(s)
by induction of ` = 1, 2, . . . , and generalize this optimality to the entire interval s ∈ (0, 1).
It then suffices to show the uniqueness of v(s) that solves the system (ABX). This is proved by
assuming the existence of a solution f (s) and derive the identity f (s) = v(s), condition on the
Bellman property that v(s) satisfies (AB). For presentation purposes, the uniqueness is discussed
first.
As an overview, Lemma 2, 3, and4 describe the system (ABX). Claim 5, Lemma 6, 8, and9 describe
the properties of v(s).
Lemma 2 (Uniqueness under existence). Let f(s) : [0, 1] → R be a real function. If v(s) and f(s)
both satisfy (ABX), then v(s) = f(s) for all 0 ≤ s ≤ 1.
Proof. We proof the lemma by contradiction. Assume that f(s) is also a solution of the system such
that f(s) is not identical with v(s) at some s. Define δ = sup0<s<1 f(s) — v(s). As f(2-1) ≥
(1 — p)γ f (1) + pγ f (0) = (1 — p)γ = v(2-1), We have δ ≥ 0.
We show that δ cannot be zero by contradiction. Ifδ is zero, as v(s) and f(s) are not identical, there
exists an S such that f (s) < v(s). In this case, let S = sup0<s<1 v(s) — f (s). Then we choose
e=(1 — pγ)δ and specify so such that v(so) — f (so) > δ — S. Let ao = min{s0,1 — s0}, we have
v(S0) = (1 — p)γ v(S0 — a0) + pγ v(S0 + a0)
≤ (1 — p)γ f(so — ao) + pγ f(so + ao) + pγδS
≤ f(so) + pγδS.
10
Published as a conference paper at ICLR 2020
The above inequality is due to at least one of S0 - a0 = 0 and S0 + a0 = 1 must hold. Thus at least
one of v(S0 - a0) - f(S0 - a0) and v(S0 +a0) - f(S0 +a0) must be zero. The inequality contradicts
v(so) - f (so) > S - e. Hence, δ cannot be zero. We discuss under δ > 0 for the rest of the proof.
Case (I): γ < 1. In this case, we choose = (1 - γ)δ. By the definition of δ we specify S0
such that f(S0) > v(S0) + δ - . In fact, the existence of S0 is by the condition γ < 1. Let
a0 ∈ argmaxa∈A(s0)pγ f(S0 - a) + (1 -p)γ f(S0 + a), we have
f(S0) = pγ f(S0 - a0) + (1 -p)γ f(S0 + a0)
≤ pγ (v(S0 - a0) + δ) + (1 - p)γ (v(S0 + a0) + δ)
= pγ v(S0 - a0) + (1 - p)γ v(S0 + a0) + γδ
≤ v(S0) + δ - .
The inequality f(S0) ≤ v(S0) + δ - contradicts f(S0) > v(S0) + δ - . Hence, the lemma is
proved for the case γ < 1.
Case (II): γ = 1. When there exists an S0 such that f(S0) - v(S0) = δ, we show the contradiction.
Let S = {s∣f (s) — V(S) = δ,0 < s < 1} = 0. For any s0 ∈ S and a0 ∈ argmaXα∈A(sθ) pγ f (s0 —
a) + (1 - p)γ f(S0 + a), we have
f(S0) = pγ f(S0 - a0) + (1 - p)γ f(S0 + a0)
=p f(S0 - a0) + (1 -p) f(S0 + a0)
(▼)
≤ p (v(S0 - a0) + δ) + (1 - p) (v(S0 + a0) + δ)
= p v(S0 - a0) + (1 - p) v(S0 + a0) + δ
(♦)
≤ v(S0) + δ.
Thus, the equality in (Y) and (♦) must hold. We specify s° ∈ S, and by the equality of (Y) We
have f(S0 - a0) = v(S0 - a0) + δ, thus S0 - a0 ∈ S. Let S1 = S0 - a0, and we recursively
specify an arbitrary at ∈ argmaxa∈A(st)(1 -p)γ f(St + a) +pγ f(St - a) and St+1 = St - at, for
t = 1, 2, . . . , until ST = 0 for some T, or indefinitely if such an ST does not exist. If ST exists and
the sequence {St} terminates at ST = 0, then f(ST) = v(ST) + δ = δ by (Y), Which contradicts
the boundary condition f(ST ) = f(0) = 0.
We desire to show the existence of T. When there exists t and ' such that St ∈ g`, by Corollary 7 we
have st+ι ∈ g` and inductively st，∈ g` for all t0 ≥ t. Consider that {st} is strictly decreasing and
there are finite many elements in g`, {st} cannot be infinite. Otherwise St ∈ g` for any t,' ≥ 1.
Then by Corollary 10 the uniqueness of optimal action we have st+ι = 2St - 1 if St ≥ 11, and
st+ι = 0 if St ≤ 2. After finite many steps of st+1 = 2st - 1 we will have St = 0 for some t.
It amounts to show the existence of S0 such that f(S0) - v(S0) = δ. By Lemma 9 we have the
continuity of v(s). Lemma 3 indicates the monotonicity of f(s) on [0, 1). The upper bound f(s) ≤
f(1) in (X) extends this monotonicity to the closed interval [0, 1]. Then by Lemma 4 we have the
continuity off(s) on (0, 1]. By (X) this extends to [0, 1]. Thus we have the continuity off(s) -v(s),
and consequently the existence of max0≤s0≤1 f(s0) - v(s0). As f(0) - v(0) = f(1) - v(1) = 0
and δ > 0, this maximum must be attained at some s0 ∈ (0, 1). Therefore we have the existence of
□
max0<s0<1 f(s0) - v(s0), which concludes the lemma.
Lemma 3 (Monotonicity). Let γ = 1 andp > 0.5. If a real function f(s) satisfies (AB) then f(s)
is monotonically increasing on [0, 1).
Proof. We prove the claim by contradiction. Assume that there exists S1 < S2 where f(S1) > f(S2).
Denote ∆S = S2 - S1 > 0 and ∆f = f(S1) - f(S2) > 0. By induction we have
f(S2 - 2-'∆s)- f(S2)≥ p'∆f
for an arbitrary integer ` ≥ 1. Then when S2 + 2-'∆s < 1, by f (s2) ≥ pf(s2 - 2-'∆s) + (1 -
p)f(s2 + 2-'∆s),
f (s2 + 2-'δS) ≤  -f (s2) -	—f (s2 - 2-'δS)
1-p	1-p
11
Published as a conference paper at ICLR 2020
=f(s2)+	— (f(s2)- f(S2 - 2-'∆s))
1-p
≤ f (S2)+ f (Sz)- f (S2 - 2-'δS).
This concludes f(s2 + 2-'∆s) - f (s2) ≤ f (s2) - f (s2 - 2-'∆s). By induction We have
f(S2 + k2-'∆s) - f(s2 + (k - 1)2-'∆s) ≤ f(s2 + (k - 1)2-'∆s) - f(s2 - (k - 2)2-'∆s)
for k = 1,2,..., when s2 + k2-`∆s < 1. We sum this inequality over k and get
f(s2 + k2-'∆s) - f (s2) ≤ k(f (s2) - f(s2 - 2-'∆s))
≤ -kp` ∆f .
By letting k = 2n, ' = n + n0, s2 + 2-n0 ∆s < 1, and n → 十∞, we have s2 + k2-'∆s < 1
and -kp'∆f → -∞. The arbitrarity of n indicates the non-existence of f (s2 + k2-`∆s), which
contradicts the existence of the solution f (∙).	□
Lemma 4 (Continuity). Let γ = 1 andp ≥ 0.5. If a real function f(S) is monotonically increasing
on (0, 1] and it satisfies (AB), then f(S) is continuous on (0, 1].
Proof. We show the continuity by contradiction. Suppose that there exists a point S0 ∈ (0, 1) such
that f(S) is discontinuous at S0, then there exists , δ > 0 where f(S0 + 1) - f(S0 - 2) ≥ δ for any
1 + 2 = . Then, by
12
f(s - 4 e) ≥ Pf(S - e) + (I - P) f(s + 4 e),
we have
f (s0 - 4e) - f (s0 - e) ≥ (1 - p)δ∕p.
Similarly, for k = 1, 2, . . . ,
f(s0 - 4ke) - f(s0 - 4k-ie) ≥ (1 - p)δ∕p∙
Let k > ((1 - p)δ∕p)-1, we have f (s0 - 1e) - f (s0 - e) ≥ 1. This contradict with the fact that
f(S) is bounded between 0 and 1. The continuity follows on (0, 1).
If the function is discontinuous on S = 1, then there exists e, δ > 0 where f(1) - f(1 - e1) ≥ δ for
any e1 ≤ e. The same argument holds by observing
f (1 - 2k-1 e) ≥ p f (1 - 2ke) ≥ f ⑴.
The lemma follows.	□
When f(S) is only required to be monotonically increasing on (0, 1), the continuity still holds but
only on (0, 1).
For simplicity define
Qv(S, a) = pγ v(S - a) + (1 - p)γ v(S + a).	(4)
As v(S) is the optimal state-value function (to be proved later in Theorem 12), Qv (S, a) is in fact the
optimal action-value function (Sutton & Barto, 2018; Szepesvari, 2010).
Recall that g` is the set of dyadic rationals {k2-' | k ∈{1,... ,2' - 1}}.
Claim 5. For any S = 0.b1b2... b'(2)∈ G' ∪ {0},
`
V(S + 2-('+1))	-	v(s)	= (1 - p)γ'+1 Y ((1 - p)	+	(2p	-	1)bj)	≤ (1 - p)p'γ'+1.	(5)
j=1
12
Published as a conference paper at ICLR 2020
For any S = 0'打...bk ⑵ ∈ g` with bk = 1 and 1 ≤ k ≤ ',
k-1
V(S) — V(S — 2-('+1)) ≥ p'-k+1(1 — p)γ'+1 Y ((1 — p) + (2p — 1)bj).	(6)
j=ι
Also,
v(1) — v (1 — 2-('+1)) ≥ p'+1γ'+1.	(7)
The equality of (6) and (7) holds if and only if Y = 1.
Proof. Inequality (5) and (7) are obtained by the definition of v(s). To derive inequality (6), denote
k = max {1 ≤ i ≤ ' : b = 0} and then
v(s) — V(S — 2-('+1))
k-1
(I ― P)Yk ∏((I ― p) + (2P T)bj)
j=i
2+1	k-1	i-1
—X (I-P)Yi ∙1 ∙ ∏((I-p) + (2p —1)%) ∙(1 — P) ∙ ∏ p
i=k+1	j=1	j=k+1
k-1	/	2+1
=(1 — P)Yk ∏((1 — p) + (2p — 1)bj) ∙ 1 — (1 — p) X Yi-kPi-I
j=1	∖	i=k+1
,k-	/	1 - (Yn)'-k + 1∖
=(1 — p)Yk ∏((1 — p) + (2p — 1)bj) ∙ (1 — (1 — p)Y ―IYP)YP	)
k-1
≥ (1 — P)Yk ∏((1 — P) + (2p — 1)bj) ∙ (1 — (1 — (Yp)'-k+1))
j=1
k-1
=(1 — p)p'-k+1Y'+1 ∏ ((1 — p) + (2p — 1)bj).
j=1
The arguments are due to the fact that S — 2-(`+1) = 0.b1b2... bk-10k 1k+1... 1'+1(2) and the
inequality is by (1 — P)Y ≤ 1 - Yp.	□
Lemma 6. Let' ≥ 1,0 < y ≤ 1,0.5 ≤ p < 1. For any S ∈ g`,
max
α∈(G'+ι ∖G')∩A(s)
Qv(s, a) ≤ max	Qv(s, a).
α∈ G' ∩A(s)
Proof. Case (I): First We prove that for ' > 1, any S ∈ g`, a ∈ g` ∩A(s), a > 2-', and S + a < 1,
Qv (s, a — 2-('+1)) ≤ max {Qv(s, a), QV (s, a — 2-')}.
Note that in this case, a — 2-('+1) ∈ G'+1 ∩ A(S) and a — 2-' ∈	G'	∩ A(s).
Let s — a = 0.c1 c2 ... c'(2) = 0.c1 c2 ... 0k 1k+1 ... 1'(2), where k	= max {1	≤	i	≤ ' : Ci	=	0}
is the index of the last 0 bit in S — a. Such k must exist since 0	≤	S - a ≤ 1 — 3 × 2-'	<	1.
Similarly, let S + a = 0.d1d2 ...d'(2) = 0.d1d2 ... 1k，⑵ where	k0	= max {1	≤	i	≤ ' : di	=	1}
is the index of the last 1 bit in S + a. Such k0 must exist since 3 × 2-' ≤ S + a < 1. Also,
s + a — 2 ('+1) = 0.d1d2 ... 0k，1k0+1 ... 1'+1(2).
To prove QV (s, a — 2-('+1)) ≤ QV(s, a), it is equivalent to prove
v(s + a) — v (s + a — 2-(2+1)) ≥
τj-P— (v (s — a + 2-('+1)) — v(s — a)).
13
Published as a conference paper at ICLR 2020
Then by applying inequality (6), (7) and inequality (5) in Claim 5 on the LHS and RHS respectively,
it suffices to prove
k0-1	2
p'-k (1 - P) ∏ ((1 — p) + (2p T)dj) ≥ ∏((1 — p) + (2p — 1)Cj)
j=ι	j=ι
k-1
=Pj (1 - p) ∏ ((1 - p) + (2p - 1)cj).
j=i
Let MC = c1 +-----+ Ck-ι,	Md = di +----+ dk-ι be the number of 1s in {c1,..., Ck}	,	{dι,..., dk}
respectively. Then QV (s, a - 2-('+1)) ≤ QV(s, a) holds when P = 0.5 or P > 0.5, MC + k ≥
Mb + k0.
To prove QV (s, a - 2-"1)) ≤ QV (s, a - 2-'), it is equivalent to prove
V (S - a + 2-') - V (S - a + 2-('+1)) ≥ 1--p (V (S + a - 2-('+1)) - V (S + a - 2-')).
Note that S — a + 2-' = 0.c1c2... 1k(2) and S + a — 2-' = 0.d1d2... 0k 1kz+ι... 1'(2). Then by
inequality (6), (7) and inequality (5) on the LHS and RHS respectively, it suffices to prove
k-1	k0-1
p'-k+2 ∏((1 -p) + (2p - 1)cj) ≥ (1 - p)2p'-k' ∏ ((1 - p) + (2p - 1)dj).
j=i	j=i
Then Qv (s, a - 2-('+1)) ≤ QV (s, a - 2-') holds whenP = 0.5 orP > 0.5, Mc+k0+2 ≥ Md+k.
As at least one of MC+k0+1 ≥ Md+k and Md+k ≥ MC+k0+1 holds, thus QV (s, a - 2-('+1)) <
max {Qv(s, a), QV (s, a - 2-')}.
We cover two corner cases for the completeness of the proof.
Case (II): Next We prove for ' ≥ 1, any S ∈ g`, a ∈ G' ∩ A(S) and S + a = 1,
Qv (s, a - 2-('+1)) ≤ Qv(s, a).
Similar to above, it is equivalent prove
v(1) - v (1 - 2-('+1)) ≥ ɪ-p- (v (s - a + 2-('+1)) - v(s - a)).
Note that by Claim 5,
v(1) - V (1 - 2-('+1)) ≥ p'+1γ'+1 = -P- ∙ (1 - p)p'γ'+1
1-p
≥ ɪ-p- (v (s — a + 2-('+1)) — v(s — a)),
which concludes the proof.
Case (III): Last we prove for ' > 1, any S ∈ g` and a = 2-', s < 1 - 2-'.
When s = 0.b1b2... 0m1m+1... 1'(2) with 1 ≤ m < ',to prove QV (s, 2-('+1)) ≤ QV (s, 2-'), it
is equivalent to prove
v (s + 2-') - v (s + 2-('+1)) ≥ Pp- (v (s - a + 2-('+1)) - v(s - a)).
In this case, S + 2-' = 0.b1b2... 1m(2), S - 2-' = 0.b1 b2... 0m 1m+1... 1'-1(2) and MC =
Md, k = k0 = m, thus Md + k ≥ MC + k0, which concludes the proof similar to the first part of the
(I) case.
When s = 0.b1b2... 1mz0加+1...。'⑵ with 1 ≤ m0 < ', let Mb = b1 + ... bm^. Then,
Qv 卜，2-m) - Qv 卜，2-('+1))
14
Published as a conference paper at ICLR 2020
=(1 - P)Y(V(S + 2-mj - V(S - 2-mj) - (1 - p)γ(v(s) - V(S - 2-mj)
—(1 — P)Y(V(S + 2-`) — v(s)) — PY(V(S — 2-') — v(s — 2-m ))
≥ (1 - P)Y(PY)Mb((1 -p)γ)m'-2-Mb(1 -P)Y - (1 -P)Y(PY)Mb((1- P)Y)m0-1-Mb(1 - P)Y
-(1 -P)Y(PY)Mb+1((1 -p)y)'-2-Mb(1 -p)y
-PY (py )Mb ((1 - P)Y)m'-Mb (1 + (py) + …(PY)'-m0-1)(1 - p)y
=PMb (1 - p)m0-Mb Ym，-PMb (1 - p)m' + 1-Mb γm +1 - PMb+ 1(1 - p)'-Mb γ'+l
-PMb+1(1 -p)m'+1-Mbγm'+2(1 - (pγ)'-m')/(1 -pγ)
≥ PMb (1 - p)m'-Mb Ym，-PMb (1 - p)m' + 1-Mb γm'+1 - PMb+ 1(1 - p)'-Mb γ'+1
-PMb+ 1(1 - p)m'-Mb γm' + 1(1 - (pγ)'-m ')
≥ - PMb+1(1 - p)'-Mbγ'+1 - PMb+1(1 - p)mO-Mbγm'+1(-(pγ)'-mj
≥ 0.	口
The arguments in the proof that either MC + k ≥ Md + k0 + 1 or Md + k0 ≥ MC + k must
hold is tight for integers MC and Md. This is the case for a ∈ G'+ι \ G'. When a ∈ G'+ι, this
sufficient condition becomes even looser. The lemma imposes g` to be the only set of possible
optimal actions, given S ∈ G'.
Corollary 7. Let' ≥ 1. For any S ∈ g`,
argmax Qv(s, a) ⊆ g`.
a∈A(s)
Now We verify the Bellman property on U'〉i G'.
Lemma 8. Let' ≥ 1. For any S ∈ G'+ι,
min(S, 1 — s} ∈ argmax Qv(s, a).
a∈ G'十ι ∩A(s)
Proof. We prove the lemma by induction over '. When ' = 1, it is obvious since Gi has only one
element. The base case ' = 2 is also immediate by exhausting a ∈ {2-i, 2-2} for S = 2-i. Now
we assume that for any S ∈ g`, min(s, 1 - s} ∈ argmaxα∈c^n/⑸ Qv (s, a). We aim to prove this
lemma for ' + 1.
For s ∈ G', by Lemma 6, argmaxα∈G^+「/(§)Qv (s, a) ⊆ g`. Then by the induction assumption,
min(s, 1 - s} ∈ argmaxa∈G'∩A(s) Qv(s, a) ⊆ argmax^Gg十「文)Qv(s, a). Hence, the lemma
holds for S ∈ g`. We discuss under S ∈ G'+i \ G' for the rest of the proof.
We start with two inductive properties of v(s) to reduce the problem from S ∈ G'+i to s0 ∈ g`,
where s0 is either 2s or 2s — 1. For any S ≥ 2-i, that is, S = 0.c1c2... C'+i(2)∈ G'+i with ci = 1,
V(S)= X(I- P)YiCi Y((I- P) + (2P T)Cj)
i=i	j=i
=(1 - P)Y + X(I- P)YiCi Y((I- P) + (2P -I)Cj)
i=2	j=i
'-i	i-i
=(1 - P)Y + X(I- P)Yi+iCi+i((I- P) + (2P -I)Ci) ∏((I- p) + (2P -I)Cj+i)
i=i	j=i
=(1 - p)γ + PY v(0.C2 . .. C'+i(2))
= (1 - P)Y + PY V(2s - 1).
Similarly, for any S < 2-i, that is, S = 0.qc2 ... C'+i(2)∈ G'+i with Ci = 0,
V(S) = X(I-P)2Yi+iCi+i ∏((1 -P) + (2P T)Cj+i)
i=i	j=i
15
Published as a conference paper at ICLR 2020
= (1 - p)γv(2s).
Armed with the properties, we split the discussion into four cases 2-1 + 2-2 ≤ s < 1, 2-1 ≤ s <
2-1 + 2-2, 2-1 - 2-2 < s < 2-1, and 0 < s ≤ 2-1 - 2-2.
When s ≥ 2-1 + 2-2, As a ≤ 1 - s, we have s - a ≥ 2-1 and s + a ≥ 2-1. Hence, the first bit
after the decimal of s - a and s + a is 1. Hence,
Qv(s, a) = pγ v(s - a) + (1 - p)γ v(s + a)
= (1 - p)γ2 + pγ (pγ v(2s - 2a - 1)) + (1 - p)γ v(2s + 2a - 1)
= (1 - p)γ2 + pγ (pγ v((2s - 1) - 2a) + (1 - p)γ v((2s - 1) + 2a))
= (1 - p)γ2 + pγ Qv (2s - 1, 2a).
As 2s - 1 ∈ g` and 2a ∈ g`, by the induction assumption the maximum of Qv (2s - 1,2a) is
obtained at a = 1 - s. Hence, 1 - s ∈ argmaxa∈G ∩A(s) Qv (s, a) as desired.
When 2-1 ≤ s < 2-1 + 2-2, if s - a ≥ 2-1, then first bit after the decimal of s - a and s + a is 1
and the lemma follows the same arguments as the above case. Otherwise, if s - a < 2-1, we have
Qv (s, a) = pγ v(s - a) + (1 - p)γ v(s + a)
= (1 - p)2γ2 + p(1 - p)γ2 v(2s - 2a) + p(1 - p)γ2 v(2s + 2a - 1)
= (1 - p)γ (pγ v((2s - 2-1) -(2a-2-1))+(1-p)γv((2s-2-1)+(2a-2-1)))
+ (1 - p)(2p - 1)γ2 v(2s + 2a - 1) + (1 - p)2γ2
= (1 - p)γ Qv (2s - 2-1 , 2a - 2-1 ) + (1 - p)(2p - 1)γ2 v(2s + 2a - 1) + (1 - p)2γ2 .
As 2s - 2-1 ∈ g` and 2a - 2-1 ∈ g` whenever l ≥ 2, by the induction assumption Qv (2s —
2-1, 2a - 2-1) obtains its maximum at a = 1 - s. By Claim 5, v(s) is monotonically increasing on
g` for any ' ≥ 2. Hence, v(2s + 2a - 1) obtains the maximum at the maximum feasible a, which
is a = 1 - s. Since both terms takes their respective maximum at a = 1 - s, we conclude that
1 - S ∈ argmaxα∈G'+1∩A(s) Qv (s, a) as desired.
The other two cases, 2-1 - 2-2 < s < 2-1 and 0 < s ≤ 2-1 - 2-2, follow similar arguments. The
lemma follows.	□
Lemma 9. Both v(s) and v0(s) = maxa∈A(s) Qv (s, a) are continuous at s if there does not exist
an ' such that S ∈ g`.
Proof. We first proof the continuity of v(s). For S = b1b2 ...b` .. .(2), s ∈ G' indicates that for any
integer N there exists n1 ≥ N such that bn1 = 1 and n0 ≥ N such that bn0 = 0. The monotonicity
ofv(S) is obvious from Equation (1) that flipping a 0 bit to a 1 bit will always yield a greater value.
For any S - 2-N ≤ S0 ≤ S + 2-N, we specify n1 and n0 such that S - 2-n1 ≤ S0 ≤ S + 2-n0. By
the monotonicity of v(S) we have
v(S) - v(S0) ≤ v(S) - v(S - 2-n1 )
n1 -1	∞	i-1
= (1-P)Yn Y ((1-p) + (2p - 1)bj) ∙ (1+ X Yi-n1 biP Y ((1-p) + (2p - 1)bj))
j=1	i=n1+1	j=n1+1
n1 -1	∞	i-1
-(1-p)Yn1 Y ((1-p)+(2p-1)bj) X Yi-n1bi(1-p) Y ((1-p)+(2p-1)bj)
j=1	i=n1+1	j=n1+1
n1 -1
= (1-P)Yn1 Y ((1- P) + (2p - 1)bj) ∙ (1
j=1
∞	i-1
+ X Yi-n1bi(2p-1) Y ((1-p)+(2p-1)bj))
i=n1 +1	j=n1 +1
∞
≤ (1 - P)YrnPn1 -1 ∙ (1+ X Yi-n1(2p - 1)pn1-iT)
i=n1 +1
16
Published as a conference paper at ICLR 2020
≤ 2(1 - p)γNpN-1 .
And similarly,
v(s) - v(s0) ≥ v(s) - v(s + 2-n0)
∞
≥ -(1 - P)YnOpn0τ.(1+ X γi-n0 (2p - 1)pn0-i-1)
i=n0 +1
≥ -2(1 - p)γNpN-1.
Hence, |v(s) - v(s0)| is bounded by 2(1 - p)γNpN-1 for s - 2-N ≤ s0 ≤ s + 2-N. As 2(1 -
p)γNpN-1 converges to zero when N approaches infinity, v(s) is continuous as desired.
We then show the continuity of v0(s) = maxa∈A(s) Qv(s, a). We first argue that v0(s) is monotoni-
cally increasing. In fact, for s0 ≥ s and 0 < a ≤ min{s, 1 - s}, either 0 < a ≤ min{s0, 1 - s0} or
0 < a + s - s0 ≤ min{s0, 1 - s0} must be satisfied. Therefore a ∈ A(s) indicates at least one of
a ∈ A(s ) and a + s - s ∈ A(s ).
Let a0 be a or a + s - s0 whoever is in A(s0), we have both s0 + a0 ≥ s + a and s0 - a0 ≥ s - a.
Specify a such that v0(s) = Qv (s, a), we have
v0(s0) ≥ Qv(s0, a0) ≥ v0(s).
The monotonicity follows.
Let s = b1b2 . . . b` . . .(2). Similarly, for any N, specify n1 ≥ N such that bn1 = 1 and n0 ≥ N + 2
such that bn0 = 0. Also let s0 = b1b2 . . . bN (2) . Then for the neighbourhood set s0 - 2-(N +1) ≤
s0 ≤ s0 + 2-(N +1), v0 (s) = v(s) for both the ends of the interval s0 - 2-(N +1), s0 + 2-(N +1) ∈
GN +ι. ∣v0 (s)-v0(s0)∣ is then bounded by ∣v(s0-2TN +1))-v(so+2-(N +1))∣. According to Claim
5, this value converges to zero when N approaches infinity. The continuity of v0(s) follows. □
The continuity of v(s) extends to the dyadic rationals U'≥ι G' when Y = 1, which means that v(s)
is continuous everywhere on [0, 1] under γ = 1. It worth note that similar to the Cantor function,
v(s) is not absolutely continuous. In fact, v(s) shares more common properties with the Cantor
function, as they both have a derivative of zero almost everywhere, both their value go from 0 to 1,
and their range is every value in between of 0 and 1.
The continuity of v0(s) = maxa∈A(s) Qv(s, a) indicates that the optimal action is uniquely
min{s, 1 - s} on s ∈ g`. This optimal action agrees with the optimal action We specified on S ∈ g`
in Lemma 8, which makes π(s) = min{s, 1 - s} an optimal policy for every state (condition on that
v(s) is the optimal value function, which will be proved later).
Corollary 10. If s / g` for any ' ≥ 1,
argmax Qv (s, a) = {min {s, 1 - s}} .
a∈A(s)
Lemma 11. v(s) is the unique solution of the system (ABX).
Proof. Let v0(s) = maxa∈A(s) Qv (s, a). As per Lemma 8 we have v(s) = v0(s) on the dyadic
rationals U'≥ι g`. Since U'≥ι G' is dense and compact on (0,1), v(s) = v0(s) holds whenever
both v(s) and v0(s) are continuous at s. By Lemma 9 v(s) and v0(s) are continuous for any s if there
does not exist an ' ≥ 1 such that S ∈ G', which then indicates v(s) = V(s) on the complement of
U'≥ι g`. Therefore v(s) = v0(s) is satisfied on (0,1), which verifies the Bellman property (AB).
The boundary conditions (X) holds obviously. Finally as per Lemma 2, v(s) is the unique solution
to the system of Bellman equation and the boundary conditions.	□
Theorem 12. Let 0 ≤ Y ≤ 1 andp > 0.5. Under the continuous setting of the Gambler’s problem,
the optimal state-value function is v(1) = 1 and v(s) defined in Equation (1) for 0 ≤ s < 1.
Proof. As the optimal state-value function must satisfy the system (ABX) and v(s) is the unique
solution to the system, v(s) is the optimal state-value function.	□
17
Published as a conference paper at ICLR 2020
Corollary 13. The policy π(s) = min{s, 1 - s} is (Blackwell) optimal.
It is worth noting that When Y = 1 and S ∈ g` ' G'-ι for some ', then π0(s) = 2-` is also an
optimal policy at s.
Theorem 12 and the proof of Lemma 8 and also induce the following statement that the optimal
value function v(s) is fractal and self-similar. The derivation of the corollary is in the introduction.
Corollary 14. The curve of the valuefunction v(s) on the interval [k2-', (k + 1)2-'] is similar (in
geometry) to the curve of v(s) itselfon [0,1] ,for any integer ' ≥ 1 and 0 ≤ k ≤ 2' 一 L
Some other notable facts about v(s) are as below:
Fact 15. The expectation
L V(S)ds = (I -P)Y = v(2).
Fact 16. The derivative
v(S + ∆S)	v(S + ∆S)	+∞,
lim	= 0, lim	= <
∆s→0+	∆S	∆s→0-	∆S	0,
if s = 0 or s ∈ U'≥ι G',
otherwise.
(8)
Fact 17. The length of the arc y = v(S), 0 ≤ S ≤ 1 equals 2.
In fact, any singular function (zero derivative a.e.) has an arc length of 2 (Pelling, 1977) if it go
from (0, 0) to (1, 1) monotonically. This can be intuitively understood as that the curve either goes
horizontal, when the derivative is zero, or vertical, when the derivative is infinity. Therefore the arc
length is the Manhattan distance between (0, 0) and (1, 1), which equals 2.
Fact 18.
2
argmin v(s) — S = {-}.
0≤s≤1	3
It is natural that by the fractal characterization of v(S) the approximation must be inexact. The
following two propositions give quantitative lower bounds on such approximation errors.
Proposition 19. When N ∈ N+, N ≥ 4 is a power of 2, let Vι(s) be piecewise constant on any of
the intervals S ∈ (k/N, (k + 1)/N), k = 0, . . . , N 一 1, then
1 (2 一 Y )(1 一 p)Y	1
Iv(S)- v1(S)I ds ≥ N--1-PY— + OlN).
s	pY
Proof. When N is a power of 2, for k ∈ {0, . . . , N - 1}, the curve ofv(S) on each of the intervals
(k/N, (k + 1)/N) is self-similar to v(S) itself on (0, 1). We consider this segment of the curve. By
Equation (2),
`
v(s) = v⑸+ γ' Y((1 — P) + (2p — 1)bj) ∙ v(2'(S — s)),
j=1
where ' = log2 N,S= k/N and S = 0.如b? ...b` …⑵ ∈ (s, s + N).
Let ∆S = 1/N, ∆y = v((k + 1)/N) — v(k/N), we have for 0 < S < ∆S
v(s + s) = v(s) + v(s∕∆s)∆y.
As v(S) is monotonically increasing on every interval (k/N, (k + 1)/N), the minimum over yS
s + ∆s
J s=s
Iv (S) — yS I dS
is obtained when y≤ = v(s + ɪ∆s) (intuitively, the median of v(s) on the interval). This results in
an approximation error of
s + ∆s
min
y JS=S
Iv (S) — yS I dS
18
Published as a conference paper at ICLR 2020
∕*s+ 2 δs	1	/3+δs	1
=	v(s + —∆s) — v(s) ds +	v(s) — V(S + -∆s) ds
JS=S	2 * *	S s=s+1 ∆s	2
Zs+ 2 ∆s	/S+∆s
v(s) ds +	v(s) ds
=S	Js=S+ 2 ∆s
11	1
=----∆s v(s) + (v(S+——∆s) — V(S))V(S) ds
2 s=0	2
11	1	1
+ χ∆s	v(s + -∆s) + (v(s + ∆s) - v(s + -∆s))v(s) ds
2 s=0	2	2
=1∆s((1 - (1 - P)Y)(V(S + 1∆s) - V(S)) + (1 - P)Y(V(S + ∆s) - V(S + 2∆s))).
This error is then summed over sS = 0, 1/N, . . ., (N - 1)/N such that
(N-1)/N .s+∆s	1	N - 1	1
E I	IV(S) - ys|ds ≥ 2N((1 - (1 -P)Y)v( N 2 ) + (1 -P)Y(I - v(2n)))
sS=0/N s=sS
2N((I-(I- P)Y)⅛≡⅛γ (I-(PY)log2N+1)
+(1-P)Y(1-((1-P)Y)log2N+1))
N-1 (2 - Y)(I - P)Y - N -1 + log2 pγ
1 - PY
-N-l+log2(l-p)γ (1 - P) Y
2
1 (2 - Y)(I - P)Y +c3
N 1 - PY + (N).
(1 - (1 - p)γ)p(1 - p)γ2
2(1 - pγ)
□
An error bound in O(1/N) can be generated to any integer N, as we can relax N to 2blog2 Nc-1 so
that at least one self-similar segment of size 1/N is included in each interval.
For Lipschitz continuous functions like neural networks, the following proposition shows an ap-
proximation error lower bound in O(1/L), where L is the Lipschitz constant.
Proposition 20. Let L ≥ (1 - P)Y(1 - Y)/(1 - PY). IfVS2(s) is Lipschitz continuous on s ∈ (0, 1)
where L is the Lipschitz constant, then
2
s
∣v(s)- V2(s)∣ ds ≥ 1(1 -p)2γ2(I-Y)
L
4(1 - pγ)
Proof. We consider v( 1) = (1 - P)Y and
lim V(s) = (I- PyY
s→ 2 -	1 - PY
When 0 < Y < 1, we have
v(1) - lim V(s) = (I - P)Y(I - Y) > 0.
2	s→2-	1 - PY
Denote h = (1 - P)Y(1 - Y)/(1 - PY). By the monotonicity of V(s), using VS2(s) to approximate
v(s) has an error at least Js ∣ξ(s) - V2(s)∣ ds, where ξ(s) denotes the step function on [0,1],
ξ(S) = 0h
0 ≤ s < 2,
2 ≤ S ≤ 1.
In this case, the optimal V2 (s) is
O 1-21-2
)
1-2
-
s
L(
+
O Δ2九
fjl
=
)
s
(
2
VS
≤ S < 1 - -h
≤ s < 2	2L ,
--h ≤ s ≤ 1 + -h
2L ≤ S ≤ 2 + 2L，
+ 2hL < S ≤ 1.
19
Published as a conference paper at ICLR 2020
Hence, we have
/ Iv(S) - v2(S)I ds ≥ / 归(S) - v2(S)I ds ≥ 匕,
as desired.
□
A.2 Analysis of the B ellman Equation
We have proved that v(S) is the optimal value function in Theorem 12, by showing the existence
and uniqueness of the solution of the system (ABX). However, the condition (X) is derived from the
context of the Gambler’s problem. It is rigorous enough to find the optimal value function, but we
are also interested in solutions purely derived from the MDP setting. Also, algorithmic approaches
such as Q-learning (Watkins & Dayan, 1992; Baird, 1995; Mnih et al., 2015) optimize the MDP by
solving the Bellman equation, without eliciting the context of the problem. Studying such systems
will help to understand the behavior of these algorithms. In this section, we inspect the system of
Bellman equation (AB) of the Gambler’s problem. We aim to solve the general case (ABY) where
p > 0.5 and the corner case (ABZ) where p = 0.5.
When p > 0.5, the value function v(S) is obviously still a solution of the system (ABY) without
condition (X). The natural question is if there exist any other solutions. The answer is two-fold:
When γ < 1, f(S) = v(S) is unique; when γ = 1, the solution is either v(S) or a constant function
at least 1. This indicates that algorithms like Q-learning have constant functions as their set of
converging points, apart from v(S). As v(S) is harder to approximate due to the non-smoothness, a
constant function in fact induces a smaller approximation error and thus has a better optimality for
Q-learning with function approximation.
It is immediate to generate this result to general MDPs, as function of a large constant solves MDPs
with episodic rewards. This indicates that Q-learning may have more than one converging points
and may diverge from the optimal value function under γ = 1. This leads to the need of γ, which
is artificially introduced and biases the learning objective. More generally, the Bellman equation
may have a continuum of finite solutions in an infinite state space, even with γ < 1. Some studies
exist on the necessary and sufficient conditions for a solution of the Bellman equation to be the
value function (Kamihigashi & Le Van, 2015; Latham, 2008; Harmon & Baird III, 1996), though
the majority of this topic remains open.
The discussions above are supported by a series of rigorous statements. We begin with the following
proposition that when the discount factor is strictly less than 1, the solution toward the Bellman
equation is the optimal value function.
Proposition 21. When γ < 1, v(S) is the unique solution of the system (ABY).
Proof. The uniqueness has been shown in Lemma 2 for the system (ABX). When γ < 1 it corre-
sponds to case (I), where neither the upper bound f(S) ≤ 1 nor the continuity at S = 0 in condition
(X) is used. Therefore Lemma 2 holds for (ABY) under γ < 1, so follows Lemma 11 the uniqueness
as desired.	□
This uniqueness no longer holds under γ = 1.
Theorem 22. Let Y = 1, p > 0.5, and f (∙) be a real function on [0,1]. f (s) satisfies the Bellman
equation (ABY) if and only if either
•	f(S) is v(S) defined in Theorem 12, or
•	f(0) = 0, f(1) = 1, and f(S) = Cfor all 0 < S < 1, for some constant C ≥ 1.
Proof. It is obvious that both f(S) defined above are the solutions of the system. It amounts to show
that they are the only solutions.
Without the bound condition (X), the function f(S) is not necessarily continuous on S = 0 and S = 1
and is not necessarily monotonic on S = 1. Therefore the same arguments in the proof of Lemma 2
will not hold. However, the arguments can be extended to (Y) by considering the limit of f(S) when
S approaches 0 and 1.
20
Published as a conference paper at ICLR 2020
By Lemma 4 the function is continuous on the open interval (0, 1). Let
C0 = lim f (s), C1 = lim f (s).
s→0+	s→1-
Then by Lemma 3, 0 ≤ C0 ≤ f(s) ≤ C1 for s ∈ (0, 1). Here we eliminate the possibility of
C0 = +∞ and C1 = +∞. This is because if there is a sequence of st → 0 such that f (st) > t,
then We have f (2) ≥ P f (st) + (1 - P) f(1 - St) ≥ (1 - p)t for any t. Then f (2) does not exist.
Similar arguments show that C1 cannot be +∞.
Now specify a sequence at → 1, at < 1, such that Co ≤ f (2 - at) ≤ Co + t and Ci - t ≤
f (2 + at) ≤ Ci. Then we have
f (2) ≥ Pf (2 - at) + (I - P) f(2 + at)
≥ P Co + (1 - P) Ci- 1.
As t is arbitrary we have f (t) ≥ pc + (1 - p)Ci. By induction on ' it holds on S ∈ Ug≥ι G' that
f(s) ≥ Co+(Ci - Co)v(s).
By Lemma 4 the continuity of f(S) and v(S) under γ = 1, this lower bound extends beyond the
dyadic rationals to the entire interval (0, 1). Define f(S) = Co + (Ci - Co)v(S) for S ∈ (0, 1),
f(0) = Co, f(1) = Ci. It is immediate to verify that for any Ci > Co ≥ 0, f(S) solves the system
(AY) (without (B) the boundary conditions).
If Ci - Co 6= 0, by Lemma 2 Case (II) f(S) on (0, 1) is the unique solution of the system (AY),
given monotonicity, continuity, and the lower bound f(s). With the boundary conditions (B), we
.	≈ , .	- .	-T , .	- .	. , .	, .	.	.
have 0 = f(0) = Co and 1 = f(1) = Ct, therefore f (s) = v(s). This case Ct - Co = 0 induces
the first possible solution.
It amounts to determine f(S) when Ci - Co = 0, that is, when 0 ≤ Co = f(S) = Ci for
S ∈ (0, 1) (by Lemma 3). It suffices to prove that Co < 1 is not possible. In fact, if Co < 1 then
f (3) < P f (2) + (1 -P)f (1), which contradicts (A). Then, f (s) = Co for some Co ≥ 1 is the only
set of solutions when Ci - Co = 0, as desired.	□
The fact that a large constant function can also be a solution toward the Bellman equation can be
extended to a wide range of MDPs. The below proposition lists one of the sufficient conditions but
even without this condition it is likely to hold in practice.
Proposition 23. For an arbitrary MDP with episodic rewards where every state has an action to
transit to a non-terminal state almost surely, f(S) = C for all non-terminal states S is a solution of
the Bellman equation system for any C greater or equal to the maximum one-step reward.
Proof. The statement is immediate by verifying the Bellman equation.	□
The rest of the section discusses the Gambler’s problem under P = 0.5, where the gambler does not
lose capital by betting in expectation. In this case, the optimal value function is still v(S) by similar
arguments of Theorem 12. It is worth noting that when γ = 1, Theorem 12 indicates v(S) = S. This
agrees with the intuition that the gambler does not lose their capital by placing bets in expectation,
therefore the optimal value function should be linear to S. Proposition 21 also holds that v(S) is the
unique solution of the Bellman equation, given γ < 1. The remaining problem is to find the solution
of the Bellman equation under γ = 1 andP = 0.5. This corresponds to the system (ABZ).
When P = 0.5, condition (A) implies midpoint concavity such that for all a ∈ A(S),
f (s) ≥ 2f(S - a) + 2f (S + a),	⑼
where the equality must hold for some a. As Lemma 3 no longer holds, a solution f(S) may have
negative values for some S. Though, ifit does not have a negative value, it must be concave, and thus
linear by condition (A) (will be proved later in Theorem 27). It suffices to satisfy f(S) ≥ S for any
21
Published as a conference paper at ICLR 2020
s. Therefore the non-negative solution is f(0) = 0, f(1) = 1, and f(s) = C0s + B0 on 0 < s < 1
for some constants C0 + B0 ≥ 1.
If f (s) does have a negative value at some s, then the midpoint concavity (9) does not imply con-
cavity. In this case, by recursively applying (9) we can show that the set {(s, f (s)) | s ∈ (0, 1)} is
dense and compact on (0, 1) × R. Then the function becomes pathological, if it exists. Despite this,
the following lemma shows that f (s) need to be positive on the rationals Q.
Lemma 24. Let f(s) satisfies (ABZ). If there exists 0 ≤ s- < s+ ≤ 1 and a constant C such that
f(s-), f(s+) ≥ C, then f(s) ≥ C for all s ∈ {s- + w(s+ - s-) | w ∈ Q, 0 ≤ w ≤ 1}.
Proof. The statement is immediate for w ∈ {0, 1}. For 0 < w < 1 we prove the lemma by
contradiction. Let f(s- + w(s+ - s-)) < C for some w ∈ Q while 0 < w < 1. We define
so = S- + w(s+ 一 s-) and st+ι = 2st — S- for St < 2(S- + s+) and st+ι = 2st 一 s+ for
St > 1 (S- + s+), respectively. st+ι will be undefined if St = 2(S- + s+). Since W ∈ Q,
let w = m/n where m and n are integers and the greatest common divisor gcd(m, n) = 1. Then
(St — s-)∕(s+ — s-) = mt/n, where mt = 2tm mod n. As Zn is finite, {St}t≥o can only take finite
many values. Thus either the sequence {s# is periodic, or it terminates at some St = 2(s- + s+).
Then We show that f (St) is strictly decreasing by induction. Assume that f (so) > .一> f (st).
When St < ɪ (s- + s+) ,by (9) we have f(st) ≥ 11 f(s-) + 11 f (st+ι), which indicates that f(st+ι)-
f(st) ≤ f (St) — f (s-) < f (so) — f (s-) < 0. When St > 1 (s- + s+), by (9) we have f(st) ≥
1 f(st+ι) + 1 f (s+), which indicates f (st+ι) — f(st) ≤ f(st) — f (s+) < f (so) — f (s+) < 0.
The base case f(s`) < f (so) holds as at least one of f (so) ≥ 1 f (s-) + 1 f(s`) and f (so) ≥
2f (si) + 1 f (s+) must be true. Thus we conclude that f (St) is strictly decreasing.
If the sequence terminates at some St = 2(S- + s+), then f (St) < f (si) < C, which contradicts
f (st) = f (2 (s- + s+)) ≥ 1 f (s-) + 2f (s+) ≥ C. Otherwise St is periodic and indefinite. Denote
the period as T we have f (st+τ) < f (St), which indicates f (St) < f (St) as a contradiction. □
Lemma 24 agrees with the statement that the midpoint concavity indicates rational concavity. The
below statements give some insights into the irrational points.
Lemma 25. Let f (s) satisfies (ABZ). Ifthere exists an s ∈ R \ Q such that f(s) ≥ 0, then f (s) ≥ 0
for all s ∈ {ws + U | w, u ∈ Q,0 ≤ w, u, ≤ 1, W + U ≤ 1}.
Proof. Specify s- =M and s+ = 1 in Lemma 24, we have f (s + wu+^(1 — s)) ≥ 0 whenever
0≤
wu+u ≤ 1 and wu+u
∈ Q. This is satisfied when 0 ≤ w, u ≤ 1, w + u > 0, w, u ∈ Q.
Specify s- = 0 and s+ = M+ w+u(1 — M) in Lemma 24, we have f (Wg + u) = f ((w + U)(M +
w+U (1 -M))) ≥ 0 whenever W + U ≤ 1. Thus f (ws + u) ≥ 0 for 0 < w, u < 1, w, U ∈ Q,
and 0 < W + u ≤ 1. Since the case W = u = 0 is immediate, the statement follows with
s ∈ {wsM + u | w, u ∈ Q, 0 ≤ w, u, ≤ 1, w + u ≤ 1}.
□
Corollary 26. Let f(s) satisfies (ABZ). If there exists an sM ∈ R \ Q such that f (sM) < 0, then f (wsM)
is monotonically decreasing with respect to wfor w ∈ Q, 1 ≤ w < 1/sM.
Lemma 25 and Corollary 26 indicate that when there exists a negative or positive value, infinitely
many other points (that are not necessarily in its neighbor) must have negative or positive values
as well. It is intuitive that the solution with a negative value, if it exists, must be complicated and
pathological. In fact, SierPinSki has shown that a midpoint concave but non-concave function is not
Lebesgue measurable and is non-constructive (Sierpinski, 1920a;b), so does f (s) if it solves (ABZ)
while having a negative value.
Such an f (s) exists if and only if we assume Axiom of Choice (Jech, 2008; Sierpinski, 1920a;b). We
consider the vector space by field extension R/Q. With the axiom specify a basis B = {1}∪{gi}i∈I,
known as a Hamel basis. With this basis B every real number can be written uniquely as a linear
combination of the elements in B with rational coefficients. Therefore, denote a real number s
uniquely as a vector (w, wi)i∈I, w, wi ∈ Q, such that s = w + Pi∈I wigi. We correspond each
f(s) = f 0(w, {wi}i∈I) uniquely to f0 defined on Q|B| and use the two spaces interchangeably.
22
Published as a conference paper at ICLR 2020
The solution f(s) to (9) is any concave function f0 on the vector space R/Q. Based on this solution
we extend the system (9) to (ABZ). To this end, f (s) need to attain the equality in (9) at every s,
which holds if and only if for every s = w+Pi∈I wigi there exists s1 = w1 +Pi∈I wi1gi and s2 =
w2 + Pi∈ι w2gi such that f0(λw1 + (1 - λ)w2, {λw1 + (1 - λ)w/}∈) is λf(s1) + (1 - λ)f(s2)
for any 0 < λ < 1 (intuitively, local linearity of f0 on at least one direction everywhere). By
specifying a B, the condition can be met if f (s) = f 0(w, {wi}i∈ι) = α(wj) + β(wj) for some
Wj ∈ {w} ∪ {wi | i ∈ I}, where α is a linear function, β is a concave function, and Wj denotes
{w} ∪ {wi | i ∈ I} \ {wj}. When wj is w, f(s) is in fact w + β({wi}i∈I) for some concave
function β. This is equivalent to specifying a function ω(s) : R → Q such that ω maps reals to
rationals additively ω(s1 + s2) = ω(s1) + ω(s2) and ω is not constantly zero, and then write f(s)
as ω(s) + β1(s - ω(s)) for some concave real function β1. Otherwise if wj is not w, f(s) is in the
aforementioned form with the boundary conditions (B).
While We have shown that under Axiom of Choice f (s) = α(wj-) + β(Wj) is a set of solutions
that can be described by the infinite-dimensional vector space R/Q and its basis, we do not know if
they are the only solutions. Nevertheless, combining our analysis and the literature we conclude the
following statement about the system (ABZ).
Theorem 27. Let γ = 1 andp = 0.5. A real function f(s) satisfies (ABZ) if and only if either
•	f(s) = C0s + B0 on s ∈ (0, 1), for some constants C0 + B0 ≥ 1, or
•	f(s) is some non-constructive, not Lebesgue measurable function under Axiom of Choice.
Proof. The first bullet correspond to the function f(s) that is non-negative on [0, 1]. By the midpoint
concavity (9) and the fact that f (s) is non-negative, f (s) is concave on [0,1] (Sierpinski, 1920a;b).
We specify s° = 2 .By (A) we have
f (SO) = 2f (SO - a0) + 2f (SO + a0)
for some a0. Since f(s) is concave, f(s) must be linear on the interval [s0 - a0, s0 + a0]. Consider
the nonempty set
A1 =	aO ∈ A(SO)
f (SO) = 2f (SO - a0) + 2f (SO + a0) p
We show by contradiction that SuP Ai is 2. If aι = sup Ai < ɪ, then by the continu-
ity a1 ∈ A1, where the continuity is implied by the convexity. This indicates that f(S) =
f (so) + f(s0+a12-f(s0-ai)(s - so) when s0 - ai ≤ S ≤ so + a> But as ai is the maximum
element of Ai, on at least one of the intervals [0, SO - ai) and (SO + ai] we have by the convexity
f (s) < f (so) + f(s0+a12-f(s0-aι) (s - so). Therefore, for at least one of S ∈ {so - ai, so + ai}
we have f (s) > ɪf (s - a) + 2f (s + a) for all a, which contradicts condition (A). Hence SuP Ai is
1, which implies that f (s) is linear on (0,1). Writing f (s) as C0s + B0, by the boundary condition
(B) we have C0 + B0 ≥ 1. Itis immediate to verify thatf(s) = C0s + B0 with C0 + B0 ≥ 1 is
sufficient to satisfy the system (ABZ), and is thus the non-negative solution of the system.
If f (s) is negative at some s, then by (9) and (B) f (s) must not be concave. By SierpinSki (1920a;b)
such an f(s) exists only if we assume Axiom of Choice, and is non-constructive and not Lebesgue
measurable if it exists (some discussion on this function is given above the statement of this theo-
rem).	口
23
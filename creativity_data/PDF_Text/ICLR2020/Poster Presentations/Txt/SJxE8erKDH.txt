Published as a conference paper at ICLR 2020
Latent Normalizing Flows for Many-to-Many
Cross-Domain Mappings
Shweta Mahajan, Iryna Gurevych, Stefan Roth
Department of Computer Science, TU Darmstadt, Germany
Abstract
Learned joint representations of images and text form the backbone of several im-
portant cross-domain tasks such as image captioning. Prior work mostly maps
both domains into a common latent representation in a purely supervised fash-
ion. This is rather restrictive, however, as the two domains follow distinct gen-
erative processes. Therefore, we propose a novel semi-supervised framework,
which models shared information between domains and domain-specific informa-
tion separately. The information shared between the domains is aligned with an
invertible neural network. Our model integrates normalizing flow-based priors for
the domain-specific information, which allows us to learn diverse many-to-many
mappings between the two domains. We demonstrate the effectiveness of our
model on diverse tasks, including image captioning and text-to-image synthesis.
1 Introduction
Joint image-text representations find applica-
tion in cross-domain tasks such as image-
conditioned text generation (captioning; Mao
et al., 2015; Karpathy & Fei-Fei, 2017; Xu
et al., 2018) and text-conditioned image synthe-
sis (Reed et al., 2016). Yet, image and text dis-
tributions follow distinct generative processes,
making joint generative modeling of the two
distributions challenging.
Current state-of-the-art models for learning
joint image-text distributions encode the two
Figure 1. Joint multimodal latent representation of im-
ages and texts of our LNFMM model for diverse many-
to-many mappings
domains in a common shared latent space in a fully supervised setup (Gu et al., 2018; Wang et al.,
2019). While such approaches can model supervised information in the shared latent space, they do
not preserve domain-specific information. However, as the domains under consideration, e.g. im-
ages and texts, follow distinct generative processes, many-to-many mappings naturally emerge -
there are many likely captions for a given image and vice versa. Therefore, it is crucial to also
encode domain-specific variations in the latent space to enable many-to-many mappings.
State-of-the-art models for cross-domain synthesis leverage conditional variational autoencoders
(VAEs, cVAEs; Kingma & Welling, 2014) or generative adversarial networks (GANs; Goodfellow
et al., 2014) for learning conditional distributions. However, such generative models (e.g., Wang
et al., 2017; Aneja et al., 2019) enforce a Gaussian prior in the latent space. Gaussian priors can
result in strong regularization or posterior collapse as they impose stringent constraints while mod-
eling complex distributions in the latent space (Tomczak & Welling, 2018). This severely limits the
accuracy and diversity of the cross-domain generative model.
Recent work (Ziegler & Rush, 2019; Bhattacharyya et al., 2019) has found normalizing flows (Dinh
et al., 2015) advantageous for modeling complex distributions in the latent space. Normalizing flows
can capture a high degree of multimodality in the latent space through a series of transformations
from a simple distribution to a complex data-dependent prior. Ziegler & Rush (2019) apply nor-
malizing flow-based priors in the latent space of unconditional variational autoencoders for discrete
distributions and character-level modeling.
1
Published as a conference paper at ICLR 2020
We propose to leverage normalizing flows to overcome the limitations of existing cross-domain
generative models in capturing heterogeneous distributions and introduce a novel semi-supervised
Latent Normalizing Flows for Many-to-Many Mappings (LNFMM) framework. We exploit normal-
izing flows (Dinh et al., 2015) to capture complex joint distributions in the latent space of our model
(Fig. 1). Moreover, since the domains under consideration, e.g. images and texts, have different gen-
erative processes, the latent representation for each distribution is modeled such that it contains both
shared cross-domain information as well as domain-specific information. The latent dimensions
constrained by supervised information from paired data model the common (semantic) information
across images and texts. The diversity within the image and text distributions, e.g. different visual or
textual styles, are encoded in the residual latent dimensions, thus preserving domain-specific vari-
ation. We can hence synthesize diverse samples from a distribution given a reference point in the
other domain in a many-to-many setup. We show the benefits of our learned many-to-many latent
spaces for real-world image captioning and text-to-image synthesis tasks on the COCO dataset (Lin
et al., 2014). Our model outperforms the current state of the art for image captioning w.r.t. the Bleu
and CIDEr metrics for accuracy as well as on various diversity metrics. Additionally, we also show
improvements in diversity metrics over the state of the art in text-to-image generation.
2	Related Work
Diverse image captioning. Recent work on image captioning introduces stochastic behavior in
captioning and thus encourages diversity by mapping an image to many captions. Vijayakumar
et al. (2018) sample captions from a very high-dimensional space based on word-to-word Hamming
distance and parts-of-speech information, respectively. To overcome the limitation of sampling from
a high-dimensional space, Shetty et al. (2017); Dai et al. (2017); Li et al. (2018) build on Gener-
ative Adversarial Networks (GANs) and modify the training objective of the generator, matching
generated captions to human captions. While GAN-based models can generate diverse captions by
sampling from a noise distribution, they suffer on accuracy due to the inability of the model to cap-
ture the true underlying distribution. Wang et al. (2017); Aneja et al. (2019), therefore, leverage
conditional Variational Autoencoders (cVAEs) to learn latent representations conditioned on images
based on supervised information and sequential latent spaces, respectively, to improve accuracy and
diversity. Without supervision, cVAEs with conditional Gaussian priors suffer from posterior col-
lapse. This results in a strong trade-off between accuracy and diversity; e.g. Aneja et al. (2019)
learn sequential latent spaces with a Gaussian prior to improve diversity, but suffer on perceptual
metrics. Moreover, sampling captions based only on supervised information limits the diversity in
the captions. In this work we show that by learning complex multimodal priors, we can model text
distributions efficiently in the latent space without specific supervised clustering information and
generate captions that are more diverse and accurate.
Diverse text-to-image synthesis. State-of-the-art methods for text-to-image synthesis are based on
conditional GANs (Reed et al., 2016). Much of the research for text-conditioned image generation
has focused on generating high-resolution images similar to the ground truth. Zhang et al. (2017;
2019b) introduce a series of generators in different stages for high-resolution images. AttnGAN (Xu
et al., 2018) and MirrorGAN (Qiao et al., 2019) aim at synthesizing fine-grained image features by
attending to different words in the text description. Dash et al. (2017) condition image generation on
class information in addition to texts. Yin et al. (2019) use a Siamese architecture to generate images
with similar high-level semantics but different low-level semantics.In this work, we instead focus on
generating diverse images for a given text with powerful latent semantic spaces, unlike GANs with
Gaussian priors, which fail to capture the true underlying distributions and result in mode collapse.
Normalizing flows & Variational Autoencoders. Normalizing flows (NF) are a class of density
estimation methods that allow exact inference by transforming a complex distribution to a simple
distribution using the change-of-variables rule. Dinh et al. (2015) develop flow-based generative
models with affine transformations to make the computation of the Jacobian efficient. Recent works
(Dinh et al., 2017; Kingma & Dhariwal, 2018; Ardizzone et al., 2019; Behrmann et al., 2019) extend
flow-based generative models to multi-scale architectures to model complex dependencies across
dimensions. Vanilla Variational Autoencoders (VAEs; Kingma & Welling, 2014) consider simple
Gaussian priors in the latent space. Simple priors can provide very strong constraints, resulting in
poor latent representations (Hoffman & Johnson, 2016). Recent work has, therefore, considered
modeling complex priors in VAEs. Particularly, Wang et al. (2017); Tomczak & Welling (2018)
2
Published as a conference paper at ICLR 2020
propose mixtures of Gaussians with predefined clusters, Chen et al. (2017) use neural autoregressive
model priors, and van den Oord et al. (2017) use discrete models in the latent space, which improves
results for image synthesis. Ziegler & Rush (2019) learn a prior based on normalizing flows to model
multimodal discrete distributions of character-level texts in the latent spaces with nonlinear flow
layers. However, this invertible layer is difficult to be optimized in both directions. Bhattacharyya
et al. (2019) learn conditional priors based on normalizing flows to model conditional distributions
in the latent space of cVAEs. In this work, we learn a conditional prior using normalizing flows
in the latent space of our variational inference model, modeling joint complex distributions in the
latent space, particularly of images and texts for diverse cross-domain many-to-many mappings.
3	Method
To learn joint distributions Pμ(χt, Xv) of texts and images that follow distinct generative processes
with ground-truth distributions pt(xt) and pv (xv), respectively, in a semi-supervised setting, we
formulate a novel joint generative model based on variational inference: Latent Normalizing Flows
for Many-to-Many Mappings (LNFMM). Our model defines a joint probability distribution over the
data {xt, xv} and latent variables Z with a distribution Pμ(χt, Xv, Z) = Pμ(χt, Xv ∣z)p*(z), parame-
terized by μ. We maximize the likelihood of Pμ(xt, Xv) using a variational posterior q®(z∣xt, xv),
parameterized by variables θ. As we are interested in jointly modeling distributions with distinct
generative processes, e.g. images and texts, the choice of the latent distribution is crucial. Mapping
to a shared latent distribution can be very restrictive (Xu et al., 2018). We begin with a discussion
of our variational posterior q® (z|xt, xv) and its the factorization in our LNFMM model, followed
by our normalizing flow-based priors, which enable q®(z|xt, Xv) to be complex and multimodal,
allowing for diverse many-to-many mappings.
Factorizing the latent posterior. We choose a novel factorized posterior distribution with both
shared and domain-specific components. The shared component Zs is learned with supervision from
paired image-text data and encodes information common to both domains. The domain-specific
components encode information that is unique to each domain, thus preserving the heterogeneous
structure of the data in the latent space. Specifically, consider Zt and Zv as the latent variables to
model text and image distributions. Recall from above that Zs denotes the shared latent variable for
supervised learning, which encodes information shared between the data points xt and xv . Given
this supervised information, the residual information specific to each domain is encoded in Zt0 and Zv0 .
This leads to the factorization of the variational posterior of our LNFMM model with Zt = [Zs Zt0]
and Zv = [Zs Zv ],
logq®(Zs, Zt0, Zv0 |xt, xv) = logq®1(Zs|xt,xv) + logq®2(Zt0|xt, Zs) + log q®3 (Zv0 |xv, Zs).	(1)
Next, we derive our LNFMM model in detail. Since directly maximizing the log-likelihood of
Pμ(xt, Xv) with the variational posterior is intractable, We derive the log-evidence lower bound for
learning the posterior distributions of the latent variables Z = {Zs, Zt0, Zv0 }.
3.1	Deriving the Log-Evidence Lower Bound
Maximizing the marginal likelihood pμ (xt, Xv) given a set of observation points {xt, Xv} is gen-
erally intractable. Therefore, we develop a variational inference framework that maximizes a vari-
ational lower bound on the data log-likelihood - the log-evidence lower bound (ELBO)with the
proposed factorization in Eq. (1),
log Pμ(xt,xv ) ≥ Eqθ(z∣χt,χv) [log pμ(xt,xv |z)] + Eqθ (z∣χt,Xv ) [log Pφ(z) - log qθ (ZIXt,xv )],
(2)
where Z = {Zs , Zt0 , Zv0 } are the latent variables. The first expectation term is the reconstruction
error. The second expectation term minimizes the KL-divergence between the variational posterior
q®(Z|xt, xv) and a prior pφ(Z). Taking into account the factorization in Eq. (1), we now derive the
ELBO for our LNFMM model. We first rewrite the reconstruction term as
Eqθ (Zs ,z0 ,zV ∣xt,Xv ) [ log pμ (xt |zs ,zt,zv ) + log pμ (Xv |zs ,zt, zv )] ,	(3)
3
Published as a conference paper at ICLR 2020
which assumes conditional independence given the domain-specific latent dimensions zt0 , zv0 and the
shared latent dimensions zs. Thus, the reconstruction term can be further simplified as
Eqθi (zs ∣Xt,Xv)qθ2 (z0∣xt,zs) [ log pμ (XtIzs, Zt)] + Eqθ1 (zs∣Xt,Xv )qθ3 (z/v ∣Xv,Zs) [ log pμ (XvIzs, zv )] . (4)
Next, we simplify the KL-divergence term on the right of Eq. (2). We use the chain rule along with
Eq. (1) to obtain
DKL	qθ(zs,	zt0,zv0 IXt,Xv)	pφ(zs, zt0,zv0)	=	DKL	qθ1 (zs IXt,	Xv)	pφs(zs)	+	(5)
DKL(qθ2(z0lχt,zs) Il Pφt (z0lzs)) + DKL(qθ3(zv|xv,zs) Il Pφv (ZvIzs)).
This assumes a factorized prior of the form pφ(zs, zt0, zv0 ) = pφs (zs)pφt (zt0Izs)pφv (zv0 Izs), consistent
with our conditional independence assumptions, given that information specific to each distribution
is encoded in {zt0, zv0 }. The final ELBO can then be expressed as
log Pμ (Xt, Xv ) ≥ Eqθ1 (Zs ∣Xt,Xv )qθ2 (Zt ∣Xt,Zs)[ log Pμ (Xt । zs , z0)]
+Eqθ1 (zs ∣χt,χv)qθ3 (z),j|xv,zs) [ logpμ(Xv |zs, zv)] - DKL (qθι (zs |Xt, Xv)1 pφs (zs)) (6)
-DKL(qθ2 (z0 |Xt,zs ) 11 Pφt (z0 Izs)) - DKL (qθ3 (ZvIXv ,zs) 11 Pφν (zv Izs)).
In the standard VAE formulation (Kingma & Welling, 2014), the priors corresponding to pφt (zt0Izs)
and pφv (zv0 Izs) are modeled as standard normal distributions. However, Gaussian priors limit the
expressiveness of the model in the latent space since they result in strong constraints on the posterior
(Tomczak & Welling, 2018; Razavi et al., 2019; Ziegler & Rush, 2019). Specifically, optimizing with
a Gaussian prior pushes the posterior distribution towards the mean, limiting diversity and hence
generative power (Tomczak & Welling, 2018). This is especially true for complex multimodal image
and text distributions. Furthermore, alternatives like Gaussian mixture model-based priors (Wang
et al., 2017) also suffer from similar drawbacks and additionally depend on predefined heuristics
like the number of components in the mixture model. Analogously, the VampPrior (Tomczak &
Welling, 2018) depends on a predefined number of pseudo-inputs to learn the prior in the latent
space. Similar to Ziegler & Rush (2019); Bhattacharyya et al. (2019), which learn priors based on
exact inference models, we propose to learn the conditional priors pφt (zt0Izs) and pφv (zv0 Izs) jointly
with the variational posterior in Eq. (1) using normalizing flows.
3.2	Variational Inference with Normalizing Flow-based Priors
Normalizing flows are exact inference models, which can map simple distributions to complex den-
sities through a series of Kt invertible mappings,
fφt = fKt ◦ fKt-1。…。fφt.
This allows Us to transform a simple base density E 〜P(E) to a complex multimodal conditional
prior pφt(zt0Izs) (and correspondingly to pφv (zv0 Izs)). The likelihood of the latent variables under
the base density can be obtained using the change-of-variables formula. A composition of invertible
mappings fφi , parameterized by parameters φt, is learned such that E = fφ-1 (zt0Izs). The log-
likelihood with Jacobian Jφt = dfΦt∕∂fφ-1, assuming fφt = I is the identity, can be expressed
as
logPφt(z0Izs) = logp(fφt1(z0Izs)) - log ∣det dzt-∣
Kt
(7)
log p(fφt1(z0 Izs)) - ElogIdet Ji t∣.
Using data-dependent and non-volume preserving transformations, multimodal priors can be jointly
learned in the latent space, allowing for more complex posteriors and better solutions of the evidence
lower bound. Using Eq. (7), the ELBO with normalizing flow-based priors can be expressed by
rewriting the KL-divergence terms in Eq. (6) as (analogously for the other term)
Kt
DKL(qθ2 (z0 IXt,zs) I pit (z0Izs)) = - Eqθ2 (ζ0∣χt,ζs) log p(fφt1(z0 Izs)) — X log ∣det Ji t∣	,ο,
i=1	(8)
+ Eqθ2 (z01xt,zs ) [ log qθ2 (ZO iXt, zs)] ∙
4
Published as a conference paper at ICLR 2020
Next, we describe our complete model for learning joint distributions with latent normalizing flows
using Eqs. (6) and (8), which enables many-to-many mappings between domains.
3.3	Latent Normalizing Flow Model for Many-to-Many Mappings
We illustrate our complete model in Fig. 2. It consists
of two domain-specific encoders to learn the domain-
specific latent posterior distributions qe2(z0∣xt,zs) and
qθ3 (zV∣χt,Zs). As the shared latent variable Zs en-
codes information common to both domains, it holds that
qθι (ZsIxt,Xv) = qθι (ZsIxt) = qθι (ZsIxv) for a match-
ing pair of data points (xt,xv). Therefore, each encoder
must be able to model the common supervised informa-
tion independently for every matching pair (xt, xv). We
enforce this by splitting the output dimensions of each
encoder into Zv = [zs Zv ] and Zt = [zs z0], respectively
(cf. Eq. 1), and constraining the supervised latent dimen-
sions to encode the same information. We assume that
the shared latent code Zs has d0 dimensions. We pro-
pose to learn the posterior distribution qe】(Zs ∣xt, xv) as
the shared latent space between two domain-specific au-
toencoders. One simple method to induce sharing is by minimizing the mean-squared error between
the encodings. However, this is not ideal given that xt and xv follow different highly multimodal
generative processes. We, therefore, learn an invertible mapping fφs : Rd0 → Rd0 with invertible
neural networks such that the d0-dimensional latent code Zs can be transformed between the domains
v and t. Let Zv with d ≥ d0 dimensions be the encoded latent variable for distribution pv (xv ). A
bijective mapping fφs : (Zv)d0 7→ (Zt)d0 is learned with an invertible mapping analogous to Eq. (7)
as
f
Image
Encoder
Image
Decoder
K
flow
layers
Kv
flow
layers
Xy
P 机(z;| Z)
f
Tog P(Xt)
Figure 2. Our LNFMM architecture
flow
layers
I--L>
Tog p(XJ
f
PGt(z;| Z)
K
logqθ1(ZsIxt,xv) = log qθ1 (Zv)d0Ixt,xv = log qθ1 fφs ((Zv)d0)Ixt + log det Jφi s . (9)
i=1
Here, (∙)do denotes restricting the latent code to the d0-dimensional shared part. fφs is an invertible
neural network with affine coupling layers (Dinh et al., 2015), i.e. fφs = fK ◦ fK-1 ◦…。fφs.
This makes it easy to compute Jacobians Jφis = df≠s∕∂fιi-1 formulated as triangular matrices for the
layers of the invertible neural network. Again, we assume that fφ0 = I is the identity.
The number of dimensions for domain-specific information, i.e. the dimensionality of Zt0 and Zv0 ,
can be different for the two domains, depending on the complexity of each distribution. Note that
by conditioning on the dimensions with a supervision signal, we minimize the redundancy in the
dimensions for unsupervised information without disentangling the dimensions. The multimodal
conditional prior in qθ2 (Zt0IZs, xt) and qθ3 (Zv0 IZs, xv) is modeled with non-volume-preserving nor-
malizing flow models with Eq. (7) (Dinh et al., 2017), parameterized by φt and φv, respectively.
The data log-likelihood terms in Eqs. (4) and (6) are defined as the (negative) reconstruction er-
rors. Let gθv : xv 7→	Zv with θv = {θ1, θ3} and gθt : xt	7→	Zt	with θt	=	{θ1, θ2}	de-
note the image and text	encoders, respectively. Further, hωv :	Zv	7→	xv and	hωt : Zt 7→	xt
are the decoders with parameters ωv and ωt corresponding to images and texts, respectively, with
xv = hωv (gev (xv)) and xt = hωt (gθt (xt)) denoting the decoded image and text samples. For
texts, we consider the output probability of the jth word (xt)j of the ground-truth sentence xt
given the previous reconstructed words (xt)0j_1 from the text decoder, and define the recon-
struction error as LreC(Xt, xt) = - PjlogPμ((xt)j∣(xt)0j_1). For images, the reconstruction
loss between the input image xv and reconstructed image xv from the image decoder is taken as
LreC(Xv,xv) = ∣∣xv - xvk, where ∣∣ ∙ k is either the '1 or '2 norm. Furthermore, in Eq. (9) we
define log qθ1 (fφs ((Zv)d0)∣xt) as the cost of mapping (Zv)d0 to the latent space of texts under the
transformation fφs ; we use the mean-squared error between the encoded text representations (Zt)d0
and the transformed image representation fφs ((Zv )d0 ) of the paired data (xt, xv) (see Ardizzone
et al., 2019).
5
Published as a conference paper at ICLR 2020
Method	B-4	B-3	B-2	B-1	C	R	M	S
CVAE (baseline)*	0.309	0.376	0.527	0.696	0.950	0.538	0.252	0.176
Div-BS (Vijayakumar et al., 2018)	0.402	0.555	0.698	0.846	1.448	0.666	0.372	0.290
POS (Deshpande et al., 2019)	0.550	0.672	0.787	0.909	1.661	0.725	0.409	0.311
AG-CVAE (Wang et al., 2017)	0.557	0.654	0.767	0.883	1.517	0.690	0.345	0.277
Seq-CVAE (Aneja et al., 2019)	0.575	0.691	0.803	0.922	1.695	0.733	0.410	0.320
LNFMM-MSE (pre-trained)	0.606	0.686	0.798	0.915	1.682	0.723	0.400	0.306
LNFMM (pre-trained)	0.600	0.695	0.804	0.917	1.697	0.729	0.400	0.311
LNFMM	0.597	0.695	0.802	0.920	1.705	0.729	0.402	0.316
Table 1. Oracle performance for captioning on the COCO dataset with different metrics
Method	B-4	B-3	B-2	B-1	C	R	M	S
Div-BS (Vijayakumar et al., 2018)	0.325	0.430	0.569	0.734	1.034	0.538	0.255	0.187
POS (Deshpande et al., 2019)	0.316	0.425	0.569	0.739	1.045	0.532	0.255	0.188
AG-CVAE (Wang et al., 2017)	0.311	0.417	0.559	0.732	1.001	0.528	0.245	0.179
LNFMM	0.318	0.433	0.582	0.747	1.055	0.538	0.247	0.188
LNFMM-TXT (semi-supervised, 30% labeled)	0.276	0.384	0.529	0.706	0.973	0.511	0.241	0.171
LNFMM-MSE (semi-supervised, 30% labeled)	0.277	0.388	0.531	0.704	0.910	0.509	0.231	0.169
LNFMM (semi-supervised, 30% labeled)	0.300	0.413	0.559	0.729	0.984	0.538	0.242	0.172
Table 2. Consensus re-ranking for captioning on the COCO dataset using CIDEr
Starting from the ELBO on the right-hand side of Eq. (6), the learned latent priors in Eq. (8), the
invertible mapping from Eq. (9), and plugging in the reconstruction terms as just defined, the overall
objective of our semi-supervised generative model framework to be minimized is given by
Lμ(xt,Xv ) = λιDκL(qθι (zs∣Xt,Xv ) Il Pφs (Zs)) + λ2DκL(qθ2 (Zt ∣Xt,Zs) Il Pφt (Zt ∣Zs))
+ λ3DκL (qθ3 (zV ∣Xv ,Zs)∣∣ Pφv (Zv ∣zs)) + λ4 Lrec(xt, Xt) + λ5Lrec(xv ,Xv).
(10)
Here, μ = {θ,φs,φv ,φt,ωv ,ωt} are all parameters to be learned; λi,i = {1,..., 5} are regulariza-
tion parameters. Recall that Xt and Xv are decoded text and image samples, respectively. We assume
the prior pφs (Zs) on the shared latent space to be uniform. The strength of this uniform prior on the
shared dimensions can be controlled with the regularization parameter λ1.
Our model allows for bi-directional many-to-many mappings. In detail, given a data point Xv from
the image domain with latent encoding Zv , we first map it to the text domain through the invertible
transformation Zs = fφs ((Zv)d0). We can now generate diverse texts by sampling from the learned
latent prior pφt (Ztt|Zs). A similar procedure is followed for sampling images given text through
the learned prior pφv (Zvt |Zs). For conditional generation tasks, as we do not have to sample from
the supervised latent space, we find a “uniform” prior pφs (Zs) to be advantageous in practice as
it loosens the constraints on the decoders. Alternatively, a more complex flow-based prior could
also be used here to enable sampling of the shared semantic space. We show the effectiveness of
our joint latent normalizing flow-based priors on real-world tasks, i.e. diverse image captioning and
text-to-image synthesis.
4	Experiments
To validate our method for learning many-to-many mappings to provide latent joint distributions,
one of the important real-world tasks is that of image-to-text or text-to-image synthesis. To that end,
we perform experiments on the COCO dataset (Lin et al., 2014). It contains 82,783 training and
40,504 validation images, each with five captions. Following Wang et al. (2016); Mao et al. (2015)
for image captioning, we use 118,287 data points for training and evaluate on 1,000 test images. For
text-to-image synthesis, the training set contains 82,783 images and 40,504 validation data points at
test time (Reed et al., 2016; Huang et al., 2017). Architecture details can be found in the Appendix.
4.1	Image Captioning
We evaluate our approach against methods that generate diverse captions for a given image. We
compare against methods based on (conditional) variational autoencoders, AG-CVAE (Wang et al.,
*Our implementation
6
Published as a conference paper at ICLR 2020
Method	Unique ↑	Novel ↑	mBLEU J	Div-1 ↑	Div-2 ↑	Method	B-1	B-4	CIDEr
Div-BS	100	3421	0.82	0.20	0.25	M3D-GAN	0.652	0.238	-
POS	91.5	3446	0.67	0.23	0.33	GXN	0.571	0.149	0.611
AG-CVAE	47.4	3069	0.70	0.23	0.32		—		
Seq-CVAE	84.2	4215	0.64	0.33	0.48	LNFMM	0.747	0.315	1.055
LNFMM	97.0	4741	0.60	0.37	0.51	Table 4. Comparison to the state of the			
Table 3.	Diversity evaluation	on at most the best-5 sentences after				art for bi-directional generation			
consensus re-ranking
Image
Caption
Image
Caption
• Two elephants standing next to
each other in a river.
• A herd of elephants in a grassy
area of water.
• Two elephants walking through a
river while standing in the water.
• Two elephants are walking and
baby in the water.
• A group of elephants walking
around a watering hole.
• A living room filled with furni-
ture and a large window.
• A room with a couch and a large
wooden table.
• A living room filled area with
furniture and a couch and chair.
• A room with a couch, chair, and
a lamp.
• This is a room with furniture on
the floor.
Table 5. Example captions generated by our model
2016), which uses additional supervision based on information about objects in the images for a
Gaussian mixture model in the latent space, and Seq-CVAE (Aneja et al., 2019), which models
sequential latent spaces with Gaussian priors. We also include Div-BS (Vijayakumar et al., 2018)
based on beam search and POS (Aneja et al., 2018), which uses additional supervision from images.
Additionally, we include different ablations to show the effectiveness of various components of
our approach. LNFMM-MSE does not contain the invertible neural network fφs , i.e. we directly
minimize the mean squared error between (zt)d0 and (zv)d0 in Eq. (10). We fix the image encodings
of a VGG-16 encoder in LNFMM (pre-trained) for comparison to image captioning methods with
pre-trained image features. Furthermore, LNFMM-TXT contains the latent flow for unsupervised
information fφt only for the text distribution. In this setting, we have zv = zs and thus zv is
transformed through the invertible neural network as fφs (zv). To show that our framework can be
applied in the semi-supervised setting, we also consider limited labeled data with only 30% of the
paired training data for supervision. The remaining training data is included as unpaired data for
modeling domain-specific information.
Evaluation. We evaluate the accuracy with Bleu (B) 1-4 (Papineni et al., 2002), CIDEr (C; Vedan-
tam et al., 2015), ROUGE (R; Lin, 2004), METEOR (M; Denkowski & Lavie, 2014), and SPICE
(S; Anderson et al., 2016). For evaluating diversity, we consider the metrics of Wang et al. (2017);
Aneja et al. (2019). Uniqueness is the percentage of unique captions generated on the test set. Novel
sentences are the captions that were never observed in the training data. m-Bleu-4 computes Bleu-4
for each diverse caption with respect to remaining diverse captions per image. The Bleu-4 obtained
is averaged across all images. Div-n is the ratio of distinct n-grams to the total number of words
generated per set of diverse captions.
Results. In Table 1 we show the caption evaluation metrics in the oracle setting, i.e. taking the
maximum score for each accuracy metric over all the candidate captions. We consider 100 samples
z, consistent with previous methods. The cVAE baseline with an image-conditioned Gaussian prior
does not perform well on all metrics, showing the inability of the Gaussian prior to model meaningful
latent spaces representative of the multimodal nature the underlying data distribution. The overall
trend across metrics is that our LNFMM model improves the upper bound on Bleu and CIDEr while
being comparable on the Rouge and Spice metrics.
Comparing the accuracy of the baseline LNFMM-MSE with LNFMM, we can conclude that learn-
ing the shared posterior distribution of zs with our invertible mapping is better than directly mini-
mizing the mean squared error in the latent space due to differences in the complexity of the distri-
butions. Also note that LNFMM (pre-trained) with fixed image-encoded representations has better
performance compared to AG-CVAE and Seq-CVAE, in particular. This highlights that the LNFMM
7
Published as a conference paper at ICLR 2020
Text	Sample #1 Sample #2
A close up
of a pizza
with
toppings
A baseball
player
swinging a
bat during
a game
Sample #3 Sample #4 Ground-truth AttnGAN Our LNFMM
Figure 3. Example images generated by our LNFMM model high-
lighting diversity
Figure 4. Text-conditioned samples clos-
est to test image with IoVM
learns representations in the latent space that are representative of the underlying data distribution
even for pre-trained features.
Table 2 considers a more realistic setting (as ground-truth captions are not always available) where,
instead of comparing against the reference captions of the test set, reference captions for images from
the training set most similar to the test image are retrieved. The generated captions are then ranked
with the CIDEr score (Mao et al., 2015). While Div-BS has very good accuracy across metrics due
to the wide search space, our LNFMM model gives state-of-the-art accuracy on various Bleu metrics
and especially the CIDEr score, which is known to correlate well with human evaluations. More in-
terestingly, compared to AG-CVAE with conditional Gaussian mixture priors based on object (class)
information, our LNFMM model, which does not encode any additional supervised information in
the latent space, outperforms the former on all accuracy metrics by a large margin. Moreover, the re-
cent GXN (Gu et al., 2018) and M3DGAN (Ma et al., 2019) also study bi-directional synthesis with
joint models in Gaussian latent spaces. Ma et al. (2019) additionally model attention in the latent
space. From Table 4, we see that our method considerably outperforms the competing methods, val-
idating the importance of complex priors in the latent space for image-text distributions. This again
highlights that the complex joint distribution of images and texts captured by our LNFMM model is
more representative of the ground-truth data distribution. We additionally experiment with limited
labelled training data (30% labeled), which shows that our approach copes well with limited paired
data. We finally compare LMFMM against LNFMM-TXT to show the importance of joint learning
of image and text generative models. With a generative model only for texts, the joint distribution
cannot be captured effectively in the latent space.
With diversity being an important goal here, we show in Table 3 that our LNFMM method improves
diversity across all metrics, with a 6.5% improvement in unique captions generated in the test set and
4741/5000 captions not previously seen in the training set. Our generated captions for a given image
also show more diversity with low mutual overlap (mBLEU) compared to the state of the art. We,
moreover, observe high n-gram diversity for the generated captions of each image. Div-BS with high
accuracy has limited diversity as it can repeat the n-grams in different captions. POS and AG-CVAE,
due to guided supervision in the latent space, offer diversity but model only syntactic or semantic
diversity, respectively (Wang & Chan, 2019). Our proposed LNFMM model in Table 5 shows a
range of diverse captions with different semantics and syntactic structure. Therefore, we conclude
that the proposed LNFMM can effectively learn semantically meaningful joint latent representations
without any additional object or text-guided supervision. The data-dependent learnt priors are thus
promising for synthesizing captions with high human-correlated accuracy as well as diversity.
4.2	Text-to-Image Synthesis
Given a text description, we are now interested in generating diverse images representative of the
domain-specific structure of images. To that end, we include a discriminator to improve the image
quality of our image decoder. Note that this does not affect the joint latent space of the LNFMM
model. We evaluate our method against state-of-the-art approaches such as AttnGAN (Xu et al.,
2018), HD-GAN (Zhang et al., 2018b), StackGAN (Zhang et al., 2017), and GAN-INT-CLS (Reed
et al., 2016). While our main goal is to encourage text-conditioned diversity in the generated sam-
ples, the current state-of-the-art for text-to-image generation aims at improving the realism of the
8
Published as a conference paper at ICLR 2020
generated images. Note that various GANs can be integrated with the image decoder of our frame-
work as desired.
Evaluation. As we are interested in modeling diversity, we study the diversity in generated images
using the Inference via Optimization (IvOM; Srivastava et al., 2017) and LPIPS (Zhang et al., 2018a)
metrics against the state-of-the-art AttnGAN. Given the text, for each matching image, IvOM finds
the closest image the model is capable of generating. Thus, it shows whether the model can match
the diversity of the ground-truth distribution. LPIPS (Zhang et al., 2018a) evaluates diversity by
computing pairwise perceptual similarities using a deep neural network. Additionally, we also report
the Inception score (Salimans et al., 2016).
Results. In Table 6, our method improves over At-
tnGAN for both IvOM and LPIPS scores, showing that
our method can effectively model the image semantics
conditioned on the texts in the latent space, as well as
generate diverse images for a given caption. Note that
AttnGAN uses extra supervision to improve the incep-
tion score. However, it is unclear if this improves the
visual quality of the generated images as pointed out by
Method	IS ↑	IvOM J	LPIPS ↑
AttnGAN	25.89±0.47	1.101*	0.472*
GAN-INT-CLS	7.88± 0.07	-	-
Stack-GAN	8.45±0.03	-	-
HD-GAN	11.86±0.18	-	-
LNFMM	12.10 ±0.18	0.430	0.481
Table 6. Evaluation on text-to-image synthesis
Zhang et al. (2018b). We improve the IS over HD-GAN, which does not use additional supervision.
Qualitative examples in Fig. 3 show that our LNFMM model generates diverse images, e.g., close-
up images of food items as well as different orientations of the baseball player in the field. In Fig. 4
we additionally see that given a caption, images generated by our LNFMM model capture detailed
semantics of the test images compared to that of AttnGAN, showing the representative power of our
latent space.
5	Conclusion
We present a novel and effective semi-supervised LNFMM framework for diverse bi-directional
many-to-many mappings with learnt priors in the latent space, which enables modeling joint image-
text distributions. Particularly, we model domain-specific information conditioned on the shared
information between the two domains with normalizing flows, thus preserving the heterogeneous
structure of the data in the latent space. Our extensive experiments with bi-directional synthesis
show that our latent space can effectively model data-dependent priors, which enable highly accurate
and diverse generated samples of images or texts.
Acknowledgement. This work has been supported by the German Research Foundation as part of the Re-
search Training Group Adaptive Preparation of Information from Heterogeneous Sources (AIPHES) under grant
No. GRK 1994/1.
References
Peter Anderson, Basura Fernando, Mark Johnson, and Stephen Gould. SPICE: semantic proposi-
tional image caption evaluation. In ECCV, 2016.
Jyoti Aneja, Aditya Deshpande, and Alexander G. Schwing. Convolutional image captioning. In
CVPR, 2018.
Jyoti Aneja, Harsh Agrawal, Dhruv Batra, and Alexander G. Schwing. Sequential latent spaces for
modeling the intention during diverse image captioning. ICCV, 2019.
Lynton Ardizzone, Jakob Kruse, Carsten Rother, and Ullrich Kothe. Analyzing inverse problems
with invertible neural networks. In ICLR, 2019.
Jens Behrmann, Will Grathwohl, Ricky T. Q. Chen, David Duvenaud, and Jorn-Henrik Jacobsen.
Invertible residual networks. In ICML, 2019.
Apratim Bhattacharyya, Michael Hanselmann, Mario Fritz, Bernt Schiele, and Christoph-Nikolas
Straehle. Conditional flow variational autoencoders for structured sequence prediction. In
BDL@NeurIPS, 2019.
9
Published as a conference paper at ICLR 2020
Xi Chen, Diederik P. Kingma, Tim Salimans, Yan Duan, Prafulla Dhariwal, John Schulman, Ilya
Sutskever, and Pieter Abbeel. Variational lossy autoencoder. In ICLR, 2017.
Bo Dai, Sanja Fidler, Raquel Urtasun, and Dahua Lin. Towards diverse and natural image descrip-
tions via a conditional GAN. In ICCV, 2017.
Ayushman Dash, John Cristian Borges Gamboa, Sheraz Ahmed, Marcus Liwicki, and Muham-
mad Zeshan Afzal. TAC-GAN - Text conditioned auxiliary classifier generative adversarial net-
work. In AAAI, 2017.
Michael J. Denkowski and Alon Lavie. Meteor universal: Language specific translation evaluation
for any target language. In WMT@ACL, 2014.
Aditya Deshpande, Jyoti Aneja, Liwei Wang, Alexander G Schwing, and David Forsyth. Fast,
diverse and accurate image captioning guided by part-of-speech. In CVPR, 2019.
Laurent Dinh, David Krueger, and Yoshua Bengio. NICE: Non-linear independent components
estimation. In ICLR, 2015.
Laurent Dinh, Jascha Sohl-Dickstein, and Samy Bengio. Density estimation using real NVP. In
ICLR, 2017.
Ian J. Goodfellow, Jean Pouget-Abadie, Mehdi Mirza, Bing Xu, David Warde-Farley, Sherjil Ozair,
Aaron C. Courville, and Yoshua Bengio. Generative adversarial nets. In NIPS, 2014.
Jiuxiang Gu, Jianfei Cai, Shafiq R. Joty, Li Niu, and Gang Wang. Look, imagine and match: Im-
proving textual-visual cross-modal retrieval with generative models. In CVPR, 2018.
Matthew D. Hoffman and Matthew J. Johnson. ELBO surgery: yet another way to carve up the
variational evidence lower bound. In NIPS Workshop on Advances in Approximate Bayesian
Inference, 2016.
Xun Huang, Yixuan Li, Omid Poursaeed, John E. Hopcroft, and Serge J. Belongie. Stacked genera-
tive adversarial networks. In CVPR, 2017.
Andrej Karpathy and Li Fei-Fei. Deep visual-semantic alignments for generating image descrip-
tions. TPAMI, 39(4):664-676, 2017.
Diederik P. Kingma and Prafulla Dhariwal. Glow: Generative flow with invertible 1x1 convolutions.
In NeurIPS, 2018.
Diederik P. Kingma and Max Welling. Auto-encoding variational Bayes. In ICLR, 2014.
Dianqi Li, Qiuyuan Huang, Xiaodong He, Lei Zhang, and Ming-Ting Sun. Generating diverse and
accurate visual captions by comparative adversarial learning. arXiv:1804.00861 [cs.CV], 2018.
Chin-Yew Lin. ROUGE: A package for automatic evaluation of summaries. In Text Summarization
Branches Out. ACL, 2004.
Tsung-Yi Lin, Michael Maire, Serge J. Belongie, James Hays, Pietro Perona, Deva Ramanan, Piotr
Dollar, and C. Lawrence Zitnick. Microsoft COCO: common objects in context. In ECCV,, 2014.
Shuang Ma, Daniel J. McDuff, and Yale Song. M3D-GAN: multi-modal multi-domain translation
with universal attention. In CVPR, 2019.
Junhua Mao, Wei Xu, Yi Yang, Jiang Wang, and Alan L. Yuille. Deep captioning with multimodal
recurrent neural networks (m-RNN). In ICLR, 2015.
Kishore Papineni, Salim Roukos, Todd Ward, and Wei-Jing Zhu. BLEU: a method for automatic
evaluation of machine translation. In ACL, 2002.
Tingting Qiao, Jing Zhang, Duanqing Xu, and Dacheng Tao. MirrorGAN: Learning text-to-image
generation by redescription. CVPR, 2019.
10
Published as a conference paper at ICLR 2020
Ali Razavi, Aaron van den Oord, Ben Poole, and Oriol Vinyals. Preventing posterior collapse with
delta-VAEs. In ICLR, 2019.
Scott E. Reed, Zeynep Akata, Xinchen Yan, Lajanugen Logeswaran, Bernt Schiele, and Honglak
Lee. Generative adversarial text to image synthesis. In ICML, 2016.
Tim Salimans, Ian J. Goodfellow, Wojciech Zaremba, Vicki Cheung, Alec Radford, and Xi Chen.
Improved techniques for training GANs. In NIPS, 2016.
Rakshith Shetty, Marcus Rohrbach, Lisa Anne Hendricks, Mario Fritz, and Bernt Schiele. Speaking
the same language: Matching machine to human captions by adversarial training. In ICCV, 2017.
Akash Srivastava, Lazar Valkov, Chris Russell, Michael U. Gutmann, and Charles A. Sutton. VEE-
GAN: Reducing mode collapse in GANs using implicit variational learning. In NIPS, 2017.
Jakub M. Tomczak and Max Welling. VAE with a VampPrior. In AISTATS, 2018.
Aaron van den Oord, Oriol Vinyals, and Koray KavUkcUoglu. Neural discrete representation learn-
ing. In NeurIPS, 2017.
Laurens van der Maaten and Geoffrey Hinton. Visualizing data using t-SNE. JMLR, 9(Nov):2579-
2605, 2008.
Ramakrishna Vedantam, C. Lawrence Zitnick, and Devi Parikh. CIDEr: Consensus-based image
description evaluation. In CVPR, 2015.
Ashwin K. Vijayakumar, Michael Cogswell, Ramprasaath R. Selvaraju, Qing Sun, Stefan Lee,
David J. Crandall, and Dhruv Batra. Diverse beam search for improved description of complex
scenes. In AAAI, 2018.
Liwei Wang, Alexander G. Schwing, and Svetlana Lazebnik. Diverse and accurate image description
using a variational auto-encoder with an additive Gaussian encoding space. In NIPS, 2017.
Liwei Wang, Yin Li, Jing Huang, and Svetlana Lazebnik. Learning two-branch neural networks for
image-text matching tasks. TPAMI, 41(2):394^07, 2019.
Qingzhong Wang and Antoni B. Chan. Describing like humans: on diversity in image captioning.
In CVPR, 2019.
Zhuhao Wang, Fei Wu, Weiming Lu, Jun Xiao, Xi Li, Zitong Zhang, and Yueting Zhuang. Diverse
image captioning via grouptalk. In IJCAI, 2016.
Tao Xu, Pengchuan Zhang, Qiuyuan Huang, Han Zhang, Zhe Gan, Xiaolei Huang, and Xiaodong
He. AttnGAN: Fine-grained text to image generation with attentional generative adversarial net-
works. In CVPR, 2018.
Guojun Yin, Bin Liu, Lu Sheng, Nenghai Yu, Xiaogang Wang, and Jing Shao. Semantics disentan-
gling for text-to-image generation. CVPR, 2019.
Han Zhang, Tao Xu, and Hongsheng Li. StackGAN: Text to photo-realistic image synthesis with
stacked generative adversarial networks. In ICCV, 2017.
Han Zhang, Ian J. Goodfellow, Dimitris N. Metaxas, and Augustus Odena. Self-attention generative
adversarial networks. In ICML, 2019a.
Han Zhang, Tao Xu, Hongsheng Li, Shaoting Zhang, Xiaogang Wang, Xiaolei Huang, and Dim-
itris N. Metaxas. StackGAN++: Realistic image synthesis with stacked generative adversarial
networks. TPAMI, 41(8):1947-1962, 2019b.
Richard Zhang, Phillip Isola, Alexei A. Efros, Eli Shechtman, and Oliver Wang. The unreasonable
effectiveness of deep features as a perceptual metric. In CVPR, 2018a.
Zizhao Zhang, Yuanpu Xie, and Lin Yang. Photographic text-to-image synthesis with a
hierarchically-nested adversarial network. In CVPR, 2018b.
Zachary M. Ziegler and Alexander M. Rush. Latent normalizing flows for discrete sequences. In
ICML, 2019.
11
Published as a conference paper at ICLR 2020
Figure 5. Inference model of our approach (right) in comparison to the conditional variational autoencoder of
AG-CVAE (left; Wang et al., 2017). AG-CVAE models only supervised information in the latent dimensions.
Our model encodes domain-specific variations in the conditional priors zv0 and zt0.
A Appendix
A.1 Network Architecture
We provide the details of the network architecture of Fig. 2.
Image pipeline. The network consists of an image encoder built upon VGG-16. 4096-dimensional
activations of input images are extracted from the fully-connected layer of VGG-16. This is followed
by a 2048-dimensional fully-connected layer with ReLU activations. We then project it to the latent
space with a 1056-dimensional fully-connected layer. The image pipeline has d0 = dim zs = 992
and dim zv0 = 64 dimensions. In the image decoder, we leverage the architecture of Zhang et al.
(2019a) to synthesize images of 64 × 64 or 256 × 256 dimensions. The input to the decoder has
dimensionality 1056. For the image generation experiments, we additionally apply the discriminator
of Zhang et al. (2019b) to the output of the image decoder.
Text pipeline. We use a bidirectional GRU with two layers and a hidden size of 1024 as text encoder.
This outputs 1024-dimensional latent representations for sentences. For text, dim zt0 = 32. The text
decoder is a LSTM with one layer and hidden size of 512.
Flow modules. Our network consists of two flow modules for conditional priors on image and text
domains and an invertible neural network to exchange supervised information.
Invertible neural network for supervision (fφs): This invertible neural network consists of 12 flow
layers and input dimensionality of 992. Each flow consists of conditional affine coupling layers
followed by a switch layer (Dinh et al., 2015).
Latent flow for conditional prior on images (fφv): We map the 64 dimensions of the image encodings
from the image encoder to a Gaussian with normalizing flows with 16 layers of flow and 512 hidden
channels. Each flow consists of conditional affine coupling layers followed by a switch layer (Dinh
et al., 2017).
Latent flow for conditional prior on texts (fφt): We map the 32 dimensions of the text encodings
from the text encoder to a Gaussian with normalizing flows with 16 layers of flow and 1024 hidden
channels. Each flow consists of a conditional activation normalization layer followed by conditional
affine coupling layers. Invertible 1 × 1 convolutions are applied to the output of the affine coupling
layers, which is followed by a switch layer (Kingma & Dhariwal, 2018).
A.2 Diversity in Image Captioning
We show more qualitative examples of the captions generated by our LNFMM model in Table 7.
The example captions show syntactic as well as semantic diversity.
12
Published as a conference paper at ICLR 2020
Image
Caption
Image
Caption
•	A woman holding an um-
brella while standing in the
rain.
•	A woman is holding um-
brella on the street
•	A woman walking a street
with a umbrella in the rain.
•	A woman is holding an um-
brella while walking in the
rain
•	A woman walking down a
street while holding an um-
brella
•	A woman standing in front of
a refrigerator
•	Two people standing to-
gether in a large kitchen
•	Two people are standing in a
kitchen counter.
•	A family is preparing food in
a kitchen.
•	A few people standing in the
kitchen at a table.
• A man is holding a tennis
racket on the tennis court.
• A tennis player about to hit a
tennis ball
• A man is playing tennis with
a racket on the tennis court.
• A man standing on a tennis
court is holding a racket
• A man prepares to hit a ball
with tennis racket.
•	A large clock tower is in the
middle of a building.
•	A tall building with a clock
tower in front of a building.
•	A clock tower in the sky with
a clock on top.
•	A tall building with a clock
on top.
•	A tall clock tower with a
clock tower on it.
Table 7. Example captions generated by our LNFMM model
Figure 6. Example images generated by our LNFMM model high-
lighting diversity
Ground-truth	LNFMM (Ours)
Figure 7. Text-conditioned samples
closest to test image with IvOM by our
LNFMM
A.3 Text-to-Image Synthesis
We additionally show diverse images generated by our LNFMM model in Fig. 6. Our generated
images can successfully capture the text semantics and also exhibit image specific diversity, e.g. in
style and orientation of objects. Furthermore, to show that the latent space captures the joint distri-
bution, we show the images generated by our model with IvOM by finding a zv conditioned on the
input text that is most likely to have generated the test image. We show the images generated for the
zv most likely to have generated the image. Our generated samples in Fig. 7 capture the details in
the images, showing that our LNFMM model learns powerful latent representations.
A.4 Visualization of latent spaces
In Table 8 we show the t-SNE (van der Maaten & Hinton, 2008) visualization of the latent space of
texts conditioned on an image. In the examples shown, we observe global patterns like ‘table with
foods’ across all captions of an image and local patterns in clusters like ‘table with several’ or ‘a
dinner table with’ showing image-conditioned representation as well as domain-specific variation.
13
Published as a conference paper at ICLR 2020
Image
Latent Space	Captions
•	a table set with various different foods.
•	a table with several plates of food items
on it.
•	a table with several plates and various
food items.
•	a buffet table with plates full of food
items.
•	a long table topped with food and uten-
sils.
•	a wooden table topped with plates filled
with food.
•	a dinner table with many dishes and and
food.
•	a dinner table set with plates of food.
•	a dinner table with many dishes and a
meal.
•	a baseball player hitting a baseball on a
baseball field.
•	a baseball player sliding to bat at home
plate.
•	a baseball player swinging a bat standing
on a field.
•	a baseball player swinging a bat next to
home plate.
•	a batter swinging at a ball during a game.
•	a batter swinging a baseball bat at a game.
•	a baseball player is standing to hit a ball.
•	a baseball player hitting a ball during a
game.
•	a baseball player swinging a bat at a ball.
•	baseball players and an umpire waiting
for a pitch.
•	a baseball player a catcher is a baseball
game.
•	a baseball player holding bat in the bat-
ters box.
Table 8.	t-SNE visualization of the latent space of texts conditioned on an image. Example captions clustered
using k-means. Captions are color-coded based on corresponding clusters
Similarly, in Table 9 we can observe clusters in image space conditioned on texts. Here again, we can
observe global patterns like ‘close-up of food’ and local patterns like ‘pizza’, ‘food with toppings,
or ‘sandwiches’.
A.5 Validation with Human Evaluation
In addition to validating the performance of our LNFMM method on image captioning for accuracy
in Table 1 and for diversity Table 3 with various measures, we conduct a human evaluation of the
quality of captions generated by our LNFMM approach against Div-BS (Vijayakumar et al., 2018)
for accuracy and diversity. We presented five captions each for a set of images and for each method
to four human annotators. The human annotators assessed the captions for accuracy and diversity
on a scale from 1 to 10. Here, accuracy is defined as how well the captions describe the details in a
given image and diversity can be syntactic diversity or semantic diversity.
In Fig. 8 (left), the score for each image is the average score given by the four annotators and Fig. 8
(right) shows the scores for the captions of each image from each annotator. Here, our findings
are similar to those in Table 1 and Table 3. The captions generated by Div-BS were assessed to
have diversity scores in the range of [5, 8], while the diversity scores fell into the range [7, 10] for
our LNFMM method. Furthermore, the accuracy of the captions of each image generated with our
LNFMM was found to be better compared to Div-BS, thereby showing that LNFMM can generate
captions that are both diverse and accurate.
14
Published as a conference paper at ICLR 2020
Text
Latent Space
Generated Images
A pizza sitting on a pan on a table.
A man playing with a flying disc on the grass.
Table 9.	t-SNE visualization of the latent space of images conditioned on a caption. Example images clustered
using k-means. Images are color-coded based on corresponding clusters
4
6
Div-BS (Vijayak
LNFMM (Ours)
Accuracy
Accuracy
Figure 8. Comparison of accuracy and diversity scores of captions for images generated with LNFMM (Ours)
and DIV-BS (Vijayakumar et al., 2018): Scores for captions of an image averaged across all annotators (left)
and scores for all captions of an image for each annotator (right). To make coinciding scores be easier to see, a
small random jitter is added to each human assessment.
15
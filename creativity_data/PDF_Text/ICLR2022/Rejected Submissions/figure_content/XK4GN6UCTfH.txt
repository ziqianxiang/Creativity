Figure 1: Workflow of MS/MS and fragmentation tree. (a) Illustration for adduct ions and fragmen-tation of metabolites. Metabolites are firstly adducted by selected cations to form [Adduct ion]+in MS1. Then, [Adduct ion]+ is fragmented to form fragments in an inert gas atmosphere, and theresulted fragments are recorded by MS2. (b) Calculation process of fragmentation tree. Firstly, ini-tialization of fragmentation graph is performed by enumerating all possible molecular formulas forevery node by matching the monoisotopic mass. Secondly, scoring is calculated separately for nodesand edges. For nodes, calculate the mass difference between the measured peak and the molecularformula, then compute log odds to differentiate the fragment and the background noise. The princi-ple behind this is that mass differences for fragments are assumed to be Normal distributed, whileexponentially distributed for noises. For edges, calculate the common neutral losses, which are typ-ically described as the loss of small molecules (e.g., water and ammonia), not ions. Thirdly, rankingof fragmentation trees is performed by choosing the one with highest score among all the possiblefragmentation trees.
Figure 2: Demonstration of one experimental MS/MS. (a) Typical experimental MS/MS ofaminocaproic acid, in which the monoisotopic mass is marked with a red star and the fragmentationpattern of dehydration is indicated by ∆m∕z of 18 Da. (b) The fragmentation tree of aminocaproicacid calculated from (a).
Figure 3: The architecture of MS2-Transformer. In peak embedding module, the m/z’s are processedby an embedding layer with positional encoding, and the intensities are first projected into the samedimension as the m/z’s embedding, then concatenated with m/z embedding for the construction ofpeak embedding by a Linear layer. In the fragmentation aggregation module, the peak embeddingwas updated by local aggregation on the fragmentation tree, and global aggregation on the fullyconnected graph, where the nodes denote the peaks in the spectrum and the edges denote the frag-mentation correlations. In the SMILES reconstruction module, the learned peak embedding wasused for SMILES reconstruction by Transformer.
Figure 4: The data statistics of the benchmark datasets. The distribution for the number of (a) edgesin T and (b) peaks in MS/MS, and (c) the lengths of SMILES in MassBank dataset. The distributionfor the number of (d) edges in T and (e) peaks in MS/MS, and (f) the lengths of SMILES in CASMIdataset. The red line indicated the 95% percentile.
Figure 5: The demonstration of generated SMILES in (a) MassBank and (b) CASMI dataset. Theabove spectrum denotes the MS/MS spectrum as the input of MS2-Transformer, the below molec-ular graphs denote the top-9 candidates generated with beam search, the number below moleculargraph indicates the searching score, and the circled molecule denotes the accurate prediction of truemolecule.
